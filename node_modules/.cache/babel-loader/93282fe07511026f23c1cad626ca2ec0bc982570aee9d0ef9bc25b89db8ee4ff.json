{"ast":null,"code":"// src/components/SistemaTrabajadoresFirebase.js\nimport React,{useEffect,useRef,useState}from'react';import{trabajadoresService}from'../services/firebaseservices';import{database}from'../config/firebase';import{ref,onValue,update,set}from'firebase/database';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SistemaTrabajadoresFirebase=_ref=>{let{currentUser,onLogout}=_ref;// Log para debugging\nconsole.log('üîç Current User Data:',currentUser);// Estados principales\nconst mapRef=useRef(null);const[map,setMap]=useState(null);const[userPosition,setUserPosition]=useState(null);const[selectedZona,setSelectedZona]=useState(null);const[isTracking,setIsTracking]=useState(false);const[isNavigating,setIsNavigating]=useState(false);const[workStatus,setWorkStatus]=useState('idle');// idle, traveling, working, completed\nconst[workLog,setWorkLog]=useState({startTime:null,arrivalTime:null,endTime:null,zona:null});// Estados para zonas y notificaciones\nconst[zonasAsignadas,setZonasAsignadas]=useState([]);const[notificaciones,setNotificaciones]=useState([]);const[showPanel,setShowPanel]=useState(true);// Estado para mostrar/ocultar panel\nconst[isMobile,setIsMobile]=useState(false);// Referencias para marcadores y servicios\nconst userMarkerRef=useRef(null);const zonaMarkerRef=useRef(null);const directionsServiceRef=useRef(null);const directionsRendererRef=useRef(null);const watchIdRef=useRef(null);const lastUpdateRef=useRef(null);// Estados de UI\nconst[mapLoaded,setMapLoaded]=useState(false);const[error,setError]=useState(null);const[distance,setDistance]=useState(null);const[duration,setDuration]=useState(null);const[showWorkLog,setShowWorkLog]=useState(false);const[gpsStatus,setGpsStatus]=useState('inactive');// inactive, activating, active, error\nconst API_KEY='AIzaSyA7DrdL36n5cx-RNzuXGAQggFeGCheHDbY';// Detectar si es m√≥vil\nuseEffect(()=>{const checkMobile=()=>{setIsMobile(window.innerWidth<=768);};checkMobile();window.addEventListener('resize',checkMobile);return()=>window.removeEventListener('resize',checkMobile);},[]);// Cargar zonas asignadas desde Firebase\nuseEffect(()=>{if(currentUser&&currentUser.uid){console.log('üîÑ Cargando zonas asignadas para trabajador:',currentUser.uid);// Escuchar zonas asignadas al trabajador\nconst zonasRef=ref(database,'zonas_asignadas');const unsubZonas=onValue(zonasRef,snapshot=>{const data=snapshot.val();console.log('üì¶ Datos de zonas recibidos:',data);if(data){// Filtrar solo las zonas asignadas a este trabajador\nconst zonasArray=Object.entries(data).filter(_ref2=>{let[id,zona]=_ref2;console.log(`Zona ${id}: asignada a ${zona.trabajadorAsignado}, yo soy ${currentUser.uid}`);return zona.trabajadorAsignado===currentUser.uid&&zona.estado!=='completado';}).map(_ref3=>{let[id,zona]=_ref3;return{id,...zona};});console.log('‚úÖ Zonas asignadas filtradas:',zonasArray);setZonasAsignadas(zonasArray);}else{console.log('‚ö†Ô∏è No hay zonas en Firebase');setZonasAsignadas([]);}});// Escuchar notificaciones\nconst notifRef=ref(database,'notificaciones');const unsubNotif=onValue(notifRef,snapshot=>{const data=snapshot.val();if(data){const notifArray=Object.entries(data).filter(_ref4=>{let[id,notif]=_ref4;return notif.trabajadorId===currentUser.uid&&!notif.leido;}).map(_ref5=>{let[id,notif]=_ref5;return{id,...notif};});setNotificaciones(notifArray);}});return()=>{unsubZonas();unsubNotif();};}},[currentUser]);// Registrar trabajador al montar el componente\nuseEffect(()=>{if(currentUser&&currentUser.uid){console.log('üîÑ Registrando trabajador al iniciar...');// Crear o actualizar el trabajador en Realtime Database\ntrabajadoresService.createOrUpdateTrabajador(currentUser.uid,{nombre:currentUser.name||currentUser.email||'Trabajador',email:currentUser.email,telefono:currentUser.phone||'',vehicleId:currentUser.vehicleId||null,estado:'inactivo',rol:'trabajador',ubicacion:null,createdAt:new Date().toISOString(),ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('‚úÖ Trabajador registrado en Realtime Database al iniciar');}).catch(error=>{console.error('‚ùå Error al registrar trabajador al iniciar:',error);});}},[currentUser]);// Funci√≥n para cargar Google Maps\nuseEffect(()=>{const loadGoogleMaps=()=>{return new Promise((resolve,reject)=>{if(window.google&&window.google.maps){resolve(window.google.maps);return;}const existingScript=document.querySelector('script[src*=\"maps.googleapis.com\"]');if(existingScript){existingScript.addEventListener('load',()=>{if(window.google&&window.google.maps){resolve(window.google.maps);}else{reject(new Error('Google Maps no disponible'));}});return;}const script=document.createElement('script');script.src=`https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places,geometry&v=weekly`;script.async=true;script.defer=true;script.onload=()=>{if(window.google&&window.google.maps){resolve(window.google.maps);}else{reject(new Error('Google Maps no disponible'));}};script.onerror=()=>{reject(new Error('Error al cargar Google Maps'));};document.head.appendChild(script);});};const initMap=async()=>{try{const maps=await loadGoogleMaps();if(!mapRef.current)return;const mapInstance=new maps.Map(mapRef.current,{center:{lat:-36.7333,lng:-72.4667},zoom:13,mapTypeId:'roadmap',zoomControl:!isMobile,mapTypeControl:false,scaleControl:false,streetViewControl:false,rotateControl:false,fullscreenControl:true,gestureHandling:'greedy'// Mejor para m√≥viles\n});setMap(mapInstance);// Inicializar servicios de direcciones\n// Inicializar servicios de direcciones\ndirectionsServiceRef.current=new maps.DirectionsService();directionsRendererRef.current=new maps.DirectionsRenderer({map:mapInstance,suppressMarkers:false,// Mostrar marcadores A y B\npolylineOptions:{strokeColor:'#4285F4',strokeWeight:6,strokeOpacity:0.8},// Agregar estas opciones para mejor visualizaci√≥n\nmarkerOptions:{startMarker:{label:'A',title:'Tu ubicaci√≥n'},endMarker:{label:'B',title:'Zona de trabajo'}},preserveViewport:false// Ajustar vista autom√°ticamente a la ruta\n});setMapLoaded(true);}catch(err){setError('Error al cargar el mapa: '+err.message);}};initMap();},[isMobile]);// üî• FUNCI√ìN CR√çTICA - Actualizar posici√≥n del usuario Y ENVIAR A FIREBASE\nconst updateUserPosition=position=>{console.log('üîÑ Actualizando posici√≥n:',position);setUserPosition(position);// Mostrar precisi√≥n en el UI\nif(window.google&&map){// Opcional: Mostrar c√≠rculo de precisi√≥n en el mapa\nconst accuracy=position.accuracy||100;console.log('üìç Precisi√≥n actual:',accuracy,'metros');}// üî• ENVIAR UBICACI√ìN A FIREBASE - ESTO ES LO QUE FALTABA\n// Solo actualizar si ha pasado al menos 5 segundos desde la √∫ltima actualizaci√≥n\nconst ahora=Date.now();if(!lastUpdateRef.current||ahora-lastUpdateRef.current>5000){console.log('üìç Enviando ubicaci√≥n a Firebase:',position);if(currentUser&&currentUser.uid){// Actualizar ubicaci√≥n en Firebase\ntrabajadoresService.updateTrabajadorLocation(currentUser.uid,{lat:position.lat,lng:position.lng,timestamp:new Date().toISOString(),accuracy:position.accuracy||null// Guardar precisi√≥n tambi√©n\n}).then(()=>{console.log('‚úÖ Ubicaci√≥n enviada a Firebase exitosamente');console.log('   - Trabajador ID:',currentUser.uid);console.log('   - Posici√≥n:',position);}).catch(error=>{console.error('‚ùå Error al enviar ubicaci√≥n a Firebase:',error);console.error('   - Detalles:',error.message);});// Tambi√©n actualizar el estado del trabajador si es necesario\nconst estadoActual=workStatus==='traveling'?'en_camino':workStatus==='working'?'trabajando':'disponible';// Actualizar datos adicionales del trabajador\ntrabajadoresService.updateTrabajadorData(currentUser.uid,{nombre:currentUser.name||currentUser.email,email:currentUser.email,estado:estadoActual,zonaDestino:selectedZona?selectedZona.nombre:null,ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('‚úÖ Datos del trabajador actualizados');}).catch(error=>{console.error('‚ùå Error al actualizar datos del trabajador:',error);});lastUpdateRef.current=ahora;}}// Actualizar marcador en el mapa local\nif(!map||!window.google)return;// Crear o actualizar marcador del usuario\nif(!userMarkerRef.current){userMarkerRef.current=new window.google.maps.Marker({position:position,map:map,title:'Tu ubicaci√≥n',icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:10,fillColor:'#4285F4',fillOpacity:1,strokeColor:'#ffffff',strokeWeight:3},zIndex:1000});// Centrar mapa en usuario\nmap.setCenter(position);map.setZoom(15);}else{userMarkerRef.current.setPosition(position);}// Si est√° navegando, actualizar distancia pero NO cambiar autom√°ticamente a working\nif(isNavigating&&selectedZona){const distance=window.google.maps.geometry.spherical.computeDistanceBetween(new window.google.maps.LatLng(position.lat,position.lng),new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng));// Solo mostrar distancia, no cambiar estado autom√°ticamente\nconsole.log('üìè Distancia a la zona:',Math.round(distance),'metros');}};// Funci√≥n para activar/desactivar GPS\nconst toggleGPS=()=>{if(isTracking){// Detener tracking\nif(watchIdRef.current){navigator.geolocation.clearWatch(watchIdRef.current);watchIdRef.current=null;}setIsTracking(false);setGpsStatus('inactive');// Mantener √∫ltima posici√≥n para la pr√≥xima activaci√≥n\nconsole.log('üìç GPS desactivado, √∫ltima ubicaci√≥n guardada:',userPosition);// Limpiar marcador de usuario\nif(userMarkerRef.current){userMarkerRef.current.setMap(null);userMarkerRef.current=null;}// Limpiar ubicaci√≥n en Firebase al desactivar GPS (sin await)\nif(currentUser&&currentUser.uid){trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'inactivo',// NO borrar la ubicaci√≥n, solo marcar como inactivo\n// ubicacion: null, // COMENTADO - mantener √∫ltima ubicaci√≥n\nultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('üìç GPS desactivado - Estado actualizado a inactivo');}).catch(error=>{console.error('Error al actualizar estado en Firebase:',error);});// üî• NUEVO: Si hay un veh√≠culo asignado y est√° en uso, liberarlo\nif(currentUser.vehicleId&&(workStatus==='traveling'||workStatus==='working')){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('‚úÖ Veh√≠culo liberado al desactivar GPS');}).catch(error=>{console.error('Error al liberar veh√≠culo:',error);});}}// Mantener √∫ltima posici√≥n conocida\nconsole.log('üìç √öltima ubicaci√≥n conocida guardada:',userPosition);}else{// Iniciar tracking\nif(!navigator.geolocation){alert('Tu navegador no soporta geolocalizaci√≥n');setGpsStatus('error');return;}console.log('üîÑ Iniciando GPS...');setIsTracking(true);setGpsStatus('activating');// Registrar el trabajador en Firebase si no existe (sin bloquear)\nif(currentUser&&currentUser.uid){console.log('üìù Registrando trabajador en Realtime Database...');console.log('   - User ID:',currentUser.uid);console.log('   - Datos:',currentUser);trabajadoresService.createOrUpdateTrabajador(currentUser.uid,{nombre:currentUser.name||currentUser.email||'Trabajador',email:currentUser.email,telefono:currentUser.phone||'',estado:'disponible',rol:'trabajador',vehicleId:currentUser.vehicleId||null,createdAt:new Date().toISOString()}).then(()=>{console.log('‚úÖ Trabajador registrado en Realtime Database');console.log('   - Path: trabajadores/'+currentUser.uid);}).catch(error=>{console.error('‚ùå Error al registrar trabajador:',error);console.error('   - Detalles:',error.message);});}else{console.error('‚ö†Ô∏è No hay currentUser o uid disponible');}// Obtener posici√≥n inicial con ALTA PRECISI√ìN\nconsole.log('üìç Intentando obtener ubicaci√≥n GPS de alta precisi√≥n...');// Si ya tenemos una posici√≥n previa, usarla mientras obtenemos la nueva\nif(userPosition){console.log('üìç Usando √∫ltima ubicaci√≥n conocida mientras se obtiene GPS de alta precisi√≥n');setGpsStatus('active');// Intentar obtener ubicaci√≥n de ALTA PRECISI√ìN en segundo plano\nnavigator.geolocation.getCurrentPosition(position=>{console.log('üìç GPS de alta precisi√≥n actualizado:',position.coords);console.log('   - Precisi√≥n:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);},error=>{console.log('‚ö†Ô∏è GPS de alta precisi√≥n no disponible, usando precisi√≥n normal');},{enableHighAccuracy:true,// üî¥ ALTA PRECISI√ìN\ntimeout:20000,// M√°s tiempo para alta precisi√≥n\nmaximumAge:0// No usar cach√©, queremos ubicaci√≥n fresca\n});}else{// Primera vez - intentar con alta precisi√≥n\nsetGpsStatus('activating');navigator.geolocation.getCurrentPosition(position=>{console.log('‚úÖ GPS de alta precisi√≥n obtenido:',position.coords);console.log('   - Precisi√≥n:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');},error=>{console.warn('‚ö†Ô∏è Alta precisi√≥n fall√≥, intentando con precisi√≥n normal:',error.message);if(error.code===error.PERMISSION_DENIED){alert('Por favor, habilita los permisos de ubicaci√≥n en tu navegador');setIsTracking(false);setGpsStatus('error');return;}// Segundo intento con precisi√≥n normal\nnavigator.geolocation.getCurrentPosition(position=>{console.log('üìç GPS con precisi√≥n normal:',position.coords);console.log('   - Precisi√≥n:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');},error2=>{console.error('‚ùå No se pudo obtener GPS:',error2);// √öltima opci√≥n: ubicaci√≥n de respaldo\nconst testPosition={lat:-36.7508+(Math.random()-0.5)*0.001,lng:-72.4698+(Math.random()-0.5)*0.001,accuracy:100};updateUserPosition(testPosition);setGpsStatus('active');},{enableHighAccuracy:false,// Precisi√≥n normal\ntimeout:10000,maximumAge:30000});},{enableHighAccuracy:true,// üî¥ ALTA PRECISI√ìN primero\ntimeout:15000,// 15 segundos para alta precisi√≥n\nmaximumAge:0// No usar cach√©\n});}// Seguimiento continuo con ALTA PRECISI√ìN\nconst gpsWatchId=navigator.geolocation.watchPosition(position=>{console.log('üìç GPS - Actualizaci√≥n:',position.coords);console.log('   - Precisi√≥n:',position.coords.accuracy,'metros');// Solo actualizar si la precisi√≥n es mejor que 150 metros\nif(position.coords.accuracy<=150){const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');}else{console.log('‚ö†Ô∏è Precisi√≥n insuficiente, esperando mejor se√±al...');}},error=>{console.log('‚è±Ô∏è Esperando se√±al GPS...',error.message);},{enableHighAccuracy:true,// üî¥ ALTA PRECISI√ìN\ntimeout:30000,maximumAge:0,// Siempre ubicaci√≥n fresca\ndistanceFilter:5// Actualizar cada 5 metros de movimiento\n});watchIdRef.current=gpsWatchId;}};// Seleccionar zona de trabajo\nconst selectZona=zona=>{setSelectedZona(zona);if(!map||!window.google)return;// Limpiar marcador anterior\nif(zonaMarkerRef.current){zonaMarkerRef.current.setMap(null);}// Crear marcador de zona\nzonaMarkerRef.current=new window.google.maps.Marker({position:{lat:zona.lat,lng:zona.lng},map:map,title:zona.nombre,icon:{path:window.google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,scale:8,fillColor:'#22c55e',fillOpacity:1,strokeColor:'#ffffff',strokeWeight:2}});// Ajustar vista para mostrar ambos puntos\nif(userPosition){const bounds=new window.google.maps.LatLngBounds();bounds.extend(userPosition);bounds.extend({lat:zona.lat,lng:zona.lng});map.fitBounds(bounds,100);}else{map.setCenter({lat:zona.lat,lng:zona.lng});map.setZoom(15);}};// Iniciar navegaci√≥n\nconst startNavigation=async()=>{if(!selectedZona||!userPosition){alert('Debes activar el GPS y seleccionar una zona primero');return;}setIsNavigating(true);setWorkStatus('traveling');setWorkLog({...workLog,startTime:new Date().toISOString(),zona:selectedZona});// üî• Actualizar estado en Firebase y en la zona\ntry{// Actualizar estado del trabajador\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'en_camino',zonaDestino:selectedZona.nombre,recorridoInicio:new Date().toISOString()});// Actualizar estado de la zona a \"en_progreso\"\nif(selectedZona.id){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'en_progreso',ultimaActualizacion:new Date().toISOString()});}// üî• NUEVO: Actualizar estado del veh√≠culo asignado\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'en_uso',operadorEnRuta:currentUser.name||currentUser.email,zonaDestino:selectedZona.nombre,ultimaActualizacion:new Date().toISOString()});console.log('‚úÖ Veh√≠culo marcado como en uso');}console.log('‚úÖ Estado actualizado a \"en_camino\" en Firebase');}catch(error){console.error('Error al actualizar estado en Firebase:',error);}// Calcular y mostrar ruta\nconst request={origin:new window.google.maps.LatLng(userPosition.lat,userPosition.lng),destination:new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng),travelMode:window.google.maps.TravelMode.DRIVING,unitSystem:window.google.maps.UnitSystem.METRIC,region:'CL',avoidHighways:false,avoidTolls:false,provideRouteAlternatives:false// Solo una ruta para simplificar\n};// Primero, limpiar cualquier ruta anterior\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}directionsServiceRef.current.route(request,(result,status)=>{console.log('Estado de la ruta:',status);if(status==='OK'){console.log('‚úÖ Ruta calculada exitosamente');// Configurar el renderer para que siga exactamente la ruta\ndirectionsRendererRef.current.setOptions({directions:result,routeIndex:0,suppressMarkers:false,preserveViewport:false,polylineOptions:{strokeColor:'#4285F4',strokeWeight:5,strokeOpacity:0.8}});const route=result.routes[0];const leg=route.legs[0];setDistance(leg.distance.text);setDuration(leg.duration.text);console.log('üìç Ruta calculada:');console.log('   - Distancia:',leg.distance.text);console.log('   - Duraci√≥n:',leg.duration.text);console.log('   - Pasos:',leg.steps.length);// Ajustar el mapa para mostrar toda la ruta\nconst bounds=new window.google.maps.LatLngBounds();route.overview_path.forEach(point=>{bounds.extend(point);});map.fitBounds(bounds,{top:100,bottom:100,left:50,right:50});}else if(status==='ZERO_RESULTS'){console.warn('‚ö†Ô∏è No hay ruta disponible');// Si no hay ruta por carretera, mostrar l√≠nea directa\nmostrarLineaDirecta();}else if(status==='REQUEST_DENIED'){console.error('‚ùå Solicitud denegada. Verificar API Key');alert('Error: El servicio de rutas no est√° disponible. Verifica la configuraci√≥n de la API.');mostrarLineaDirecta();}else if(status==='OVER_QUERY_LIMIT'){console.error('‚ùå L√≠mite de consultas excedido');alert('Se ha excedido el l√≠mite de consultas. Intenta m√°s tarde.');mostrarLineaDirecta();}else{console.error('‚ùå Error desconocido:',status);mostrarLineaDirecta();}});};// Funci√≥n auxiliar para mostrar l√≠nea directa cuando no hay ruta\nconst mostrarLineaDirecta=()=>{if(!window.google||!map||!userPosition||!selectedZona)return;// Limpiar cualquier ruta anterior\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});// Si hay una polil√≠nea anterior, eliminarla\nif(directionsRendererRef.current.polyline){directionsRendererRef.current.polyline.setMap(null);}}// Calcular distancia en l√≠nea recta\nconst distanceInMeters=window.google.maps.geometry.spherical.computeDistanceBetween(new window.google.maps.LatLng(userPosition.lat,userPosition.lng),new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng));const distanceInKm=(distanceInMeters/1000).toFixed(2);setDistance(`~${distanceInKm} km (directo)`);setDuration('Calculando...');// Crear una polil√≠nea simple entre los dos puntos\nconst line=new window.google.maps.Polyline({path:[new window.google.maps.LatLng(userPosition.lat,userPosition.lng),new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng)],geodesic:true,strokeColor:'#FF5722',strokeOpacity:0.7,strokeWeight:4,map:map,icons:[{icon:{path:'M 0,-1 0,1',strokeOpacity:1,scale:3},offset:'0',repeat:'15px'}]});// Guardar referencia para poder eliminarla despu√©s\ndirectionsRendererRef.current.polyline=line;// Crear marcadores personalizados para inicio y fin\nnew window.google.maps.Marker({position:userPosition,map:map,label:'A',title:'Tu ubicaci√≥n'});new window.google.maps.Marker({position:{lat:selectedZona.lat,lng:selectedZona.lng},map:map,label:'B',title:'Destino'});// Ajustar vista para mostrar ambos puntos\nconst bounds=new window.google.maps.LatLngBounds();bounds.extend(userPosition);bounds.extend({lat:selectedZona.lat,lng:selectedZona.lng});map.fitBounds(bounds,{top:100,bottom:100,left:50,right:50});console.log('üìç Mostrando ruta directa (sin caminos)');};// Manejar llegada a la zona - MEJORADO\nconst handleArrival=async()=>{setWorkStatus('working');const arrivalTime=new Date().toISOString();setWorkLog({...workLog,arrivalTime:arrivalTime});// üî• Actualizar estado en Firebase\ntry{await trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'trabajando',horaLlegada:arrivalTime});// üî• NUEVO: Mantener veh√≠culo en uso pero actualizar ubicaci√≥n\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'en_uso',enZonaTrabajo:true,ultimaActualizacion:new Date().toISOString()});}console.log('‚úÖ Llegada registrada en Firebase');}catch(error){console.error('Error al registrar llegada en Firebase:',error);}// Limpiar la ruta del mapa al llegar\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}console.log('‚úÖ Trabajador ha llegado a la zona y est√° trabajando');};// Finalizar trabajo mejorado con registro de detalles\nconst finishWork=async()=>{const endTime=new Date().toISOString();const tiempoTrabajado=workLog.arrivalTime?Math.floor((new Date(endTime)-new Date(workLog.arrivalTime))/60000):0;// minutos\nconst finalLog={...workLog,endTime:endTime,tiempoTrabajadoMinutos:tiempoTrabajado};setWorkLog(finalLog);setWorkStatus('completed');setIsNavigating(false);setShowWorkLog(true);// Limpiar ruta\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}// üî• Registrar finalizaci√≥n en Firebase y actualizar zona\ntry{// Actualizar estado del trabajador\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'disponible',zonaDestino:null,ultimoTrabajo:{zona:selectedZona.nombre,zonaId:selectedZona.id,horaInicio:workLog.startTime,horaLlegada:workLog.arrivalTime,horaFin:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,completado:true}});// üî• NUEVO: Marcar veh√≠culo como disponible nuevamente\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()});console.log('‚úÖ Veh√≠culo marcado como disponible');}// Marcar zona como completada\nif(selectedZona.id){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'completado',fechaCompletado:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,completadoPor:currentUser.uid,ultimaActualizacion:new Date().toISOString()});}// Crear registro en historial\nconst historialRef=ref(database,`historial_trabajos/${currentUser.uid}/${Date.now()}`);await set(historialRef,{trabajadorId:currentUser.uid,trabajadorNombre:currentUser.name||currentUser.email,zonaId:selectedZona.id,zonaNombre:selectedZona.nombre,zonaDireccion:selectedZona.direccion,horaInicio:workLog.startTime,horaLlegada:workLog.arrivalTime,horaFin:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,estado:'completado',fecha:new Date().toISOString().split('T')[0]});console.log('‚úÖ Trabajo completado y registrado en Firebase');// Mostrar notificaci√≥n de √©xito\nalert('‚úÖ ¬°Excelente trabajo! La tarea ha sido marcada como completada.');}catch(error){console.error('Error al registrar finalizaci√≥n en Firebase:',error);alert('‚ö†Ô∏è Error al guardar. El trabajo se complet√≥ pero hubo un problema al registrarlo.');}console.log('Registro de trabajo:',finalLog);};// Cancelar navegaci√≥n/trabajo\nconst cancelNavigation=async()=>{if(!window.confirm('¬øEst√°s seguro de cancelar el recorrido actual?')){return;}// Limpiar estados\nsetIsNavigating(false);setWorkStatus('idle');setDistance(null);setDuration(null);// Limpiar ruta del mapa\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}// Actualizar estado en Firebase\ntry{await trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'disponible',zonaDestino:null,recorridoCancelado:new Date().toISOString()});// üî• NUEVO: Marcar veh√≠culo como disponible si estaba en uso\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()});console.log('‚úÖ Veh√≠culo liberado y marcado como disponible');}// Si hab√≠a una zona en progreso, cambiarla a pendiente\nif(selectedZona&&selectedZona.id&&workStatus!=='idle'){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'pendiente',ultimaActualizacion:new Date().toISOString()});}console.log('‚úÖ Recorrido cancelado');}catch(error){console.error('Error al cancelar recorrido:',error);}// Mantener la zona seleccionada por si quiere reintentar\nalert('Recorrido cancelado. Puedes iniciar uno nuevo cuando quieras.');};// Resetear para nuevo trabajo\nconst resetWork=()=>{setSelectedZona(null);setWorkStatus('idle');setWorkLog({startTime:null,arrivalTime:null,endTime:null,zona:null});setIsNavigating(false);setDistance(null);setDuration(null);setShowWorkLog(false);if(zonaMarkerRef.current){zonaMarkerRef.current.setMap(null);zonaMarkerRef.current=null;}if(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}};// Formatear tiempo\nconst formatTime=isoString=>{if(!isoString)return'--:--';const date=new Date(isoString);return date.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit',hour12:false});};// Calcular duraci√≥n\nconst calculateDuration=(start,end)=>{if(!start||!end)return'--';const diff=new Date(end)-new Date(start);const hours=Math.floor(diff/3600000);const minutes=Math.floor(diff%3600000/60000);return`${hours}h ${minutes}m`;};// Limpiar al desmontar componente\nuseEffect(()=>{return()=>{// Limpiar GPS al salir\nif(watchIdRef.current){navigator.geolocation.clearWatch(watchIdRef.current);}// Marcar como inactivo en Firebase\nif(currentUser!==null&&currentUser!==void 0&&currentUser.uid){trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'inactivo',ubicacion:null}).catch(console.error);}};},[currentUser]);if(error){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),children:\"Reintentar\"})]});}// Estilos responsivos\nconst styles={container:{width:'100%',height:'100vh',position:'relative',overflow:'hidden'},header:{position:'fixed',top:0,left:0,right:0,background:'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',color:'white',padding:isMobile?'10px 15px':'15px 20px',zIndex:1002,boxShadow:'0 2px 10px rgba(0,0,0,0.1)'},panel:{position:'fixed',top:isMobile?'60px':'70px',left:showPanel?'0':'-100%',width:isMobile?'100%':'400px',maxWidth:'100%',height:isMobile?'auto':'calc(100vh - 70px)',maxHeight:isMobile?'60vh':'calc(100vh - 70px)',background:'white',boxShadow:'2px 0 10px rgba(0,0,0,0.1)',overflowY:'auto',transition:'left 0.3s ease',zIndex:1001,padding:isMobile?'15px':'20px'},map:{width:'100%',height:'100%',position:'absolute',top:0,left:0},button:{width:'100%',padding:isMobile?'14px':'12px',fontSize:isMobile?'16px':'14px',border:'none',borderRadius:'8px',fontWeight:'500',cursor:'pointer',marginBottom:'10px',touchAction:'manipulation'},floatingButton:{position:'fixed',bottom:isMobile?'20px':'30px',right:isMobile?'20px':'30px',width:isMobile?'60px':'50px',height:isMobile?'60px':'50px',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 4px 12px rgba(0,0,0,0.2)',zIndex:1000,cursor:'pointer',fontSize:isMobile?'24px':'20px'}};return/*#__PURE__*/_jsxs(\"div\",{style:styles.container,children:[/*#__PURE__*/_jsx(\"div\",{ref:mapRef,style:styles.map}),/*#__PURE__*/_jsx(\"div\",{style:styles.header,children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:isMobile?'wrap':'nowrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowPanel(!showPanel),style:{padding:isMobile?'8px':'6px 10px',background:'rgba(255,255,255,0.2)',color:'white',border:'1px solid rgba(255,255,255,0.3)',borderRadius:'6px',cursor:'pointer',fontSize:isMobile?'20px':'14px',touchAction:'manipulation'},children:showPanel?'‚ò∞':'‚ò∞'}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"h1\",{style:{margin:0,fontSize:isMobile?'18px':'20px',fontWeight:'600'},children:[\"\\uD83D\\uDC77\\u200D\\u2642\\uFE0F \",currentUser.name||'Trabajador']})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onLogout,style:{padding:isMobile?'6px 10px':'8px 16px',background:'rgba(255,255,255,0.2)',color:'white',border:'1px solid rgba(255,255,255,0.3)',borderRadius:'6px',cursor:'pointer',fontSize:isMobile?'12px':'14px',touchAction:'manipulation'},children:\"Salir\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:styles.panel,children:[notificaciones.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px',padding:'10px',background:'#fef3c7',border:'1px solid #fde68a',borderRadius:'8px'},children:[/*#__PURE__*/_jsxs(\"h4\",{style:{margin:'0 0 8px 0',fontSize:'14px',color:'#92400e'},children:[\"\\uD83D\\uDD14 Nuevas notificaciones (\",notificaciones.length,\")\"]}),notificaciones.map(notif=>/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',marginBottom:'4px'},children:[\"\\u2022 \",notif.mensaje]},notif.id))]}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleGPS,style:{...styles.button,background:isTracking?'#ef4444':'#22c55e',color:'white'},children:isTracking?'üìç Desactivar GPS':'üìç Activar GPS'}),gpsStatus!=='inactive'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px',padding:'8px',borderRadius:'6px',fontSize:'12px',textAlign:'center',background:gpsStatus==='active'?'#dcfce7':gpsStatus==='activating'?'#fef3c7':'#fee2e2',color:gpsStatus==='active'?'#166534':gpsStatus==='activating'?'#92400e':'#991b1b'},children:[gpsStatus==='active'&&'üü¢ GPS activo',gpsStatus==='activating'&&'üü° Activando GPS...',gpsStatus==='error'&&'üî¥ Error en GPS']}),isTracking&&workStatus==='idle'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontSize:'14px',fontWeight:'500'},children:\"\\uD83C\\uDFD7\\uFE0F Zona de Trabajo:\"}),zonasAsignadas.length>0?/*#__PURE__*/_jsxs(\"select\",{value:(selectedZona===null||selectedZona===void 0?void 0:selectedZona.id)||'',onChange:e=>{const zona=zonasAsignadas.find(z=>z.id===e.target.value);if(zona)selectZona(zona);},style:{width:'100%',padding:'10px',borderRadius:'6px',border:'1px solid #ddd',fontSize:isMobile?'16px':'14px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Seleccionar --\"}),zonasAsignadas.map(zona=>/*#__PURE__*/_jsx(\"option\",{value:zona.id,children:zona.nombre},zona.id))]}):/*#__PURE__*/_jsx(\"div\",{style:{padding:'10px',background:'#f3f4f6',borderRadius:'6px',textAlign:'center',fontSize:'13px',color:'#6b7280'},children:\"No hay zonas asignadas\"})]}),selectedZona&&workStatus==='idle'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f0f9ff',padding:'12px',borderRadius:'8px',marginBottom:'15px',border:'1px solid #bae6fd'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 8px 0',color:'#0369a1',fontSize:'14px'},children:selectedZona.nombre}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:0,fontSize:'12px',color:'#333'},children:[\"\\uD83D\\uDCCD \",selectedZona.direccion]})]}),workStatus==='idle'&&selectedZona&&userPosition&&/*#__PURE__*/_jsx(\"button\",{onClick:startNavigation,style:{...styles.button,background:'#3b82f6',color:'white'},children:\"\\uD83D\\uDE97 Iniciar Recorrido\"}),workStatus==='traveling'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fef3c7',padding:'12px',borderRadius:'8px',marginBottom:'12px',border:'1px solid #fde68a'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px',fontWeight:'500',color:'#92400e'},children:\"\\uD83D\\uDE97 En camino a la zona\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',marginTop:'4px',color:'#78350f'},children:[\"\\uD83D\\uDCCD \",selectedZona===null||selectedZona===void 0?void 0:selectedZona.nombre]}),distance&&duration&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'8px',fontSize:'13px'},children:[\"\\uD83D\\uDCCF \",distance,\" \\u2022 \\u23F1\\uFE0F \",duration]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{handleArrival();},style:{...styles.button,background:'#10b981',color:'white',fontSize:isMobile?'16px':'14px',fontWeight:'600',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px'},children:\"\\uD83D\\uDCCD Ya llegu\\xE9 a la zona\"}),/*#__PURE__*/_jsx(\"button\",{onClick:cancelNavigation,style:{...styles.button,background:'white',color:'#ef4444',border:'2px solid #ef4444'},children:\"\\u274C Cancelar Recorrido\"})]}),workStatus==='working'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#dcfce7',padding:'15px',borderRadius:'8px',marginBottom:'15px',border:'2px solid #22c55e'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:isMobile?'18px':'16px',fontWeight:'600',color:'#14532d',marginBottom:'8px'},children:\"\\uD83D\\uDD27 TRABAJANDO EN ZONA\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#166534'},children:[\"\\uD83D\\uDCCD \",selectedZona===null||selectedZona===void 0?void 0:selectedZona.nombre]}),(selectedZona===null||selectedZona===void 0?void 0:selectedZona.descripcion)&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',padding:'8px',background:'#f0fdf4',borderRadius:'6px',fontSize:'13px',color:'#15803d'},children:[\"\\uD83D\\uDCCB \",selectedZona.descripcion]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',marginTop:'8px',color:'#166534'},children:[\"\\u23F0 Llegada: \",formatTime(workLog.arrivalTime)]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('¬øConfirmas que has completado toda la tarea asignada?')){finishWork();}},style:{...styles.button,background:'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',color:'white',padding:isMobile?'18px':'16px',fontSize:isMobile?'18px':'16px',fontWeight:'700',boxShadow:'0 4px 12px rgba(34, 197, 94, 0.3)',textTransform:'uppercase',letterSpacing:'0.5px'},children:\"\\u2705 MARCAR TAREA COMO COMPLETADA\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'12px',color:'#6b7280',textAlign:'center',margin:'8px 0'},children:\"Presiona cuando hayas terminado todo el trabajo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('¬øCancelar el trabajo? La zona volver√° a estado pendiente.')){cancelNavigation();}},style:{...styles.button,background:'white',color:'#ef4444',border:'2px solid #ef4444',fontSize:isMobile?'14px':'13px'},children:\"\\u274C No puedo completar la tarea\"})]}),workStatus==='completed'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{background:'#e0e7ff',padding:'12px',borderRadius:'8px',marginBottom:'12px',border:'1px solid #c7d2fe',textAlign:'center'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px',fontWeight:'500',color:'#312e81'},children:\"\\u2705 Trabajo Completado\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:resetWork,style:{...styles.button,background:'#22c55e',color:'white'},children:\"\\uD83D\\uDD04 Nuevo Trabajo\"})]})]}),!showPanel&&workStatus!=='idle'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowPanel(true),style:{...styles.floatingButton,background:workStatus==='traveling'?'#f59e0b':workStatus==='working'?'#3b82f6':'#22c55e',color:'white',border:'none'},children:[workStatus==='traveling'&&'üöó',workStatus==='working'&&'üîß',workStatus==='completed'&&'‚úÖ']}),showWorkLog&&workLog.zona&&/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:2000,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'white',borderRadius:'12px',padding:isMobile?'15px':'20px',maxWidth:isMobile?'100%':'400px',width:'100%',maxHeight:'80vh',overflow:'auto'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'#1f2937',fontSize:isMobile?'18px':'20px'},children:\"\\uD83D\\uDCCB Resumen del Trabajo\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:isMobile?'13px':'14px',lineHeight:'1.8'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:workLog.zona.nombre}),/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83D\\uDCCD \",workLog.zona.direccion]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f8fafc',padding:'12px',borderRadius:'8px',marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u23F1\\uFE0F Tiempo trabajado: \",calculateDuration(workLog.arrivalTime,workLog.endTime)]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'10px',padding:'8px',background:'#dcfce7',borderRadius:'6px',textAlign:'center',fontWeight:'bold',color:'#166534'},children:\"\\u2705 COMPLETADO\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowWorkLog(false),style:{...styles.button,background:'#6b7280',color:'white'},children:\"Cerrar\"})]})]})}),!mapLoaded&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',textAlign:'center',zIndex:1001},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'50px',height:'50px',border:'4px solid #f3f3f3',borderTop:'4px solid #22c55e',borderRadius:'50%',animation:'spin 1s linear infinite'}}),/*#__PURE__*/_jsx(\"p\",{style:{marginTop:'10px',color:'#666'},children:\"Cargando mapa...\"})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      `})]});};export default SistemaTrabajadoresFirebase;","map":{"version":3,"names":["React","useEffect","useRef","useState","trabajadoresService","database","ref","onValue","update","set","jsx","_jsx","jsxs","_jsxs","SistemaTrabajadoresFirebase","_ref","currentUser","onLogout","console","log","mapRef","map","setMap","userPosition","setUserPosition","selectedZona","setSelectedZona","isTracking","setIsTracking","isNavigating","setIsNavigating","workStatus","setWorkStatus","workLog","setWorkLog","startTime","arrivalTime","endTime","zona","zonasAsignadas","setZonasAsignadas","notificaciones","setNotificaciones","showPanel","setShowPanel","isMobile","setIsMobile","userMarkerRef","zonaMarkerRef","directionsServiceRef","directionsRendererRef","watchIdRef","lastUpdateRef","mapLoaded","setMapLoaded","error","setError","distance","setDistance","duration","setDuration","showWorkLog","setShowWorkLog","gpsStatus","setGpsStatus","API_KEY","checkMobile","window","innerWidth","addEventListener","removeEventListener","uid","zonasRef","unsubZonas","snapshot","data","val","zonasArray","Object","entries","filter","_ref2","id","trabajadorAsignado","estado","_ref3","notifRef","unsubNotif","notifArray","_ref4","notif","trabajadorId","leido","_ref5","createOrUpdateTrabajador","nombre","name","email","telefono","phone","vehicleId","rol","ubicacion","createdAt","Date","toISOString","ultimaActualizacion","then","catch","loadGoogleMaps","Promise","resolve","reject","google","maps","existingScript","document","querySelector","Error","script","createElement","src","async","defer","onload","onerror","head","appendChild","initMap","current","mapInstance","Map","center","lat","lng","zoom","mapTypeId","zoomControl","mapTypeControl","scaleControl","streetViewControl","rotateControl","fullscreenControl","gestureHandling","DirectionsService","DirectionsRenderer","suppressMarkers","polylineOptions","strokeColor","strokeWeight","strokeOpacity","markerOptions","startMarker","label","title","endMarker","preserveViewport","err","message","updateUserPosition","position","accuracy","ahora","now","updateTrabajadorLocation","timestamp","estadoActual","updateTrabajadorData","zonaDestino","Marker","icon","path","SymbolPath","CIRCLE","scale","fillColor","fillOpacity","zIndex","setCenter","setZoom","setPosition","geometry","spherical","computeDistanceBetween","LatLng","Math","round","toggleGPS","navigator","geolocation","clearWatch","vehicleRef","operadorEnRuta","enZonaTrabajo","alert","getCurrentPosition","coords","pos","latitude","longitude","enableHighAccuracy","timeout","maximumAge","warn","code","PERMISSION_DENIED","error2","testPosition","random","gpsWatchId","watchPosition","distanceFilter","selectZona","BACKWARD_CLOSED_ARROW","bounds","LatLngBounds","extend","fitBounds","startNavigation","recorridoInicio","request","origin","destination","travelMode","TravelMode","DRIVING","unitSystem","UnitSystem","METRIC","region","avoidHighways","avoidTolls","provideRouteAlternatives","setDirections","routes","route","result","status","setOptions","directions","routeIndex","leg","legs","text","steps","length","overview_path","forEach","point","top","bottom","left","right","mostrarLineaDirecta","polyline","distanceInMeters","distanceInKm","toFixed","line","Polyline","geodesic","icons","offset","repeat","handleArrival","horaLlegada","finishWork","tiempoTrabajado","floor","finalLog","tiempoTrabajadoMinutos","ultimoTrabajo","zonaId","horaInicio","horaFin","completado","fechaCompletado","completadoPor","historialRef","trabajadorNombre","zonaNombre","zonaDireccion","direccion","fecha","split","cancelNavigation","confirm","recorridoCancelado","resetWork","formatTime","isoString","date","toLocaleTimeString","hour","minute","hour12","calculateDuration","start","end","diff","hours","minutes","style","padding","textAlign","children","onClick","location","reload","styles","container","width","height","overflow","header","background","color","boxShadow","panel","maxWidth","maxHeight","overflowY","transition","button","fontSize","border","borderRadius","fontWeight","cursor","marginBottom","touchAction","floatingButton","display","alignItems","justifyContent","flexWrap","gap","margin","mensaje","value","onChange","e","find","z","target","marginTop","descripcion","textTransform","letterSpacing","lineHeight","transform","borderTop","animation"],"sources":["C:/Users/Izan/Desktop/AppReact/mapa-quillon/src/components/SistemaTrabajadoresFirebase.js"],"sourcesContent":["// src/components/SistemaTrabajadoresFirebase.js\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { trabajadoresService } from '../services/firebaseservices';\r\nimport { database } from '../config/firebase';\r\nimport { ref, onValue, update, set } from 'firebase/database';\r\n\r\nconst SistemaTrabajadoresFirebase = ({ currentUser, onLogout }) => {\r\n  // Log para debugging\r\n  console.log('üîç Current User Data:', currentUser);\r\n  \r\n  // Estados principales\r\n  const mapRef = useRef(null);\r\n  const [map, setMap] = useState(null);\r\n  const [userPosition, setUserPosition] = useState(null);\r\n  const [selectedZona, setSelectedZona] = useState(null);\r\n  const [isTracking, setIsTracking] = useState(false);\r\n  const [isNavigating, setIsNavigating] = useState(false);\r\n  const [workStatus, setWorkStatus] = useState('idle'); // idle, traveling, working, completed\r\n  const [workLog, setWorkLog] = useState({\r\n    startTime: null,\r\n    arrivalTime: null,\r\n    endTime: null,\r\n    zona: null\r\n  });\r\n  \r\n  // Estados para zonas y notificaciones\r\n  const [zonasAsignadas, setZonasAsignadas] = useState([]);\r\n  const [notificaciones, setNotificaciones] = useState([]);\r\n  const [showPanel, setShowPanel] = useState(true); // Estado para mostrar/ocultar panel\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  \r\n  // Referencias para marcadores y servicios\r\n  const userMarkerRef = useRef(null);\r\n  const zonaMarkerRef = useRef(null);\r\n  const directionsServiceRef = useRef(null);\r\n  const directionsRendererRef = useRef(null);\r\n  const watchIdRef = useRef(null);\r\n  const lastUpdateRef = useRef(null);\r\n  \r\n  // Estados de UI\r\n  const [mapLoaded, setMapLoaded] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [distance, setDistance] = useState(null);\r\n  const [duration, setDuration] = useState(null);\r\n  const [showWorkLog, setShowWorkLog] = useState(false);\r\n  const [gpsStatus, setGpsStatus] = useState('inactive'); // inactive, activating, active, error\r\n\r\n  const API_KEY = 'AIzaSyA7DrdL36n5cx-RNzuXGAQggFeGCheHDbY';\r\n\r\n  // Detectar si es m√≥vil\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth <= 768);\r\n    };\r\n    \r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    \r\n    return () => window.removeEventListener('resize', checkMobile);\r\n  }, []);\r\n\r\n  // Cargar zonas asignadas desde Firebase\r\n  useEffect(() => {\r\n    if (currentUser && currentUser.uid) {\r\n      console.log('üîÑ Cargando zonas asignadas para trabajador:', currentUser.uid);\r\n      \r\n      // Escuchar zonas asignadas al trabajador\r\n      const zonasRef = ref(database, 'zonas_asignadas');\r\n      const unsubZonas = onValue(zonasRef, (snapshot) => {\r\n        const data = snapshot.val();\r\n        console.log('üì¶ Datos de zonas recibidos:', data);\r\n        \r\n        if (data) {\r\n          // Filtrar solo las zonas asignadas a este trabajador\r\n          const zonasArray = Object.entries(data)\r\n            .filter(([id, zona]) => {\r\n              console.log(`Zona ${id}: asignada a ${zona.trabajadorAsignado}, yo soy ${currentUser.uid}`);\r\n              return zona.trabajadorAsignado === currentUser.uid && zona.estado !== 'completado';\r\n            })\r\n            .map(([id, zona]) => ({\r\n              id,\r\n              ...zona\r\n            }));\r\n          \r\n          console.log('‚úÖ Zonas asignadas filtradas:', zonasArray);\r\n          setZonasAsignadas(zonasArray);\r\n        } else {\r\n          console.log('‚ö†Ô∏è No hay zonas en Firebase');\r\n          setZonasAsignadas([]);\r\n        }\r\n      });\r\n\r\n      // Escuchar notificaciones\r\n      const notifRef = ref(database, 'notificaciones');\r\n      const unsubNotif = onValue(notifRef, (snapshot) => {\r\n        const data = snapshot.val();\r\n        if (data) {\r\n          const notifArray = Object.entries(data)\r\n            .filter(([id, notif]) => notif.trabajadorId === currentUser.uid && !notif.leido)\r\n            .map(([id, notif]) => ({\r\n              id,\r\n              ...notif\r\n            }));\r\n          setNotificaciones(notifArray);\r\n        }\r\n      });\r\n\r\n      return () => {\r\n        unsubZonas();\r\n        unsubNotif();\r\n      };\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Registrar trabajador al montar el componente\r\n  useEffect(() => {\r\n    if (currentUser && currentUser.uid) {\r\n      console.log('üîÑ Registrando trabajador al iniciar...');\r\n      \r\n      // Crear o actualizar el trabajador en Realtime Database\r\n      trabajadoresService.createOrUpdateTrabajador(currentUser.uid, {\r\n        nombre: currentUser.name || currentUser.email || 'Trabajador',\r\n        email: currentUser.email,\r\n        telefono: currentUser.phone || '',\r\n        vehicleId: currentUser.vehicleId || null,\r\n        estado: 'inactivo',\r\n        rol: 'trabajador',\r\n        ubicacion: null,\r\n        createdAt: new Date().toISOString(),\r\n        ultimaActualizacion: new Date().toISOString()\r\n      }).then(() => {\r\n        console.log('‚úÖ Trabajador registrado en Realtime Database al iniciar');\r\n      }).catch(error => {\r\n        console.error('‚ùå Error al registrar trabajador al iniciar:', error);\r\n      });\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Funci√≥n para cargar Google Maps\r\n  useEffect(() => {\r\n    const loadGoogleMaps = () => {\r\n      return new Promise((resolve, reject) => {\r\n        if (window.google && window.google.maps) {\r\n          resolve(window.google.maps);\r\n          return;\r\n        }\r\n\r\n        const existingScript = document.querySelector('script[src*=\"maps.googleapis.com\"]');\r\n        if (existingScript) {\r\n          existingScript.addEventListener('load', () => {\r\n            if (window.google && window.google.maps) {\r\n              resolve(window.google.maps);\r\n            } else {\r\n              reject(new Error('Google Maps no disponible'));\r\n            }\r\n          });\r\n          return;\r\n        }\r\n\r\n        const script = document.createElement('script');\r\n        script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places,geometry&v=weekly`;\r\n        script.async = true;\r\n        script.defer = true;\r\n\r\n        script.onload = () => {\r\n          if (window.google && window.google.maps) {\r\n            resolve(window.google.maps);\r\n          } else {\r\n            reject(new Error('Google Maps no disponible'));\r\n          }\r\n        };\r\n\r\n        script.onerror = () => {\r\n          reject(new Error('Error al cargar Google Maps'));\r\n        };\r\n\r\n        document.head.appendChild(script);\r\n      });\r\n    };\r\n\r\n    const initMap = async () => {\r\n      try {\r\n        const maps = await loadGoogleMaps();\r\n        \r\n        if (!mapRef.current) return;\r\n\r\n        const mapInstance = new maps.Map(mapRef.current, {\r\n          center: { lat: -36.7333, lng: -72.4667 },\r\n          zoom: 13,\r\n          mapTypeId: 'roadmap',\r\n          zoomControl: !isMobile,\r\n          mapTypeControl: false,\r\n          scaleControl: false,\r\n          streetViewControl: false,\r\n          rotateControl: false,\r\n          fullscreenControl: true,\r\n          gestureHandling: 'greedy' // Mejor para m√≥viles\r\n        });\r\n\r\n        setMap(mapInstance);\r\n        \r\n        // Inicializar servicios de direcciones\r\n        // Inicializar servicios de direcciones\r\ndirectionsServiceRef.current = new maps.DirectionsService();\r\ndirectionsRendererRef.current = new maps.DirectionsRenderer({\r\n  map: mapInstance,\r\n  suppressMarkers: false, // Mostrar marcadores A y B\r\n  polylineOptions: {\r\n    strokeColor: '#4285F4',\r\n    strokeWeight: 6,\r\n    strokeOpacity: 0.8\r\n  },\r\n  // Agregar estas opciones para mejor visualizaci√≥n\r\n  markerOptions: {\r\n    startMarker: {\r\n      label: 'A',\r\n      title: 'Tu ubicaci√≥n'\r\n    },\r\n    endMarker: {\r\n      label: 'B', \r\n      title: 'Zona de trabajo'\r\n    }\r\n  },\r\n  preserveViewport: false // Ajustar vista autom√°ticamente a la ruta\r\n});\r\n\r\n        setMapLoaded(true);\r\n      } catch (err) {\r\n        setError('Error al cargar el mapa: ' + err.message);\r\n      }\r\n    };\r\n\r\n    initMap();\r\n  }, [isMobile]);\r\n\r\n  // üî• FUNCI√ìN CR√çTICA - Actualizar posici√≥n del usuario Y ENVIAR A FIREBASE\r\n  const updateUserPosition = (position) => {\r\n    console.log('üîÑ Actualizando posici√≥n:', position);\r\n    setUserPosition(position);\r\n    \r\n    // Mostrar precisi√≥n en el UI\r\n    if (window.google && map) {\r\n      // Opcional: Mostrar c√≠rculo de precisi√≥n en el mapa\r\n      const accuracy = position.accuracy || 100;\r\n      console.log('üìç Precisi√≥n actual:', accuracy, 'metros');\r\n    }\r\n    \r\n    // üî• ENVIAR UBICACI√ìN A FIREBASE - ESTO ES LO QUE FALTABA\r\n    // Solo actualizar si ha pasado al menos 5 segundos desde la √∫ltima actualizaci√≥n\r\n    const ahora = Date.now();\r\n    if (!lastUpdateRef.current || (ahora - lastUpdateRef.current) > 5000) {\r\n      console.log('üìç Enviando ubicaci√≥n a Firebase:', position);\r\n      \r\n      if (currentUser && currentUser.uid) {\r\n        // Actualizar ubicaci√≥n en Firebase\r\n        trabajadoresService.updateTrabajadorLocation(currentUser.uid, {\r\n          lat: position.lat,\r\n          lng: position.lng,\r\n          timestamp: new Date().toISOString(),\r\n          accuracy: position.accuracy || null // Guardar precisi√≥n tambi√©n\r\n        }).then(() => {\r\n          console.log('‚úÖ Ubicaci√≥n enviada a Firebase exitosamente');\r\n          console.log('   - Trabajador ID:', currentUser.uid);\r\n          console.log('   - Posici√≥n:', position);\r\n        }).catch(error => {\r\n          console.error('‚ùå Error al enviar ubicaci√≥n a Firebase:', error);\r\n          console.error('   - Detalles:', error.message);\r\n        });\r\n        \r\n        // Tambi√©n actualizar el estado del trabajador si es necesario\r\n        const estadoActual = workStatus === 'traveling' ? 'en_camino' : \r\n                            workStatus === 'working' ? 'trabajando' : \r\n                            'disponible';\r\n        \r\n        // Actualizar datos adicionales del trabajador\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          nombre: currentUser.name || currentUser.email,\r\n          email: currentUser.email,\r\n          estado: estadoActual,\r\n          zonaDestino: selectedZona ? selectedZona.nombre : null,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('‚úÖ Datos del trabajador actualizados');\r\n        }).catch(error => {\r\n          console.error('‚ùå Error al actualizar datos del trabajador:', error);\r\n        });\r\n        \r\n        lastUpdateRef.current = ahora;\r\n      }\r\n    }\r\n    \r\n    // Actualizar marcador en el mapa local\r\n    if (!map || !window.google) return;\r\n\r\n    // Crear o actualizar marcador del usuario\r\n    if (!userMarkerRef.current) {\r\n      userMarkerRef.current = new window.google.maps.Marker({\r\n        position: position,\r\n        map: map,\r\n        title: 'Tu ubicaci√≥n',\r\n        icon: {\r\n          path: window.google.maps.SymbolPath.CIRCLE,\r\n          scale: 10,\r\n          fillColor: '#4285F4',\r\n          fillOpacity: 1,\r\n          strokeColor: '#ffffff',\r\n          strokeWeight: 3\r\n        },\r\n        zIndex: 1000\r\n      });\r\n      \r\n      // Centrar mapa en usuario\r\n      map.setCenter(position);\r\n      map.setZoom(15);\r\n    } else {\r\n      userMarkerRef.current.setPosition(position);\r\n    }\r\n\r\n    // Si est√° navegando, actualizar distancia pero NO cambiar autom√°ticamente a working\r\n    if (isNavigating && selectedZona) {\r\n      const distance = window.google.maps.geometry.spherical.computeDistanceBetween(\r\n        new window.google.maps.LatLng(position.lat, position.lng),\r\n        new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng)\r\n      );\r\n      \r\n      // Solo mostrar distancia, no cambiar estado autom√°ticamente\r\n      console.log('üìè Distancia a la zona:', Math.round(distance), 'metros');\r\n    }\r\n  };\r\n\r\n  // Funci√≥n para activar/desactivar GPS\r\n  const toggleGPS = () => {\r\n    if (isTracking) {\r\n      // Detener tracking\r\n      if (watchIdRef.current) {\r\n        navigator.geolocation.clearWatch(watchIdRef.current);\r\n        watchIdRef.current = null;\r\n      }\r\n      setIsTracking(false);\r\n      setGpsStatus('inactive');\r\n      \r\n      // Mantener √∫ltima posici√≥n para la pr√≥xima activaci√≥n\r\n      console.log('üìç GPS desactivado, √∫ltima ubicaci√≥n guardada:', userPosition);\r\n      \r\n      // Limpiar marcador de usuario\r\n      if (userMarkerRef.current) {\r\n        userMarkerRef.current.setMap(null);\r\n        userMarkerRef.current = null;\r\n      }\r\n      \r\n      // Limpiar ubicaci√≥n en Firebase al desactivar GPS (sin await)\r\n      if (currentUser && currentUser.uid) {\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          estado: 'inactivo',\r\n          // NO borrar la ubicaci√≥n, solo marcar como inactivo\r\n          // ubicacion: null, // COMENTADO - mantener √∫ltima ubicaci√≥n\r\n          ultimaActualizacion: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('üìç GPS desactivado - Estado actualizado a inactivo');\r\n        }).catch(error => {\r\n          console.error('Error al actualizar estado en Firebase:', error);\r\n        });\r\n        \r\n        // üî• NUEVO: Si hay un veh√≠culo asignado y est√° en uso, liberarlo\r\n        if (currentUser.vehicleId && (workStatus === 'traveling' || workStatus === 'working')) {\r\n          const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n          update(vehicleRef, {\r\n            estado: 'disponible',\r\n            operadorEnRuta: null,\r\n            zonaDestino: null,\r\n            enZonaTrabajo: false,\r\n            ultimaActualizacion: new Date().toISOString()\r\n          }).then(() => {\r\n            console.log('‚úÖ Veh√≠culo liberado al desactivar GPS');\r\n          }).catch(error => {\r\n            console.error('Error al liberar veh√≠culo:', error);\r\n          });\r\n        }\r\n      }\r\n      \r\n      // Mantener √∫ltima posici√≥n conocida\r\n      console.log('üìç √öltima ubicaci√≥n conocida guardada:', userPosition);\r\n    } else {\r\n      // Iniciar tracking\r\n      if (!navigator.geolocation) {\r\n        alert('Tu navegador no soporta geolocalizaci√≥n');\r\n        setGpsStatus('error');\r\n        return;\r\n      }\r\n\r\n      console.log('üîÑ Iniciando GPS...');\r\n      setIsTracking(true);\r\n      setGpsStatus('activating');\r\n      \r\n      // Registrar el trabajador en Firebase si no existe (sin bloquear)\r\n      if (currentUser && currentUser.uid) {\r\n        console.log('üìù Registrando trabajador en Realtime Database...');\r\n        console.log('   - User ID:', currentUser.uid);\r\n        console.log('   - Datos:', currentUser);\r\n        \r\n        trabajadoresService.createOrUpdateTrabajador(currentUser.uid, {\r\n          nombre: currentUser.name || currentUser.email || 'Trabajador',\r\n          email: currentUser.email,\r\n          telefono: currentUser.phone || '',\r\n          estado: 'disponible',\r\n          rol: 'trabajador',\r\n          vehicleId: currentUser.vehicleId || null,\r\n          createdAt: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('‚úÖ Trabajador registrado en Realtime Database');\r\n          console.log('   - Path: trabajadores/' + currentUser.uid);\r\n        }).catch(error => {\r\n          console.error('‚ùå Error al registrar trabajador:', error);\r\n          console.error('   - Detalles:', error.message);\r\n        });\r\n      } else {\r\n        console.error('‚ö†Ô∏è No hay currentUser o uid disponible');\r\n      }\r\n      \r\n      // Obtener posici√≥n inicial con ALTA PRECISI√ìN\r\n      console.log('üìç Intentando obtener ubicaci√≥n GPS de alta precisi√≥n...');\r\n      \r\n      // Si ya tenemos una posici√≥n previa, usarla mientras obtenemos la nueva\r\n      if (userPosition) {\r\n        console.log('üìç Usando √∫ltima ubicaci√≥n conocida mientras se obtiene GPS de alta precisi√≥n');\r\n        setGpsStatus('active');\r\n        \r\n        // Intentar obtener ubicaci√≥n de ALTA PRECISI√ìN en segundo plano\r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            console.log('üìç GPS de alta precisi√≥n actualizado:', position.coords);\r\n            console.log('   - Precisi√≥n:', position.coords.accuracy, 'metros');\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n          },\r\n          (error) => {\r\n            console.log('‚ö†Ô∏è GPS de alta precisi√≥n no disponible, usando precisi√≥n normal');\r\n          },\r\n          {\r\n            enableHighAccuracy: true, // üî¥ ALTA PRECISI√ìN\r\n            timeout: 20000, // M√°s tiempo para alta precisi√≥n\r\n            maximumAge: 0 // No usar cach√©, queremos ubicaci√≥n fresca\r\n          }\r\n        );\r\n      } else {\r\n        // Primera vez - intentar con alta precisi√≥n\r\n        setGpsStatus('activating');\r\n        \r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            console.log('‚úÖ GPS de alta precisi√≥n obtenido:', position.coords);\r\n            console.log('   - Precisi√≥n:', position.coords.accuracy, 'metros');\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n            setGpsStatus('active');\r\n          },\r\n          (error) => {\r\n            console.warn('‚ö†Ô∏è Alta precisi√≥n fall√≥, intentando con precisi√≥n normal:', error.message);\r\n            \r\n            if (error.code === error.PERMISSION_DENIED) {\r\n              alert('Por favor, habilita los permisos de ubicaci√≥n en tu navegador');\r\n              setIsTracking(false);\r\n              setGpsStatus('error');\r\n              return;\r\n            }\r\n            \r\n            // Segundo intento con precisi√≥n normal\r\n            navigator.geolocation.getCurrentPosition(\r\n              (position) => {\r\n                console.log('üìç GPS con precisi√≥n normal:', position.coords);\r\n                console.log('   - Precisi√≥n:', position.coords.accuracy, 'metros');\r\n                const pos = {\r\n                  lat: position.coords.latitude,\r\n                  lng: position.coords.longitude,\r\n                  accuracy: position.coords.accuracy\r\n                };\r\n                updateUserPosition(pos);\r\n                setGpsStatus('active');\r\n              },\r\n              (error2) => {\r\n                console.error('‚ùå No se pudo obtener GPS:', error2);\r\n                // √öltima opci√≥n: ubicaci√≥n de respaldo\r\n                const testPosition = {\r\n                  lat: -36.7508 + (Math.random() - 0.5) * 0.001,\r\n                  lng: -72.4698 + (Math.random() - 0.5) * 0.001,\r\n                  accuracy: 100\r\n                };\r\n                updateUserPosition(testPosition);\r\n                setGpsStatus('active');\r\n              },\r\n              {\r\n                enableHighAccuracy: false, // Precisi√≥n normal\r\n                timeout: 10000,\r\n                maximumAge: 30000\r\n              }\r\n            );\r\n          },\r\n          {\r\n            enableHighAccuracy: true, // üî¥ ALTA PRECISI√ìN primero\r\n            timeout: 15000, // 15 segundos para alta precisi√≥n\r\n            maximumAge: 0 // No usar cach√©\r\n          }\r\n        );\r\n      }\r\n\r\n      // Seguimiento continuo con ALTA PRECISI√ìN\r\n      const gpsWatchId = navigator.geolocation.watchPosition(\r\n        (position) => {\r\n          console.log('üìç GPS - Actualizaci√≥n:', position.coords);\r\n          console.log('   - Precisi√≥n:', position.coords.accuracy, 'metros');\r\n          \r\n          // Solo actualizar si la precisi√≥n es mejor que 150 metros\r\n          if (position.coords.accuracy <= 150) {\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n            setGpsStatus('active');\r\n          } else {\r\n            console.log('‚ö†Ô∏è Precisi√≥n insuficiente, esperando mejor se√±al...');\r\n          }\r\n        },\r\n        (error) => {\r\n          console.log('‚è±Ô∏è Esperando se√±al GPS...', error.message);\r\n        },\r\n        {\r\n          enableHighAccuracy: true, // üî¥ ALTA PRECISI√ìN\r\n          timeout: 30000,\r\n          maximumAge: 0, // Siempre ubicaci√≥n fresca\r\n          distanceFilter: 5 // Actualizar cada 5 metros de movimiento\r\n        }\r\n      );\r\n      \r\n      watchIdRef.current = gpsWatchId;\r\n    }\r\n  };\r\n\r\n  // Seleccionar zona de trabajo\r\n  const selectZona = (zona) => {\r\n    setSelectedZona(zona);\r\n    \r\n    if (!map || !window.google) return;\r\n\r\n    // Limpiar marcador anterior\r\n    if (zonaMarkerRef.current) {\r\n      zonaMarkerRef.current.setMap(null);\r\n    }\r\n\r\n    // Crear marcador de zona\r\n    zonaMarkerRef.current = new window.google.maps.Marker({\r\n      position: { lat: zona.lat, lng: zona.lng },\r\n      map: map,\r\n      title: zona.nombre,\r\n      icon: {\r\n        path: window.google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,\r\n        scale: 8,\r\n        fillColor: '#22c55e',\r\n        fillOpacity: 1,\r\n        strokeColor: '#ffffff',\r\n        strokeWeight: 2\r\n      }\r\n    });\r\n\r\n    // Ajustar vista para mostrar ambos puntos\r\n    if (userPosition) {\r\n      const bounds = new window.google.maps.LatLngBounds();\r\n      bounds.extend(userPosition);\r\n      bounds.extend({ lat: zona.lat, lng: zona.lng });\r\n      map.fitBounds(bounds, 100);\r\n    } else {\r\n      map.setCenter({ lat: zona.lat, lng: zona.lng });\r\n      map.setZoom(15);\r\n    }\r\n  };\r\n\r\n  // Iniciar navegaci√≥n\r\n  const startNavigation = async () => {\r\n    if (!selectedZona || !userPosition) {\r\n      alert('Debes activar el GPS y seleccionar una zona primero');\r\n      return;\r\n    }\r\n\r\n    setIsNavigating(true);\r\n    setWorkStatus('traveling');\r\n    setWorkLog({\r\n      ...workLog,\r\n      startTime: new Date().toISOString(),\r\n      zona: selectedZona\r\n    });\r\n\r\n    // üî• Actualizar estado en Firebase y en la zona\r\n    try {\r\n      // Actualizar estado del trabajador\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'en_camino',\r\n        zonaDestino: selectedZona.nombre,\r\n        recorridoInicio: new Date().toISOString()\r\n      });\r\n      \r\n      // Actualizar estado de la zona a \"en_progreso\"\r\n      if (selectedZona.id) {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'en_progreso',\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      // üî• NUEVO: Actualizar estado del veh√≠culo asignado\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'en_uso',\r\n          operadorEnRuta: currentUser.name || currentUser.email,\r\n          zonaDestino: selectedZona.nombre,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('‚úÖ Veh√≠culo marcado como en uso');\r\n      }\r\n      \r\n      console.log('‚úÖ Estado actualizado a \"en_camino\" en Firebase');\r\n    } catch (error) {\r\n      console.error('Error al actualizar estado en Firebase:', error);\r\n    }\r\n\r\n    // Calcular y mostrar ruta\r\nconst request = {\r\n  origin: new window.google.maps.LatLng(userPosition.lat, userPosition.lng),\r\n  destination: new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng),\r\n  travelMode: window.google.maps.TravelMode.DRIVING,\r\n  unitSystem: window.google.maps.UnitSystem.METRIC,\r\n  region: 'CL',\r\n  avoidHighways: false,\r\n  avoidTolls: false,\r\n  provideRouteAlternatives: false // Solo una ruta para simplificar\r\n};\r\n\r\n// Primero, limpiar cualquier ruta anterior\r\nif (directionsRendererRef.current) {\r\n  directionsRendererRef.current.setDirections({ routes: [] });\r\n}\r\n\r\ndirectionsServiceRef.current.route(request, (result, status) => {\r\n  console.log('Estado de la ruta:', status);\r\n  \r\n  if (status === 'OK') {\r\n    console.log('‚úÖ Ruta calculada exitosamente');\r\n    \r\n    // Configurar el renderer para que siga exactamente la ruta\r\n    directionsRendererRef.current.setOptions({\r\n      directions: result,\r\n      routeIndex: 0,\r\n      suppressMarkers: false,\r\n      preserveViewport: false,\r\n      polylineOptions: {\r\n        strokeColor: '#4285F4',\r\n        strokeWeight: 5,\r\n        strokeOpacity: 0.8\r\n      }\r\n    });\r\n    \r\n    const route = result.routes[0];\r\n    const leg = route.legs[0];\r\n    \r\n    setDistance(leg.distance.text);\r\n    setDuration(leg.duration.text);\r\n    \r\n    console.log('üìç Ruta calculada:');\r\n    console.log('   - Distancia:', leg.distance.text);\r\n    console.log('   - Duraci√≥n:', leg.duration.text);\r\n    console.log('   - Pasos:', leg.steps.length);\r\n    \r\n    // Ajustar el mapa para mostrar toda la ruta\r\n    const bounds = new window.google.maps.LatLngBounds();\r\n    route.overview_path.forEach(point => {\r\n      bounds.extend(point);\r\n    });\r\n    map.fitBounds(bounds, {\r\n      top: 100,\r\n      bottom: 100,\r\n      left: 50,\r\n      right: 50\r\n    });\r\n    \r\n  } else if (status === 'ZERO_RESULTS') {\r\n    console.warn('‚ö†Ô∏è No hay ruta disponible');\r\n    \r\n    // Si no hay ruta por carretera, mostrar l√≠nea directa\r\n    mostrarLineaDirecta();\r\n    \r\n  } else if (status === 'REQUEST_DENIED') {\r\n    console.error('‚ùå Solicitud denegada. Verificar API Key');\r\n    alert('Error: El servicio de rutas no est√° disponible. Verifica la configuraci√≥n de la API.');\r\n    mostrarLineaDirecta();\r\n    \r\n  } else if (status === 'OVER_QUERY_LIMIT') {\r\n    console.error('‚ùå L√≠mite de consultas excedido');\r\n    alert('Se ha excedido el l√≠mite de consultas. Intenta m√°s tarde.');\r\n    mostrarLineaDirecta();\r\n    \r\n  } else {\r\n    console.error('‚ùå Error desconocido:', status);\r\n    mostrarLineaDirecta();\r\n  }\r\n});\r\n  };\r\n// Funci√≥n auxiliar para mostrar l√≠nea directa cuando no hay ruta\r\nconst mostrarLineaDirecta = () => {\r\n  if (!window.google || !map || !userPosition || !selectedZona) return;\r\n  \r\n  // Limpiar cualquier ruta anterior\r\n  if (directionsRendererRef.current) {\r\n    directionsRendererRef.current.setDirections({ routes: [] });\r\n    \r\n    // Si hay una polil√≠nea anterior, eliminarla\r\n    if (directionsRendererRef.current.polyline) {\r\n      directionsRendererRef.current.polyline.setMap(null);\r\n    }\r\n  }\r\n  \r\n  // Calcular distancia en l√≠nea recta\r\n  const distanceInMeters = window.google.maps.geometry.spherical.computeDistanceBetween(\r\n    new window.google.maps.LatLng(userPosition.lat, userPosition.lng),\r\n    new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng)\r\n  );\r\n  \r\n  const distanceInKm = (distanceInMeters / 1000).toFixed(2);\r\n  setDistance(`~${distanceInKm} km (directo)`);\r\n  setDuration('Calculando...');\r\n  \r\n  // Crear una polil√≠nea simple entre los dos puntos\r\n  const line = new window.google.maps.Polyline({\r\n    path: [\r\n      new window.google.maps.LatLng(userPosition.lat, userPosition.lng),\r\n      new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng)\r\n    ],\r\n    geodesic: true,\r\n    strokeColor: '#FF5722',\r\n    strokeOpacity: 0.7,\r\n    strokeWeight: 4,\r\n    map: map,\r\n    icons: [{\r\n      icon: {\r\n        path: 'M 0,-1 0,1',\r\n        strokeOpacity: 1,\r\n        scale: 3\r\n      },\r\n      offset: '0',\r\n      repeat: '15px'\r\n    }]\r\n  });\r\n  \r\n  // Guardar referencia para poder eliminarla despu√©s\r\n  directionsRendererRef.current.polyline = line;\r\n  \r\n  // Crear marcadores personalizados para inicio y fin\r\n  new window.google.maps.Marker({\r\n    position: userPosition,\r\n    map: map,\r\n    label: 'A',\r\n    title: 'Tu ubicaci√≥n'\r\n  });\r\n  \r\n  new window.google.maps.Marker({\r\n    position: { lat: selectedZona.lat, lng: selectedZona.lng },\r\n    map: map,\r\n    label: 'B',\r\n    title: 'Destino'\r\n  });\r\n  \r\n  // Ajustar vista para mostrar ambos puntos\r\n  const bounds = new window.google.maps.LatLngBounds();\r\n  bounds.extend(userPosition);\r\n  bounds.extend({ lat: selectedZona.lat, lng: selectedZona.lng });\r\n  map.fitBounds(bounds, {\r\n    top: 100,\r\n    bottom: 100,\r\n    left: 50,\r\n    right: 50\r\n  });\r\n  \r\n  console.log('üìç Mostrando ruta directa (sin caminos)');\r\n};\r\n\r\n  // Manejar llegada a la zona - MEJORADO\r\n  const handleArrival = async () => {\r\n    setWorkStatus('working');\r\n    const arrivalTime = new Date().toISOString();\r\n    setWorkLog({\r\n      ...workLog,\r\n      arrivalTime: arrivalTime\r\n    });\r\n    \r\n    // üî• Actualizar estado en Firebase\r\n    try {\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'trabajando',\r\n        horaLlegada: arrivalTime\r\n      });\r\n      \r\n      // üî• NUEVO: Mantener veh√≠culo en uso pero actualizar ubicaci√≥n\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'en_uso',\r\n          enZonaTrabajo: true,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      console.log('‚úÖ Llegada registrada en Firebase');\r\n    } catch (error) {\r\n      console.error('Error al registrar llegada en Firebase:', error);\r\n    }\r\n    \r\n    // Limpiar la ruta del mapa al llegar\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    console.log('‚úÖ Trabajador ha llegado a la zona y est√° trabajando');\r\n  };\r\n\r\n  // Finalizar trabajo mejorado con registro de detalles\r\n  const finishWork = async () => {\r\n    const endTime = new Date().toISOString();\r\n    const tiempoTrabajado = workLog.arrivalTime ? \r\n      Math.floor((new Date(endTime) - new Date(workLog.arrivalTime)) / 60000) : 0; // minutos\r\n    \r\n    const finalLog = {\r\n      ...workLog,\r\n      endTime: endTime,\r\n      tiempoTrabajadoMinutos: tiempoTrabajado\r\n    };\r\n    \r\n    setWorkLog(finalLog);\r\n    setWorkStatus('completed');\r\n    setIsNavigating(false);\r\n    setShowWorkLog(true);\r\n    \r\n    // Limpiar ruta\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    // üî• Registrar finalizaci√≥n en Firebase y actualizar zona\r\n    try {\r\n      // Actualizar estado del trabajador\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'disponible',\r\n        zonaDestino: null,\r\n        ultimoTrabajo: {\r\n          zona: selectedZona.nombre,\r\n          zonaId: selectedZona.id,\r\n          horaInicio: workLog.startTime,\r\n          horaLlegada: workLog.arrivalTime,\r\n          horaFin: endTime,\r\n          tiempoTrabajadoMinutos: tiempoTrabajado,\r\n          completado: true\r\n        }\r\n      });\r\n      \r\n      // üî• NUEVO: Marcar veh√≠culo como disponible nuevamente\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'disponible',\r\n          operadorEnRuta: null,\r\n          zonaDestino: null,\r\n          enZonaTrabajo: false,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('‚úÖ Veh√≠culo marcado como disponible');\r\n      }\r\n      \r\n      // Marcar zona como completada\r\n      if (selectedZona.id) {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'completado',\r\n          fechaCompletado: endTime,\r\n          tiempoTrabajadoMinutos: tiempoTrabajado,\r\n          completadoPor: currentUser.uid,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      // Crear registro en historial\r\n      const historialRef = ref(database, `historial_trabajos/${currentUser.uid}/${Date.now()}`);\r\n      await set(historialRef, {\r\n        trabajadorId: currentUser.uid,\r\n        trabajadorNombre: currentUser.name || currentUser.email,\r\n        zonaId: selectedZona.id,\r\n        zonaNombre: selectedZona.nombre,\r\n        zonaDireccion: selectedZona.direccion,\r\n        horaInicio: workLog.startTime,\r\n        horaLlegada: workLog.arrivalTime,\r\n        horaFin: endTime,\r\n        tiempoTrabajadoMinutos: tiempoTrabajado,\r\n        estado: 'completado',\r\n        fecha: new Date().toISOString().split('T')[0]\r\n      });\r\n      \r\n      console.log('‚úÖ Trabajo completado y registrado en Firebase');\r\n      \r\n      // Mostrar notificaci√≥n de √©xito\r\n      alert('‚úÖ ¬°Excelente trabajo! La tarea ha sido marcada como completada.');\r\n      \r\n    } catch (error) {\r\n      console.error('Error al registrar finalizaci√≥n en Firebase:', error);\r\n      alert('‚ö†Ô∏è Error al guardar. El trabajo se complet√≥ pero hubo un problema al registrarlo.');\r\n    }\r\n    \r\n    console.log('Registro de trabajo:', finalLog);\r\n  };\r\n\r\n  // Cancelar navegaci√≥n/trabajo\r\n  const cancelNavigation = async () => {\r\n    if (!window.confirm('¬øEst√°s seguro de cancelar el recorrido actual?')) {\r\n      return;\r\n    }\r\n\r\n    // Limpiar estados\r\n    setIsNavigating(false);\r\n    setWorkStatus('idle');\r\n    setDistance(null);\r\n    setDuration(null);\r\n    \r\n    // Limpiar ruta del mapa\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    // Actualizar estado en Firebase\r\n    try {\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'disponible',\r\n        zonaDestino: null,\r\n        recorridoCancelado: new Date().toISOString()\r\n      });\r\n      \r\n      // üî• NUEVO: Marcar veh√≠culo como disponible si estaba en uso\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'disponible',\r\n          operadorEnRuta: null,\r\n          zonaDestino: null,\r\n          enZonaTrabajo: false,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('‚úÖ Veh√≠culo liberado y marcado como disponible');\r\n      }\r\n      \r\n      // Si hab√≠a una zona en progreso, cambiarla a pendiente\r\n      if (selectedZona && selectedZona.id && workStatus !== 'idle') {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'pendiente',\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      console.log('‚úÖ Recorrido cancelado');\r\n    } catch (error) {\r\n      console.error('Error al cancelar recorrido:', error);\r\n    }\r\n    \r\n    // Mantener la zona seleccionada por si quiere reintentar\r\n    alert('Recorrido cancelado. Puedes iniciar uno nuevo cuando quieras.');\r\n  };\r\n\r\n  // Resetear para nuevo trabajo\r\n  const resetWork = () => {\r\n    setSelectedZona(null);\r\n    setWorkStatus('idle');\r\n    setWorkLog({\r\n      startTime: null,\r\n      arrivalTime: null,\r\n      endTime: null,\r\n      zona: null\r\n    });\r\n    setIsNavigating(false);\r\n    setDistance(null);\r\n    setDuration(null);\r\n    setShowWorkLog(false);\r\n    \r\n    if (zonaMarkerRef.current) {\r\n      zonaMarkerRef.current.setMap(null);\r\n      zonaMarkerRef.current = null;\r\n    }\r\n    \r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n  };\r\n\r\n  // Formatear tiempo\r\n  const formatTime = (isoString) => {\r\n    if (!isoString) return '--:--';\r\n    const date = new Date(isoString);\r\n    return date.toLocaleTimeString('es-CL', { \r\n      hour: '2-digit', \r\n      minute: '2-digit',\r\n      hour12: false \r\n    });\r\n  };\r\n\r\n  // Calcular duraci√≥n\r\n  const calculateDuration = (start, end) => {\r\n    if (!start || !end) return '--';\r\n    const diff = new Date(end) - new Date(start);\r\n    const hours = Math.floor(diff / 3600000);\r\n    const minutes = Math.floor((diff % 3600000) / 60000);\r\n    return `${hours}h ${minutes}m`;\r\n  };\r\n\r\n  // Limpiar al desmontar componente\r\n  useEffect(() => {\r\n    return () => {\r\n      // Limpiar GPS al salir\r\n      if (watchIdRef.current) {\r\n        navigator.geolocation.clearWatch(watchIdRef.current);\r\n      }\r\n      \r\n      // Marcar como inactivo en Firebase\r\n      if (currentUser?.uid) {\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          estado: 'inactivo',\r\n          ubicacion: null\r\n        }).catch(console.error);\r\n      }\r\n    };\r\n  }, [currentUser]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div style={{ padding: '20px', textAlign: 'center' }}>\r\n        <h2>Error</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => window.location.reload()}>Reintentar</button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Estilos responsivos\r\n  const styles = {\r\n    container: {\r\n      width: '100%',\r\n      height: '100vh',\r\n      position: 'relative',\r\n      overflow: 'hidden'\r\n    },\r\n    header: {\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\r\n      color: 'white',\r\n      padding: isMobile ? '10px 15px' : '15px 20px',\r\n      zIndex: 1002,\r\n      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'\r\n    },\r\n    panel: {\r\n      position: 'fixed',\r\n      top: isMobile ? '60px' : '70px',\r\n      left: showPanel ? '0' : '-100%',\r\n      width: isMobile ? '100%' : '400px',\r\n      maxWidth: '100%',\r\n      height: isMobile ? 'auto' : 'calc(100vh - 70px)',\r\n      maxHeight: isMobile ? '60vh' : 'calc(100vh - 70px)',\r\n      background: 'white',\r\n      boxShadow: '2px 0 10px rgba(0,0,0,0.1)',\r\n      overflowY: 'auto',\r\n      transition: 'left 0.3s ease',\r\n      zIndex: 1001,\r\n      padding: isMobile ? '15px' : '20px'\r\n    },\r\n    map: {\r\n      width: '100%',\r\n      height: '100%',\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0\r\n    },\r\n    button: {\r\n      width: '100%',\r\n      padding: isMobile ? '14px' : '12px',\r\n      fontSize: isMobile ? '16px' : '14px',\r\n      border: 'none',\r\n      borderRadius: '8px',\r\n      fontWeight: '500',\r\n      cursor: 'pointer',\r\n      marginBottom: '10px',\r\n      touchAction: 'manipulation'\r\n    },\r\n    floatingButton: {\r\n      position: 'fixed',\r\n      bottom: isMobile ? '20px' : '30px',\r\n      right: isMobile ? '20px' : '30px',\r\n      width: isMobile ? '60px' : '50px',\r\n      height: isMobile ? '60px' : '50px',\r\n      borderRadius: '50%',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      boxShadow: '0 4px 12px rgba(0,0,0,0.2)',\r\n      zIndex: 1000,\r\n      cursor: 'pointer',\r\n      fontSize: isMobile ? '24px' : '20px'\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={styles.container}>\r\n      {/* Mapa - Primero para que est√© en el fondo */}\r\n      <div ref={mapRef} style={styles.map} />\r\n      \r\n      {/* Header responsivo */}\r\n      <div style={styles.header}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center',\r\n          flexWrap: isMobile ? 'wrap' : 'nowrap'\r\n        }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n            <button\r\n              onClick={() => setShowPanel(!showPanel)}\r\n              style={{\r\n                padding: isMobile ? '8px' : '6px 10px',\r\n                background: 'rgba(255,255,255,0.2)',\r\n                color: 'white',\r\n                border: '1px solid rgba(255,255,255,0.3)',\r\n                borderRadius: '6px',\r\n                cursor: 'pointer',\r\n                fontSize: isMobile ? '20px' : '14px',\r\n                touchAction: 'manipulation'\r\n              }}\r\n            >\r\n              {showPanel ? '‚ò∞' : '‚ò∞'}\r\n            </button>\r\n            <div>\r\n              <h1 style={{ \r\n                margin: 0, \r\n                fontSize: isMobile ? '18px' : '20px', \r\n                fontWeight: '600' \r\n              }}>\r\n                üë∑‚Äç‚ôÇÔ∏è {currentUser.name || 'Trabajador'}\r\n              </h1>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={onLogout}\r\n            style={{\r\n              padding: isMobile ? '6px 10px' : '8px 16px',\r\n              background: 'rgba(255,255,255,0.2)',\r\n              color: 'white',\r\n              border: '1px solid rgba(255,255,255,0.3)',\r\n              borderRadius: '6px',\r\n              cursor: 'pointer',\r\n              fontSize: isMobile ? '12px' : '14px',\r\n              touchAction: 'manipulation'\r\n            }}\r\n          >\r\n            Salir\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel lateral/inferior responsivo */}\r\n      <div style={styles.panel}>\r\n        {/* Notificaciones */}\r\n        {notificaciones.length > 0 && (\r\n          <div style={{\r\n            marginBottom: '15px',\r\n            padding: '10px',\r\n            background: '#fef3c7',\r\n            border: '1px solid #fde68a',\r\n            borderRadius: '8px'\r\n          }}>\r\n            <h4 style={{ margin: '0 0 8px 0', fontSize: '14px', color: '#92400e' }}>\r\n              üîî Nuevas notificaciones ({notificaciones.length})\r\n            </h4>\r\n            {notificaciones.map(notif => (\r\n              <div key={notif.id} style={{ fontSize: '12px', marginBottom: '4px' }}>\r\n                ‚Ä¢ {notif.mensaje}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Activaci√≥n GPS */}\r\n        <button\r\n          onClick={toggleGPS}\r\n          style={{\r\n            ...styles.button,\r\n            background: isTracking ? '#ef4444' : '#22c55e',\r\n            color: 'white'\r\n          }}\r\n        >\r\n          {isTracking ? 'üìç Desactivar GPS' : 'üìç Activar GPS'}\r\n        </button>\r\n        \r\n        {/* Estado del GPS */}\r\n        {gpsStatus !== 'inactive' && (\r\n          <div style={{ \r\n            marginBottom: '15px',\r\n            padding: '8px',\r\n            borderRadius: '6px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: gpsStatus === 'active' ? '#dcfce7' : \r\n                       gpsStatus === 'activating' ? '#fef3c7' : \r\n                       '#fee2e2',\r\n            color: gpsStatus === 'active' ? '#166534' : \r\n                   gpsStatus === 'activating' ? '#92400e' : \r\n                   '#991b1b'\r\n          }}>\r\n            {gpsStatus === 'active' && 'üü¢ GPS activo'}\r\n            {gpsStatus === 'activating' && 'üü° Activando GPS...'}\r\n            {gpsStatus === 'error' && 'üî¥ Error en GPS'}\r\n          </div>\r\n        )}\r\n\r\n        {/* Selector de zona */}\r\n        {isTracking && workStatus === 'idle' && (\r\n          <div style={{ marginBottom: '15px' }}>\r\n            <label style={{ \r\n              display: 'block', \r\n              marginBottom: '8px', \r\n              fontSize: '14px', \r\n              fontWeight: '500' \r\n            }}>\r\n              üèóÔ∏è Zona de Trabajo:\r\n            </label>\r\n            {zonasAsignadas.length > 0 ? (\r\n              <select\r\n                value={selectedZona?.id || ''}\r\n                onChange={(e) => {\r\n                  const zona = zonasAsignadas.find(z => z.id === e.target.value);\r\n                  if (zona) selectZona(zona);\r\n                }}\r\n                style={{\r\n                  width: '100%',\r\n                  padding: '10px',\r\n                  borderRadius: '6px',\r\n                  border: '1px solid #ddd',\r\n                  fontSize: isMobile ? '16px' : '14px'\r\n                }}\r\n              >\r\n                <option value=\"\">-- Seleccionar --</option>\r\n                {zonasAsignadas.map(zona => (\r\n                  <option key={zona.id} value={zona.id}>\r\n                    {zona.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            ) : (\r\n              <div style={{\r\n                padding: '10px',\r\n                background: '#f3f4f6',\r\n                borderRadius: '6px',\r\n                textAlign: 'center',\r\n                fontSize: '13px',\r\n                color: '#6b7280'\r\n              }}>\r\n                No hay zonas asignadas\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Informaci√≥n de zona seleccionada */}\r\n        {selectedZona && workStatus === 'idle' && (\r\n          <div style={{\r\n            background: '#f0f9ff',\r\n            padding: '12px',\r\n            borderRadius: '8px',\r\n            marginBottom: '15px',\r\n            border: '1px solid #bae6fd'\r\n          }}>\r\n            <h4 style={{ margin: '0 0 8px 0', color: '#0369a1', fontSize: '14px' }}>\r\n              {selectedZona.nombre}\r\n            </h4>\r\n            <p style={{ margin: 0, fontSize: '12px', color: '#333' }}>\r\n              üìç {selectedZona.direccion}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Bot√≥n iniciar recorrido */}\r\n        {workStatus === 'idle' && selectedZona && userPosition && (\r\n          <button\r\n            onClick={startNavigation}\r\n            style={{\r\n              ...styles.button,\r\n              background: '#3b82f6',\r\n              color: 'white'\r\n            }}\r\n          >\r\n            üöó Iniciar Recorrido\r\n          </button>\r\n        )}\r\n\r\n        {/* Estado: En camino */}\r\n        {workStatus === 'traveling' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#fef3c7',\r\n              padding: '12px',\r\n              borderRadius: '8px',\r\n              marginBottom: '12px',\r\n              border: '1px solid #fde68a'\r\n            }}>\r\n              <div style={{ fontSize: '16px', fontWeight: '500', color: '#92400e' }}>\r\n                üöó En camino a la zona\r\n              </div>\r\n              <div style={{ fontSize: '13px', marginTop: '4px', color: '#78350f' }}>\r\n                üìç {selectedZona?.nombre}\r\n              </div>\r\n              {distance && duration && (\r\n                <div style={{ marginTop: '8px', fontSize: '13px' }}>\r\n                  üìè {distance} ‚Ä¢ ‚è±Ô∏è {duration}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* BOT√ìN PARA MARCAR LLEGADA */}\r\n            <button\r\n              onClick={() => {\r\n                handleArrival();\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: '#10b981',\r\n                color: 'white',\r\n                fontSize: isMobile ? '16px' : '14px',\r\n                fontWeight: '600',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                gap: '8px'\r\n              }}\r\n            >\r\n              üìç Ya llegu√© a la zona\r\n            </button>\r\n            \r\n            <button\r\n              onClick={cancelNavigation}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'white',\r\n                color: '#ef4444',\r\n                border: '2px solid #ef4444'\r\n              }}\r\n            >\r\n              ‚ùå Cancelar Recorrido\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado: Trabajando - MEJORADO */}\r\n        {workStatus === 'working' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#dcfce7',\r\n              padding: '15px',\r\n              borderRadius: '8px',\r\n              marginBottom: '15px',\r\n              border: '2px solid #22c55e'\r\n            }}>\r\n              <div style={{ \r\n                fontSize: isMobile ? '18px' : '16px', \r\n                fontWeight: '600', \r\n                color: '#14532d',\r\n                marginBottom: '8px'\r\n              }}>\r\n                üîß TRABAJANDO EN ZONA\r\n              </div>\r\n              <div style={{ fontSize: '14px', color: '#166534' }}>\r\n                üìç {selectedZona?.nombre}\r\n              </div>\r\n              {selectedZona?.descripcion && (\r\n                <div style={{\r\n                  marginTop: '10px',\r\n                  padding: '8px',\r\n                  background: '#f0fdf4',\r\n                  borderRadius: '6px',\r\n                  fontSize: '13px',\r\n                  color: '#15803d'\r\n                }}>\r\n                  üìã {selectedZona.descripcion}\r\n                </div>\r\n              )}\r\n              <div style={{ \r\n                fontSize: '12px', \r\n                marginTop: '8px', \r\n                color: '#166534' \r\n              }}>\r\n                ‚è∞ Llegada: {formatTime(workLog.arrivalTime)}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* BOT√ìN PRINCIPAL - TAREA COMPLETADA */}\r\n            <button\r\n              onClick={() => {\r\n                if (window.confirm('¬øConfirmas que has completado toda la tarea asignada?')) {\r\n                  finishWork();\r\n                }\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\r\n                color: 'white',\r\n                padding: isMobile ? '18px' : '16px',\r\n                fontSize: isMobile ? '18px' : '16px',\r\n                fontWeight: '700',\r\n                boxShadow: '0 4px 12px rgba(34, 197, 94, 0.3)',\r\n                textTransform: 'uppercase',\r\n                letterSpacing: '0.5px'\r\n              }}\r\n            >\r\n              ‚úÖ MARCAR TAREA COMO COMPLETADA\r\n            </button>\r\n            \r\n            <p style={{\r\n              fontSize: '12px',\r\n              color: '#6b7280',\r\n              textAlign: 'center',\r\n              margin: '8px 0'\r\n            }}>\r\n              Presiona cuando hayas terminado todo el trabajo\r\n            </p>\r\n            \r\n            {/* Bot√≥n secundario - Cancelar */}\r\n            <button\r\n              onClick={() => {\r\n                if (window.confirm('¬øCancelar el trabajo? La zona volver√° a estado pendiente.')) {\r\n                  cancelNavigation();\r\n                }\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'white',\r\n                color: '#ef4444',\r\n                border: '2px solid #ef4444',\r\n                fontSize: isMobile ? '14px' : '13px'\r\n              }}\r\n            >\r\n              ‚ùå No puedo completar la tarea\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado: Completado */}\r\n        {workStatus === 'completed' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#e0e7ff',\r\n              padding: '12px',\r\n              borderRadius: '8px',\r\n              marginBottom: '12px',\r\n              border: '1px solid #c7d2fe',\r\n              textAlign: 'center'\r\n            }}>\r\n              <div style={{ fontSize: '16px', fontWeight: '500', color: '#312e81' }}>\r\n                ‚úÖ Trabajo Completado\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={resetWork}\r\n              style={{\r\n                ...styles.button,\r\n                background: '#22c55e',\r\n                color: 'white'\r\n              }}\r\n            >\r\n              üîÑ Nuevo Trabajo\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Bot√≥n flotante cuando el panel est√° oculto */}\r\n      {!showPanel && workStatus !== 'idle' && (\r\n        <button\r\n          onClick={() => setShowPanel(true)}\r\n          style={{\r\n            ...styles.floatingButton,\r\n            background: workStatus === 'traveling' ? '#f59e0b' :\r\n                      workStatus === 'working' ? '#3b82f6' :\r\n                      '#22c55e',\r\n            color: 'white',\r\n            border: 'none'\r\n          }}\r\n        >\r\n          {workStatus === 'traveling' && 'üöó'}\r\n          {workStatus === 'working' && 'üîß'}\r\n          {workStatus === 'completed' && '‚úÖ'}\r\n        </button>\r\n      )}\r\n\r\n      {/* Modal de resumen de trabajo */}\r\n      {showWorkLog && workLog.zona && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          background: 'rgba(0,0,0,0.5)',\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 2000,\r\n          padding: '20px'\r\n        }}>\r\n          <div style={{\r\n            background: 'white',\r\n            borderRadius: '12px',\r\n            padding: isMobile ? '15px' : '20px',\r\n            maxWidth: isMobile ? '100%' : '400px',\r\n            width: '100%',\r\n            maxHeight: '80vh',\r\n            overflow: 'auto'\r\n          }}>\r\n            <h3 style={{ margin: '0 0 15px 0', color: '#1f2937', fontSize: isMobile ? '18px' : '20px' }}>\r\n              üìã Resumen del Trabajo\r\n            </h3>\r\n            \r\n            <div style={{ fontSize: isMobile ? '13px' : '14px', lineHeight: '1.8' }}>\r\n              <div style={{ marginBottom: '15px' }}>\r\n                <strong>{workLog.zona.nombre}</strong><br/>\r\n                üìç {workLog.zona.direccion}\r\n              </div>\r\n              \r\n              <div style={{\r\n                background: '#f8fafc',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                marginBottom: '15px'\r\n              }}>\r\n                <div>‚è±Ô∏è Tiempo trabajado: {calculateDuration(workLog.arrivalTime, workLog.endTime)}</div>\r\n                <div style={{\r\n                  marginTop: '10px',\r\n                  padding: '8px',\r\n                  background: '#dcfce7',\r\n                  borderRadius: '6px',\r\n                  textAlign: 'center',\r\n                  fontWeight: 'bold',\r\n                  color: '#166534'\r\n                }}>\r\n                  ‚úÖ COMPLETADO\r\n                </div>\r\n              </div>\r\n              \r\n              <button\r\n                onClick={() => setShowWorkLog(false)}\r\n                style={{\r\n                  ...styles.button,\r\n                  background: '#6b7280',\r\n                  color: 'white'\r\n                }}\r\n              >\r\n                Cerrar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Indicador de carga */}\r\n      {!mapLoaded && (\r\n        <div style={{\r\n          position: 'absolute',\r\n          top: '50%',\r\n          left: '50%',\r\n          transform: 'translate(-50%, -50%)',\r\n          textAlign: 'center',\r\n          zIndex: 1001\r\n        }}>\r\n          <div style={{\r\n            width: '50px',\r\n            height: '50px',\r\n            border: '4px solid #f3f3f3',\r\n            borderTop: '4px solid #22c55e',\r\n            borderRadius: '50%',\r\n            animation: 'spin 1s linear infinite'\r\n          }}></div>\r\n          <p style={{ marginTop: '10px', color: '#666' }}>Cargando mapa...</p>\r\n        </div>\r\n      )}\r\n\r\n      <style jsx>{`\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SistemaTrabajadoresFirebase;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}