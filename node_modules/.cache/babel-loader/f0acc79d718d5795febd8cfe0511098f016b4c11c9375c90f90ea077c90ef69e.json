{"ast":null,"code":"// src/components/SistemaTrabajadoresFirebase.js\nimport React,{useEffect,useRef,useState}from'react';import{trabajadoresService}from'../services/firebaseservices';import{database}from'../config/firebase';import{ref,onValue,update,set}from'firebase/database';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SistemaTrabajadoresFirebase=_ref=>{let{currentUser,onLogout}=_ref;// Log para debugging\nconsole.log('🔍 Current User Data:',currentUser);// Estados principales\nconst mapRef=useRef(null);const[map,setMap]=useState(null);const[userPosition,setUserPosition]=useState(null);const[selectedZona,setSelectedZona]=useState(null);const[isTracking,setIsTracking]=useState(false);const[isNavigating,setIsNavigating]=useState(false);const[workStatus,setWorkStatus]=useState('idle');// idle, traveling, working, completed\nconst[workLog,setWorkLog]=useState({startTime:null,arrivalTime:null,endTime:null,zona:null});// Estados para zonas y notificaciones\nconst[zonasAsignadas,setZonasAsignadas]=useState([]);const[notificaciones,setNotificaciones]=useState([]);const[showPanel,setShowPanel]=useState(true);// Estado para mostrar/ocultar panel\nconst[isMobile,setIsMobile]=useState(false);// Referencias para marcadores y servicios\nconst userMarkerRef=useRef(null);const zonaMarkerRef=useRef(null);const directionsServiceRef=useRef(null);const directionsRendererRef=useRef(null);const watchIdRef=useRef(null);const lastUpdateRef=useRef(null);// Estados de UI\nconst[mapLoaded,setMapLoaded]=useState(false);const[error,setError]=useState(null);const[distance,setDistance]=useState(null);const[duration,setDuration]=useState(null);const[showWorkLog,setShowWorkLog]=useState(false);const[gpsStatus,setGpsStatus]=useState('inactive');// inactive, activating, active, error\nconst API_KEY='AIzaSyA7DrdL36n5cx-RNzuXGAQggFeGCheHDbY';// Detectar si es móvil\nuseEffect(()=>{const checkMobile=()=>{setIsMobile(window.innerWidth<=768);};checkMobile();window.addEventListener('resize',checkMobile);return()=>window.removeEventListener('resize',checkMobile);},[]);// Cargar zonas asignadas desde Firebase\nuseEffect(()=>{if(currentUser&&currentUser.uid){console.log('🔄 Cargando zonas asignadas para trabajador:',currentUser.uid);// Escuchar zonas asignadas al trabajador\nconst zonasRef=ref(database,'zonas_asignadas');const unsubZonas=onValue(zonasRef,snapshot=>{const data=snapshot.val();console.log('📦 Datos de zonas recibidos:',data);if(data){// Filtrar solo las zonas asignadas a este trabajador\nconst zonasArray=Object.entries(data).filter(_ref2=>{let[id,zona]=_ref2;console.log(`Zona ${id}: asignada a ${zona.trabajadorAsignado}, yo soy ${currentUser.uid}`);return zona.trabajadorAsignado===currentUser.uid&&zona.estado!=='completado';}).map(_ref3=>{let[id,zona]=_ref3;return{id,...zona};});console.log('✅ Zonas asignadas filtradas:',zonasArray);setZonasAsignadas(zonasArray);}else{console.log('⚠️ No hay zonas en Firebase');setZonasAsignadas([]);}});// Escuchar notificaciones\nconst notifRef=ref(database,'notificaciones');const unsubNotif=onValue(notifRef,snapshot=>{const data=snapshot.val();if(data){const notifArray=Object.entries(data).filter(_ref4=>{let[id,notif]=_ref4;return notif.trabajadorId===currentUser.uid&&!notif.leido;}).map(_ref5=>{let[id,notif]=_ref5;return{id,...notif};});setNotificaciones(notifArray);}});return()=>{unsubZonas();unsubNotif();};}},[currentUser]);// Registrar trabajador al montar el componente\nuseEffect(()=>{if(currentUser&&currentUser.uid){console.log('🔄 Registrando trabajador al iniciar...');// Crear o actualizar el trabajador en Realtime Database\ntrabajadoresService.createOrUpdateTrabajador(currentUser.uid,{nombre:currentUser.name||currentUser.email||'Trabajador',email:currentUser.email,telefono:currentUser.phone||'',vehicleId:currentUser.vehicleId||null,estado:'inactivo',rol:'trabajador',ubicacion:null,createdAt:new Date().toISOString(),ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('✅ Trabajador registrado en Realtime Database al iniciar');}).catch(error=>{console.error('❌ Error al registrar trabajador al iniciar:',error);});}},[currentUser]);// Función para cargar Google Maps\nuseEffect(()=>{const loadGoogleMaps=()=>{return new Promise((resolve,reject)=>{if(window.google&&window.google.maps){resolve(window.google.maps);return;}const existingScript=document.querySelector('script[src*=\"maps.googleapis.com\"]');if(existingScript){existingScript.addEventListener('load',()=>{if(window.google&&window.google.maps){resolve(window.google.maps);}else{reject(new Error('Google Maps no disponible'));}});return;}const script=document.createElement('script');script.src=`https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places,geometry&v=weekly`;script.async=true;script.defer=true;script.onload=()=>{if(window.google&&window.google.maps){resolve(window.google.maps);}else{reject(new Error('Google Maps no disponible'));}};script.onerror=()=>{reject(new Error('Error al cargar Google Maps'));};document.head.appendChild(script);});};const initMap=async()=>{try{const maps=await loadGoogleMaps();if(!mapRef.current)return;const mapInstance=new maps.Map(mapRef.current,{center:{lat:-36.7333,lng:-72.4667},zoom:13,mapTypeId:'roadmap',zoomControl:!isMobile,mapTypeControl:false,scaleControl:false,streetViewControl:false,rotateControl:false,fullscreenControl:true,gestureHandling:'greedy'// Mejor para móviles\n});setMap(mapInstance);// Inicializar servicios de direcciones\n// Inicializar servicios de direcciones\ndirectionsServiceRef.current=new maps.DirectionsService();directionsRendererRef.current=new maps.DirectionsRenderer({map:mapInstance,suppressMarkers:false,// Mostrar marcadores A y B\npolylineOptions:{strokeColor:'#4285F4',strokeWeight:6,strokeOpacity:0.8},// Agregar estas opciones para mejor visualización\nmarkerOptions:{startMarker:{label:'A',title:'Tu ubicación'},endMarker:{label:'B',title:'Zona de trabajo'}},preserveViewport:false// Ajustar vista automáticamente a la ruta\n});setMapLoaded(true);}catch(err){setError('Error al cargar el mapa: '+err.message);}};initMap();},[isMobile]);// 🔥 FUNCIÓN CRÍTICA - Actualizar posición del usuario Y ENVIAR A FIREBASE\nconst updateUserPosition=position=>{console.log('🔄 Actualizando posición:',position);setUserPosition(position);// Mostrar precisión en el UI\nif(window.google&&map){// Opcional: Mostrar círculo de precisión en el mapa\nconst accuracy=position.accuracy||100;console.log('📍 Precisión actual:',accuracy,'metros');}// 🔥 ENVIAR UBICACIÓN A FIREBASE - ESTO ES LO QUE FALTABA\n// Solo actualizar si ha pasado al menos 5 segundos desde la última actualización\nconst ahora=Date.now();if(!lastUpdateRef.current||ahora-lastUpdateRef.current>5000){console.log('📍 Enviando ubicación a Firebase:',position);if(currentUser&&currentUser.uid){// Actualizar ubicación en Firebase\ntrabajadoresService.updateTrabajadorLocation(currentUser.uid,{lat:position.lat,lng:position.lng,timestamp:new Date().toISOString(),accuracy:position.accuracy||null// Guardar precisión también\n}).then(()=>{console.log('✅ Ubicación enviada a Firebase exitosamente');console.log('   - Trabajador ID:',currentUser.uid);console.log('   - Posición:',position);}).catch(error=>{console.error('❌ Error al enviar ubicación a Firebase:',error);console.error('   - Detalles:',error.message);});// También actualizar el estado del trabajador si es necesario\nconst estadoActual=workStatus==='traveling'?'en_camino':workStatus==='working'?'trabajando':'disponible';// Actualizar datos adicionales del trabajador\ntrabajadoresService.updateTrabajadorData(currentUser.uid,{nombre:currentUser.name||currentUser.email,email:currentUser.email,estado:estadoActual,zonaDestino:selectedZona?selectedZona.nombre:null,ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('✅ Datos del trabajador actualizados');}).catch(error=>{console.error('❌ Error al actualizar datos del trabajador:',error);});lastUpdateRef.current=ahora;}}// Actualizar marcador en el mapa local\nif(!map||!window.google)return;// Crear o actualizar marcador del usuario\nif(!userMarkerRef.current){userMarkerRef.current=new window.google.maps.Marker({position:position,map:map,title:'Tu ubicación',icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:10,fillColor:'#4285F4',fillOpacity:1,strokeColor:'#ffffff',strokeWeight:3},zIndex:1000});// Centrar mapa en usuario\nmap.setCenter(position);map.setZoom(15);}else{userMarkerRef.current.setPosition(position);}// Si está navegando, actualizar distancia pero NO cambiar automáticamente a working\nif(isNavigating&&selectedZona){const distance=window.google.maps.geometry.spherical.computeDistanceBetween(new window.google.maps.LatLng(position.lat,position.lng),new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng));// Solo mostrar distancia, no cambiar estado automáticamente\nconsole.log('📏 Distancia a la zona:',Math.round(distance),'metros');}};// Función para activar/desactivar GPS\nconst toggleGPS=()=>{if(isTracking){// Detener tracking\nif(watchIdRef.current){navigator.geolocation.clearWatch(watchIdRef.current);watchIdRef.current=null;}setIsTracking(false);setGpsStatus('inactive');// Mantener última posición para la próxima activación\nconsole.log('📍 GPS desactivado, última ubicación guardada:',userPosition);// Limpiar marcador de usuario\nif(userMarkerRef.current){userMarkerRef.current.setMap(null);userMarkerRef.current=null;}// Limpiar ubicación en Firebase al desactivar GPS (sin await)\nif(currentUser&&currentUser.uid){trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'inactivo',// NO borrar la ubicación, solo marcar como inactivo\n// ubicacion: null, // COMENTADO - mantener última ubicación\nultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('📍 GPS desactivado - Estado actualizado a inactivo');}).catch(error=>{console.error('Error al actualizar estado en Firebase:',error);});// 🔥 NUEVO: Si hay un vehículo asignado y está en uso, liberarlo\nif(currentUser.vehicleId&&(workStatus==='traveling'||workStatus==='working')){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()}).then(()=>{console.log('✅ Vehículo liberado al desactivar GPS');}).catch(error=>{console.error('Error al liberar vehículo:',error);});}}// Mantener última posición conocida\nconsole.log('📍 Última ubicación conocida guardada:',userPosition);}else{// Iniciar tracking\nif(!navigator.geolocation){alert('Tu navegador no soporta geolocalización');setGpsStatus('error');return;}console.log('🔄 Iniciando GPS...');setIsTracking(true);setGpsStatus('activating');// Registrar el trabajador en Firebase si no existe (sin bloquear)\nif(currentUser&&currentUser.uid){console.log('📝 Registrando trabajador en Realtime Database...');console.log('   - User ID:',currentUser.uid);console.log('   - Datos:',currentUser);trabajadoresService.createOrUpdateTrabajador(currentUser.uid,{nombre:currentUser.name||currentUser.email||'Trabajador',email:currentUser.email,telefono:currentUser.phone||'',estado:'disponible',rol:'trabajador',vehicleId:currentUser.vehicleId||null,createdAt:new Date().toISOString()}).then(()=>{console.log('✅ Trabajador registrado en Realtime Database');console.log('   - Path: trabajadores/'+currentUser.uid);}).catch(error=>{console.error('❌ Error al registrar trabajador:',error);console.error('   - Detalles:',error.message);});}else{console.error('⚠️ No hay currentUser o uid disponible');}// Obtener posición inicial con ALTA PRECISIÓN\nconsole.log('📍 Intentando obtener ubicación GPS de alta precisión...');// Si ya tenemos una posición previa, usarla mientras obtenemos la nueva\nif(userPosition){console.log('📍 Usando última ubicación conocida mientras se obtiene GPS de alta precisión');setGpsStatus('active');// Intentar obtener ubicación de ALTA PRECISIÓN en segundo plano\nnavigator.geolocation.getCurrentPosition(position=>{console.log('📍 GPS de alta precisión actualizado:',position.coords);console.log('   - Precisión:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);},error=>{console.log('⚠️ GPS de alta precisión no disponible, usando precisión normal');},{enableHighAccuracy:true,// 🔴 ALTA PRECISIÓN\ntimeout:20000,// Más tiempo para alta precisión\nmaximumAge:0// No usar caché, queremos ubicación fresca\n});}else{// Primera vez - intentar con alta precisión\nsetGpsStatus('activating');navigator.geolocation.getCurrentPosition(position=>{console.log('✅ GPS de alta precisión obtenido:',position.coords);console.log('   - Precisión:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');},error=>{console.warn('⚠️ Alta precisión falló, intentando con precisión normal:',error.message);if(error.code===error.PERMISSION_DENIED){alert('Por favor, habilita los permisos de ubicación en tu navegador');setIsTracking(false);setGpsStatus('error');return;}// Segundo intento con precisión normal\nnavigator.geolocation.getCurrentPosition(position=>{console.log('📍 GPS con precisión normal:',position.coords);console.log('   - Precisión:',position.coords.accuracy,'metros');const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');},error2=>{console.error('❌ No se pudo obtener GPS:',error2);// Última opción: ubicación de respaldo\nconst testPosition={lat:-36.7508+(Math.random()-0.5)*0.001,lng:-72.4698+(Math.random()-0.5)*0.001,accuracy:100};updateUserPosition(testPosition);setGpsStatus('active');},{enableHighAccuracy:false,// Precisión normal\ntimeout:10000,maximumAge:30000});},{enableHighAccuracy:true,// 🔴 ALTA PRECISIÓN primero\ntimeout:15000,// 15 segundos para alta precisión\nmaximumAge:0// No usar caché\n});}// Seguimiento continuo con ALTA PRECISIÓN\nconst gpsWatchId=navigator.geolocation.watchPosition(position=>{console.log('📍 GPS - Actualización:',position.coords);console.log('   - Precisión:',position.coords.accuracy,'metros');// Solo actualizar si la precisión es mejor que 150 metros\nif(position.coords.accuracy<=150){const pos={lat:position.coords.latitude,lng:position.coords.longitude,accuracy:position.coords.accuracy};updateUserPosition(pos);setGpsStatus('active');}else{console.log('⚠️ Precisión insuficiente, esperando mejor señal...');}},error=>{console.log('⏱️ Esperando señal GPS...',error.message);},{enableHighAccuracy:true,// 🔴 ALTA PRECISIÓN\ntimeout:30000,maximumAge:0,// Siempre ubicación fresca\ndistanceFilter:5// Actualizar cada 5 metros de movimiento\n});watchIdRef.current=gpsWatchId;}};// Seleccionar zona de trabajo\nconst selectZona=zona=>{setSelectedZona(zona);if(!map||!window.google)return;// Limpiar marcador anterior\nif(zonaMarkerRef.current){zonaMarkerRef.current.setMap(null);}// Crear marcador de zona\nzonaMarkerRef.current=new window.google.maps.Marker({position:{lat:zona.lat,lng:zona.lng},map:map,title:zona.nombre,icon:{path:window.google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,scale:8,fillColor:'#22c55e',fillOpacity:1,strokeColor:'#ffffff',strokeWeight:2}});// Ajustar vista para mostrar ambos puntos\nif(userPosition){const bounds=new window.google.maps.LatLngBounds();bounds.extend(userPosition);bounds.extend({lat:zona.lat,lng:zona.lng});map.fitBounds(bounds,100);}else{map.setCenter({lat:zona.lat,lng:zona.lng});map.setZoom(15);}};// Iniciar navegación\nconst startNavigation=async()=>{if(!selectedZona||!userPosition){alert('Debes activar el GPS y seleccionar una zona primero');return;}setIsNavigating(true);setWorkStatus('traveling');setWorkLog({...workLog,startTime:new Date().toISOString(),zona:selectedZona});// 🔥 Actualizar estado en Firebase y en la zona\ntry{// Actualizar estado del trabajador\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'en_camino',zonaDestino:selectedZona.nombre,recorridoInicio:new Date().toISOString()});// Actualizar estado de la zona a \"en_progreso\"\nif(selectedZona.id){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'en_progreso',ultimaActualizacion:new Date().toISOString()});}// 🔥 NUEVO: Actualizar estado del vehículo asignado\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'en_uso',operadorEnRuta:currentUser.name||currentUser.email,zonaDestino:selectedZona.nombre,ultimaActualizacion:new Date().toISOString()});console.log('✅ Vehículo marcado como en uso');}console.log('✅ Estado actualizado a \"en_camino\" en Firebase');}catch(error){console.error('Error al actualizar estado en Firebase:',error);}// Calcular y mostrar ruta\nconst request={origin:userPosition,destination:{lat:selectedZona.lat,lng:selectedZona.lng},travelMode:window.google.maps.TravelMode.DRIVING,// Agregar estas opciones para mejor cálculo de ruta\nunitSystem:window.google.maps.UnitSystem.METRIC,region:'CL',// Chile\navoidHighways:false,avoidTolls:false,optimizeWaypoints:true,provideRouteAlternatives:true// Obtener rutas alternativas\n};directionsServiceRef.current.route(request,(result,status)=>{if(status==='OK'){console.log('✅ Ruta calculada exitosamente');console.log('Rutas disponibles:',result.routes.length);// Usar la mejor ruta disponible\ndirectionsRendererRef.current.setDirections(result);const route=result.routes[0];const leg=route.legs[0];setDistance(leg.distance.text);setDuration(leg.duration.text);// Información adicional de la ruta\nconsole.log('📍 Distancia:',leg.distance.text);console.log('⏱️ Duración estimada:',leg.duration.text);console.log('📍 Dirección inicio:',leg.start_address);console.log('📍 Dirección destino:',leg.end_address);// Si hay rutas alternativas, informar al usuario\nif(result.routes.length>1){console.log(`ℹ️ Hay ${result.routes.length} rutas disponibles`);}}else if(status==='ZERO_RESULTS'){console.warn('⚠️ No se encontró ruta por carretera, intentando ruta aproximada...');// Intentar con modo WALKING si DRIVING no funciona\nconst walkingRequest={...request,travelMode:window.google.maps.TravelMode.WALKING};directionsServiceRef.current.route(walkingRequest,(walkResult,walkStatus)=>{if(walkStatus==='OK'){directionsRendererRef.current.setDirections(walkResult);const leg=walkResult.routes[0].legs[0];setDistance(leg.distance.text+' (a pie)');setDuration(leg.duration.text+' (caminando)');alert('⚠️ No hay ruta vehicular directa. Mostrando ruta a pie.');}else{// Si tampoco hay ruta a pie, mostrar línea directa\nmostrarLineaDirecta();}});}else{console.error('Error al calcular ruta:',status);mostrarLineaDirecta();}});};// Función auxiliar para mostrar línea directa cuando no hay ruta\nconst mostrarLineaDirecta=()=>{if(window.google&&window.google.maps&&window.google.maps.geometry){const distanceInMeters=window.google.maps.geometry.spherical.computeDistanceBetween(new window.google.maps.LatLng(userPosition.lat,userPosition.lng),new window.google.maps.LatLng(selectedZona.lat,selectedZona.lng));const distanceInKm=(distanceInMeters/1000).toFixed(2);setDistance(`~${distanceInKm} km (línea recta)`);setDuration('No disponible');// Crear polilínea directa\nif(directionsRendererRef.current.polyline){directionsRendererRef.current.polyline.setMap(null);}const line=new window.google.maps.Polyline({path:[userPosition,{lat:selectedZona.lat,lng:selectedZona.lng}],geodesic:true,strokeColor:'#FF0000',strokeOpacity:0.8,strokeWeight:3,strokePattern:[10,10],// Línea punteada para indicar que no es una ruta real\nmap:map});directionsRendererRef.current.polyline=line;alert('⚠️ No hay ruta disponible por carretera. Mostrando dirección aproximada.');}};// Manejar llegada a la zona - MEJORADO\nconst handleArrival=async()=>{setWorkStatus('working');const arrivalTime=new Date().toISOString();setWorkLog({...workLog,arrivalTime:arrivalTime});// 🔥 Actualizar estado en Firebase\ntry{await trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'trabajando',horaLlegada:arrivalTime});// 🔥 NUEVO: Mantener vehículo en uso pero actualizar ubicación\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'en_uso',enZonaTrabajo:true,ultimaActualizacion:new Date().toISOString()});}console.log('✅ Llegada registrada en Firebase');}catch(error){console.error('Error al registrar llegada en Firebase:',error);}// Limpiar la ruta del mapa al llegar\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}console.log('✅ Trabajador ha llegado a la zona y está trabajando');};// Finalizar trabajo mejorado con registro de detalles\nconst finishWork=async()=>{const endTime=new Date().toISOString();const tiempoTrabajado=workLog.arrivalTime?Math.floor((new Date(endTime)-new Date(workLog.arrivalTime))/60000):0;// minutos\nconst finalLog={...workLog,endTime:endTime,tiempoTrabajadoMinutos:tiempoTrabajado};setWorkLog(finalLog);setWorkStatus('completed');setIsNavigating(false);setShowWorkLog(true);// Limpiar ruta\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}// 🔥 Registrar finalización en Firebase y actualizar zona\ntry{// Actualizar estado del trabajador\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'disponible',zonaDestino:null,ultimoTrabajo:{zona:selectedZona.nombre,zonaId:selectedZona.id,horaInicio:workLog.startTime,horaLlegada:workLog.arrivalTime,horaFin:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,completado:true}});// 🔥 NUEVO: Marcar vehículo como disponible nuevamente\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()});console.log('✅ Vehículo marcado como disponible');}// Marcar zona como completada\nif(selectedZona.id){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'completado',fechaCompletado:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,completadoPor:currentUser.uid,ultimaActualizacion:new Date().toISOString()});}// Crear registro en historial\nconst historialRef=ref(database,`historial_trabajos/${currentUser.uid}/${Date.now()}`);await set(historialRef,{trabajadorId:currentUser.uid,trabajadorNombre:currentUser.name||currentUser.email,zonaId:selectedZona.id,zonaNombre:selectedZona.nombre,zonaDireccion:selectedZona.direccion,horaInicio:workLog.startTime,horaLlegada:workLog.arrivalTime,horaFin:endTime,tiempoTrabajadoMinutos:tiempoTrabajado,estado:'completado',fecha:new Date().toISOString().split('T')[0]});console.log('✅ Trabajo completado y registrado en Firebase');// Mostrar notificación de éxito\nalert('✅ ¡Excelente trabajo! La tarea ha sido marcada como completada.');}catch(error){console.error('Error al registrar finalización en Firebase:',error);alert('⚠️ Error al guardar. El trabajo se completó pero hubo un problema al registrarlo.');}console.log('Registro de trabajo:',finalLog);};// Cancelar navegación/trabajo\nconst cancelNavigation=async()=>{if(!window.confirm('¿Estás seguro de cancelar el recorrido actual?')){return;}// Limpiar estados\nsetIsNavigating(false);setWorkStatus('idle');setDistance(null);setDuration(null);// Limpiar ruta del mapa\nif(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}// Actualizar estado en Firebase\ntry{await trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'disponible',zonaDestino:null,recorridoCancelado:new Date().toISOString()});// 🔥 NUEVO: Marcar vehículo como disponible si estaba en uso\nif(currentUser.vehicleId){const vehicleRef=ref(database,`vehiculos/${currentUser.vehicleId}`);await update(vehicleRef,{estado:'disponible',operadorEnRuta:null,zonaDestino:null,enZonaTrabajo:false,ultimaActualizacion:new Date().toISOString()});console.log('✅ Vehículo liberado y marcado como disponible');}// Si había una zona en progreso, cambiarla a pendiente\nif(selectedZona&&selectedZona.id&&workStatus!=='idle'){await update(ref(database,`zonas_asignadas/${selectedZona.id}`),{estado:'pendiente',ultimaActualizacion:new Date().toISOString()});}console.log('✅ Recorrido cancelado');}catch(error){console.error('Error al cancelar recorrido:',error);}// Mantener la zona seleccionada por si quiere reintentar\nalert('Recorrido cancelado. Puedes iniciar uno nuevo cuando quieras.');};// Resetear para nuevo trabajo\nconst resetWork=()=>{setSelectedZona(null);setWorkStatus('idle');setWorkLog({startTime:null,arrivalTime:null,endTime:null,zona:null});setIsNavigating(false);setDistance(null);setDuration(null);setShowWorkLog(false);if(zonaMarkerRef.current){zonaMarkerRef.current.setMap(null);zonaMarkerRef.current=null;}if(directionsRendererRef.current){directionsRendererRef.current.setDirections({routes:[]});}};// Formatear tiempo\nconst formatTime=isoString=>{if(!isoString)return'--:--';const date=new Date(isoString);return date.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit',hour12:false});};// Calcular duración\nconst calculateDuration=(start,end)=>{if(!start||!end)return'--';const diff=new Date(end)-new Date(start);const hours=Math.floor(diff/3600000);const minutes=Math.floor(diff%3600000/60000);return`${hours}h ${minutes}m`;};// Limpiar al desmontar componente\nuseEffect(()=>{return()=>{// Limpiar GPS al salir\nif(watchIdRef.current){navigator.geolocation.clearWatch(watchIdRef.current);}// Marcar como inactivo en Firebase\nif(currentUser!==null&&currentUser!==void 0&&currentUser.uid){trabajadoresService.updateTrabajadorData(currentUser.uid,{estado:'inactivo',ubicacion:null}).catch(console.error);}};},[currentUser]);if(error){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),children:\"Reintentar\"})]});}// Estilos responsivos\nconst styles={container:{width:'100%',height:'100vh',position:'relative',overflow:'hidden'},header:{position:'fixed',top:0,left:0,right:0,background:'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',color:'white',padding:isMobile?'10px 15px':'15px 20px',zIndex:1002,boxShadow:'0 2px 10px rgba(0,0,0,0.1)'},panel:{position:'fixed',top:isMobile?'60px':'70px',left:showPanel?'0':'-100%',width:isMobile?'100%':'400px',maxWidth:'100%',height:isMobile?'auto':'calc(100vh - 70px)',maxHeight:isMobile?'60vh':'calc(100vh - 70px)',background:'white',boxShadow:'2px 0 10px rgba(0,0,0,0.1)',overflowY:'auto',transition:'left 0.3s ease',zIndex:1001,padding:isMobile?'15px':'20px'},map:{width:'100%',height:'100%',position:'absolute',top:0,left:0},button:{width:'100%',padding:isMobile?'14px':'12px',fontSize:isMobile?'16px':'14px',border:'none',borderRadius:'8px',fontWeight:'500',cursor:'pointer',marginBottom:'10px',touchAction:'manipulation'},floatingButton:{position:'fixed',bottom:isMobile?'20px':'30px',right:isMobile?'20px':'30px',width:isMobile?'60px':'50px',height:isMobile?'60px':'50px',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 4px 12px rgba(0,0,0,0.2)',zIndex:1000,cursor:'pointer',fontSize:isMobile?'24px':'20px'}};return/*#__PURE__*/_jsxs(\"div\",{style:styles.container,children:[/*#__PURE__*/_jsx(\"div\",{ref:mapRef,style:styles.map}),/*#__PURE__*/_jsx(\"div\",{style:styles.header,children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:isMobile?'wrap':'nowrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowPanel(!showPanel),style:{padding:isMobile?'8px':'6px 10px',background:'rgba(255,255,255,0.2)',color:'white',border:'1px solid rgba(255,255,255,0.3)',borderRadius:'6px',cursor:'pointer',fontSize:isMobile?'20px':'14px',touchAction:'manipulation'},children:showPanel?'☰':'☰'}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"h1\",{style:{margin:0,fontSize:isMobile?'18px':'20px',fontWeight:'600'},children:[\"\\uD83D\\uDC77\\u200D\\u2642\\uFE0F \",currentUser.name||'Trabajador']})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onLogout,style:{padding:isMobile?'6px 10px':'8px 16px',background:'rgba(255,255,255,0.2)',color:'white',border:'1px solid rgba(255,255,255,0.3)',borderRadius:'6px',cursor:'pointer',fontSize:isMobile?'12px':'14px',touchAction:'manipulation'},children:\"Salir\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:styles.panel,children:[notificaciones.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px',padding:'10px',background:'#fef3c7',border:'1px solid #fde68a',borderRadius:'8px'},children:[/*#__PURE__*/_jsxs(\"h4\",{style:{margin:'0 0 8px 0',fontSize:'14px',color:'#92400e'},children:[\"\\uD83D\\uDD14 Nuevas notificaciones (\",notificaciones.length,\")\"]}),notificaciones.map(notif=>/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',marginBottom:'4px'},children:[\"\\u2022 \",notif.mensaje]},notif.id))]}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleGPS,style:{...styles.button,background:isTracking?'#ef4444':'#22c55e',color:'white'},children:isTracking?'📍 Desactivar GPS':'📍 Activar GPS'}),gpsStatus!=='inactive'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px',padding:'8px',borderRadius:'6px',fontSize:'12px',textAlign:'center',background:gpsStatus==='active'?'#dcfce7':gpsStatus==='activating'?'#fef3c7':'#fee2e2',color:gpsStatus==='active'?'#166534':gpsStatus==='activating'?'#92400e':'#991b1b'},children:[gpsStatus==='active'&&'🟢 GPS activo',gpsStatus==='activating'&&'🟡 Activando GPS...',gpsStatus==='error'&&'🔴 Error en GPS']}),isTracking&&workStatus==='idle'&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontSize:'14px',fontWeight:'500'},children:\"\\uD83C\\uDFD7\\uFE0F Zona de Trabajo:\"}),zonasAsignadas.length>0?/*#__PURE__*/_jsxs(\"select\",{value:(selectedZona===null||selectedZona===void 0?void 0:selectedZona.id)||'',onChange:e=>{const zona=zonasAsignadas.find(z=>z.id===e.target.value);if(zona)selectZona(zona);},style:{width:'100%',padding:'10px',borderRadius:'6px',border:'1px solid #ddd',fontSize:isMobile?'16px':'14px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Seleccionar --\"}),zonasAsignadas.map(zona=>/*#__PURE__*/_jsx(\"option\",{value:zona.id,children:zona.nombre},zona.id))]}):/*#__PURE__*/_jsx(\"div\",{style:{padding:'10px',background:'#f3f4f6',borderRadius:'6px',textAlign:'center',fontSize:'13px',color:'#6b7280'},children:\"No hay zonas asignadas\"})]}),selectedZona&&workStatus==='idle'&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f0f9ff',padding:'12px',borderRadius:'8px',marginBottom:'15px',border:'1px solid #bae6fd'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 8px 0',color:'#0369a1',fontSize:'14px'},children:selectedZona.nombre}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:0,fontSize:'12px',color:'#333'},children:[\"\\uD83D\\uDCCD \",selectedZona.direccion]})]}),workStatus==='idle'&&selectedZona&&userPosition&&/*#__PURE__*/_jsx(\"button\",{onClick:startNavigation,style:{...styles.button,background:'#3b82f6',color:'white'},children:\"\\uD83D\\uDE97 Iniciar Recorrido\"}),workStatus==='traveling'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fef3c7',padding:'12px',borderRadius:'8px',marginBottom:'12px',border:'1px solid #fde68a'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px',fontWeight:'500',color:'#92400e'},children:\"\\uD83D\\uDE97 En camino a la zona\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',marginTop:'4px',color:'#78350f'},children:[\"\\uD83D\\uDCCD \",selectedZona===null||selectedZona===void 0?void 0:selectedZona.nombre]}),distance&&duration&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'8px',fontSize:'13px'},children:[\"\\uD83D\\uDCCF \",distance,\" \\u2022 \\u23F1\\uFE0F \",duration]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{handleArrival();},style:{...styles.button,background:'#10b981',color:'white',fontSize:isMobile?'16px':'14px',fontWeight:'600',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px'},children:\"\\uD83D\\uDCCD Ya llegu\\xE9 a la zona\"}),/*#__PURE__*/_jsx(\"button\",{onClick:cancelNavigation,style:{...styles.button,background:'white',color:'#ef4444',border:'2px solid #ef4444'},children:\"\\u274C Cancelar Recorrido\"})]}),workStatus==='working'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'#dcfce7',padding:'15px',borderRadius:'8px',marginBottom:'15px',border:'2px solid #22c55e'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:isMobile?'18px':'16px',fontWeight:'600',color:'#14532d',marginBottom:'8px'},children:\"\\uD83D\\uDD27 TRABAJANDO EN ZONA\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#166534'},children:[\"\\uD83D\\uDCCD \",selectedZona===null||selectedZona===void 0?void 0:selectedZona.nombre]}),(selectedZona===null||selectedZona===void 0?void 0:selectedZona.descripcion)&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',padding:'8px',background:'#f0fdf4',borderRadius:'6px',fontSize:'13px',color:'#15803d'},children:[\"\\uD83D\\uDCCB \",selectedZona.descripcion]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',marginTop:'8px',color:'#166534'},children:[\"\\u23F0 Llegada: \",formatTime(workLog.arrivalTime)]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('¿Confirmas que has completado toda la tarea asignada?')){finishWork();}},style:{...styles.button,background:'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',color:'white',padding:isMobile?'18px':'16px',fontSize:isMobile?'18px':'16px',fontWeight:'700',boxShadow:'0 4px 12px rgba(34, 197, 94, 0.3)',textTransform:'uppercase',letterSpacing:'0.5px'},children:\"\\u2705 MARCAR TAREA COMO COMPLETADA\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'12px',color:'#6b7280',textAlign:'center',margin:'8px 0'},children:\"Presiona cuando hayas terminado todo el trabajo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('¿Cancelar el trabajo? La zona volverá a estado pendiente.')){cancelNavigation();}},style:{...styles.button,background:'white',color:'#ef4444',border:'2px solid #ef4444',fontSize:isMobile?'14px':'13px'},children:\"\\u274C No puedo completar la tarea\"})]}),workStatus==='completed'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{background:'#e0e7ff',padding:'12px',borderRadius:'8px',marginBottom:'12px',border:'1px solid #c7d2fe',textAlign:'center'},children:/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'16px',fontWeight:'500',color:'#312e81'},children:\"\\u2705 Trabajo Completado\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:resetWork,style:{...styles.button,background:'#22c55e',color:'white'},children:\"\\uD83D\\uDD04 Nuevo Trabajo\"})]})]}),!showPanel&&workStatus!=='idle'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowPanel(true),style:{...styles.floatingButton,background:workStatus==='traveling'?'#f59e0b':workStatus==='working'?'#3b82f6':'#22c55e',color:'white',border:'none'},children:[workStatus==='traveling'&&'🚗',workStatus==='working'&&'🔧',workStatus==='completed'&&'✅']}),showWorkLog&&workLog.zona&&/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:2000,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'white',borderRadius:'12px',padding:isMobile?'15px':'20px',maxWidth:isMobile?'100%':'400px',width:'100%',maxHeight:'80vh',overflow:'auto'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'#1f2937',fontSize:isMobile?'18px':'20px'},children:\"\\uD83D\\uDCCB Resumen del Trabajo\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:isMobile?'13px':'14px',lineHeight:'1.8'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:workLog.zona.nombre}),/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83D\\uDCCD \",workLog.zona.direccion]}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f8fafc',padding:'12px',borderRadius:'8px',marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u23F1\\uFE0F Tiempo trabajado: \",calculateDuration(workLog.arrivalTime,workLog.endTime)]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'10px',padding:'8px',background:'#dcfce7',borderRadius:'6px',textAlign:'center',fontWeight:'bold',color:'#166534'},children:\"\\u2705 COMPLETADO\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowWorkLog(false),style:{...styles.button,background:'#6b7280',color:'white'},children:\"Cerrar\"})]})]})}),!mapLoaded&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',textAlign:'center',zIndex:1001},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'50px',height:'50px',border:'4px solid #f3f3f3',borderTop:'4px solid #22c55e',borderRadius:'50%',animation:'spin 1s linear infinite'}}),/*#__PURE__*/_jsx(\"p\",{style:{marginTop:'10px',color:'#666'},children:\"Cargando mapa...\"})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      `})]});};export default SistemaTrabajadoresFirebase;","map":{"version":3,"names":["React","useEffect","useRef","useState","trabajadoresService","database","ref","onValue","update","set","jsx","_jsx","jsxs","_jsxs","SistemaTrabajadoresFirebase","_ref","currentUser","onLogout","console","log","mapRef","map","setMap","userPosition","setUserPosition","selectedZona","setSelectedZona","isTracking","setIsTracking","isNavigating","setIsNavigating","workStatus","setWorkStatus","workLog","setWorkLog","startTime","arrivalTime","endTime","zona","zonasAsignadas","setZonasAsignadas","notificaciones","setNotificaciones","showPanel","setShowPanel","isMobile","setIsMobile","userMarkerRef","zonaMarkerRef","directionsServiceRef","directionsRendererRef","watchIdRef","lastUpdateRef","mapLoaded","setMapLoaded","error","setError","distance","setDistance","duration","setDuration","showWorkLog","setShowWorkLog","gpsStatus","setGpsStatus","API_KEY","checkMobile","window","innerWidth","addEventListener","removeEventListener","uid","zonasRef","unsubZonas","snapshot","data","val","zonasArray","Object","entries","filter","_ref2","id","trabajadorAsignado","estado","_ref3","notifRef","unsubNotif","notifArray","_ref4","notif","trabajadorId","leido","_ref5","createOrUpdateTrabajador","nombre","name","email","telefono","phone","vehicleId","rol","ubicacion","createdAt","Date","toISOString","ultimaActualizacion","then","catch","loadGoogleMaps","Promise","resolve","reject","google","maps","existingScript","document","querySelector","Error","script","createElement","src","async","defer","onload","onerror","head","appendChild","initMap","current","mapInstance","Map","center","lat","lng","zoom","mapTypeId","zoomControl","mapTypeControl","scaleControl","streetViewControl","rotateControl","fullscreenControl","gestureHandling","DirectionsService","DirectionsRenderer","suppressMarkers","polylineOptions","strokeColor","strokeWeight","strokeOpacity","markerOptions","startMarker","label","title","endMarker","preserveViewport","err","message","updateUserPosition","position","accuracy","ahora","now","updateTrabajadorLocation","timestamp","estadoActual","updateTrabajadorData","zonaDestino","Marker","icon","path","SymbolPath","CIRCLE","scale","fillColor","fillOpacity","zIndex","setCenter","setZoom","setPosition","geometry","spherical","computeDistanceBetween","LatLng","Math","round","toggleGPS","navigator","geolocation","clearWatch","vehicleRef","operadorEnRuta","enZonaTrabajo","alert","getCurrentPosition","coords","pos","latitude","longitude","enableHighAccuracy","timeout","maximumAge","warn","code","PERMISSION_DENIED","error2","testPosition","random","gpsWatchId","watchPosition","distanceFilter","selectZona","BACKWARD_CLOSED_ARROW","bounds","LatLngBounds","extend","fitBounds","startNavigation","recorridoInicio","request","origin","destination","travelMode","TravelMode","DRIVING","unitSystem","UnitSystem","METRIC","region","avoidHighways","avoidTolls","optimizeWaypoints","provideRouteAlternatives","route","result","status","routes","length","setDirections","leg","legs","text","start_address","end_address","walkingRequest","WALKING","walkResult","walkStatus","mostrarLineaDirecta","distanceInMeters","distanceInKm","toFixed","polyline","line","Polyline","geodesic","strokePattern","handleArrival","horaLlegada","finishWork","tiempoTrabajado","floor","finalLog","tiempoTrabajadoMinutos","ultimoTrabajo","zonaId","horaInicio","horaFin","completado","fechaCompletado","completadoPor","historialRef","trabajadorNombre","zonaNombre","zonaDireccion","direccion","fecha","split","cancelNavigation","confirm","recorridoCancelado","resetWork","formatTime","isoString","date","toLocaleTimeString","hour","minute","hour12","calculateDuration","start","end","diff","hours","minutes","style","padding","textAlign","children","onClick","location","reload","styles","container","width","height","overflow","header","top","left","right","background","color","boxShadow","panel","maxWidth","maxHeight","overflowY","transition","button","fontSize","border","borderRadius","fontWeight","cursor","marginBottom","touchAction","floatingButton","bottom","display","alignItems","justifyContent","flexWrap","gap","margin","mensaje","value","onChange","e","find","z","target","marginTop","descripcion","textTransform","letterSpacing","lineHeight","transform","borderTop","animation"],"sources":["C:/Users/Izan/Desktop/AppReact/mapa-quillon/src/components/SistemaTrabajadoresFirebase.js"],"sourcesContent":["// src/components/SistemaTrabajadoresFirebase.js\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { trabajadoresService } from '../services/firebaseservices';\r\nimport { database } from '../config/firebase';\r\nimport { ref, onValue, update, set } from 'firebase/database';\r\n\r\nconst SistemaTrabajadoresFirebase = ({ currentUser, onLogout }) => {\r\n  // Log para debugging\r\n  console.log('🔍 Current User Data:', currentUser);\r\n  \r\n  // Estados principales\r\n  const mapRef = useRef(null);\r\n  const [map, setMap] = useState(null);\r\n  const [userPosition, setUserPosition] = useState(null);\r\n  const [selectedZona, setSelectedZona] = useState(null);\r\n  const [isTracking, setIsTracking] = useState(false);\r\n  const [isNavigating, setIsNavigating] = useState(false);\r\n  const [workStatus, setWorkStatus] = useState('idle'); // idle, traveling, working, completed\r\n  const [workLog, setWorkLog] = useState({\r\n    startTime: null,\r\n    arrivalTime: null,\r\n    endTime: null,\r\n    zona: null\r\n  });\r\n  \r\n  // Estados para zonas y notificaciones\r\n  const [zonasAsignadas, setZonasAsignadas] = useState([]);\r\n  const [notificaciones, setNotificaciones] = useState([]);\r\n  const [showPanel, setShowPanel] = useState(true); // Estado para mostrar/ocultar panel\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  \r\n  // Referencias para marcadores y servicios\r\n  const userMarkerRef = useRef(null);\r\n  const zonaMarkerRef = useRef(null);\r\n  const directionsServiceRef = useRef(null);\r\n  const directionsRendererRef = useRef(null);\r\n  const watchIdRef = useRef(null);\r\n  const lastUpdateRef = useRef(null);\r\n  \r\n  // Estados de UI\r\n  const [mapLoaded, setMapLoaded] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [distance, setDistance] = useState(null);\r\n  const [duration, setDuration] = useState(null);\r\n  const [showWorkLog, setShowWorkLog] = useState(false);\r\n  const [gpsStatus, setGpsStatus] = useState('inactive'); // inactive, activating, active, error\r\n\r\n  const API_KEY = 'AIzaSyA7DrdL36n5cx-RNzuXGAQggFeGCheHDbY';\r\n\r\n  // Detectar si es móvil\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth <= 768);\r\n    };\r\n    \r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    \r\n    return () => window.removeEventListener('resize', checkMobile);\r\n  }, []);\r\n\r\n  // Cargar zonas asignadas desde Firebase\r\n  useEffect(() => {\r\n    if (currentUser && currentUser.uid) {\r\n      console.log('🔄 Cargando zonas asignadas para trabajador:', currentUser.uid);\r\n      \r\n      // Escuchar zonas asignadas al trabajador\r\n      const zonasRef = ref(database, 'zonas_asignadas');\r\n      const unsubZonas = onValue(zonasRef, (snapshot) => {\r\n        const data = snapshot.val();\r\n        console.log('📦 Datos de zonas recibidos:', data);\r\n        \r\n        if (data) {\r\n          // Filtrar solo las zonas asignadas a este trabajador\r\n          const zonasArray = Object.entries(data)\r\n            .filter(([id, zona]) => {\r\n              console.log(`Zona ${id}: asignada a ${zona.trabajadorAsignado}, yo soy ${currentUser.uid}`);\r\n              return zona.trabajadorAsignado === currentUser.uid && zona.estado !== 'completado';\r\n            })\r\n            .map(([id, zona]) => ({\r\n              id,\r\n              ...zona\r\n            }));\r\n          \r\n          console.log('✅ Zonas asignadas filtradas:', zonasArray);\r\n          setZonasAsignadas(zonasArray);\r\n        } else {\r\n          console.log('⚠️ No hay zonas en Firebase');\r\n          setZonasAsignadas([]);\r\n        }\r\n      });\r\n\r\n      // Escuchar notificaciones\r\n      const notifRef = ref(database, 'notificaciones');\r\n      const unsubNotif = onValue(notifRef, (snapshot) => {\r\n        const data = snapshot.val();\r\n        if (data) {\r\n          const notifArray = Object.entries(data)\r\n            .filter(([id, notif]) => notif.trabajadorId === currentUser.uid && !notif.leido)\r\n            .map(([id, notif]) => ({\r\n              id,\r\n              ...notif\r\n            }));\r\n          setNotificaciones(notifArray);\r\n        }\r\n      });\r\n\r\n      return () => {\r\n        unsubZonas();\r\n        unsubNotif();\r\n      };\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Registrar trabajador al montar el componente\r\n  useEffect(() => {\r\n    if (currentUser && currentUser.uid) {\r\n      console.log('🔄 Registrando trabajador al iniciar...');\r\n      \r\n      // Crear o actualizar el trabajador en Realtime Database\r\n      trabajadoresService.createOrUpdateTrabajador(currentUser.uid, {\r\n        nombre: currentUser.name || currentUser.email || 'Trabajador',\r\n        email: currentUser.email,\r\n        telefono: currentUser.phone || '',\r\n        vehicleId: currentUser.vehicleId || null,\r\n        estado: 'inactivo',\r\n        rol: 'trabajador',\r\n        ubicacion: null,\r\n        createdAt: new Date().toISOString(),\r\n        ultimaActualizacion: new Date().toISOString()\r\n      }).then(() => {\r\n        console.log('✅ Trabajador registrado en Realtime Database al iniciar');\r\n      }).catch(error => {\r\n        console.error('❌ Error al registrar trabajador al iniciar:', error);\r\n      });\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Función para cargar Google Maps\r\n  useEffect(() => {\r\n    const loadGoogleMaps = () => {\r\n      return new Promise((resolve, reject) => {\r\n        if (window.google && window.google.maps) {\r\n          resolve(window.google.maps);\r\n          return;\r\n        }\r\n\r\n        const existingScript = document.querySelector('script[src*=\"maps.googleapis.com\"]');\r\n        if (existingScript) {\r\n          existingScript.addEventListener('load', () => {\r\n            if (window.google && window.google.maps) {\r\n              resolve(window.google.maps);\r\n            } else {\r\n              reject(new Error('Google Maps no disponible'));\r\n            }\r\n          });\r\n          return;\r\n        }\r\n\r\n        const script = document.createElement('script');\r\n        script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places,geometry&v=weekly`;\r\n        script.async = true;\r\n        script.defer = true;\r\n\r\n        script.onload = () => {\r\n          if (window.google && window.google.maps) {\r\n            resolve(window.google.maps);\r\n          } else {\r\n            reject(new Error('Google Maps no disponible'));\r\n          }\r\n        };\r\n\r\n        script.onerror = () => {\r\n          reject(new Error('Error al cargar Google Maps'));\r\n        };\r\n\r\n        document.head.appendChild(script);\r\n      });\r\n    };\r\n\r\n    const initMap = async () => {\r\n      try {\r\n        const maps = await loadGoogleMaps();\r\n        \r\n        if (!mapRef.current) return;\r\n\r\n        const mapInstance = new maps.Map(mapRef.current, {\r\n          center: { lat: -36.7333, lng: -72.4667 },\r\n          zoom: 13,\r\n          mapTypeId: 'roadmap',\r\n          zoomControl: !isMobile,\r\n          mapTypeControl: false,\r\n          scaleControl: false,\r\n          streetViewControl: false,\r\n          rotateControl: false,\r\n          fullscreenControl: true,\r\n          gestureHandling: 'greedy' // Mejor para móviles\r\n        });\r\n\r\n        setMap(mapInstance);\r\n        \r\n        // Inicializar servicios de direcciones\r\n        // Inicializar servicios de direcciones\r\ndirectionsServiceRef.current = new maps.DirectionsService();\r\ndirectionsRendererRef.current = new maps.DirectionsRenderer({\r\n  map: mapInstance,\r\n  suppressMarkers: false, // Mostrar marcadores A y B\r\n  polylineOptions: {\r\n    strokeColor: '#4285F4',\r\n    strokeWeight: 6,\r\n    strokeOpacity: 0.8\r\n  },\r\n  // Agregar estas opciones para mejor visualización\r\n  markerOptions: {\r\n    startMarker: {\r\n      label: 'A',\r\n      title: 'Tu ubicación'\r\n    },\r\n    endMarker: {\r\n      label: 'B', \r\n      title: 'Zona de trabajo'\r\n    }\r\n  },\r\n  preserveViewport: false // Ajustar vista automáticamente a la ruta\r\n});\r\n\r\n        setMapLoaded(true);\r\n      } catch (err) {\r\n        setError('Error al cargar el mapa: ' + err.message);\r\n      }\r\n    };\r\n\r\n    initMap();\r\n  }, [isMobile]);\r\n\r\n  // 🔥 FUNCIÓN CRÍTICA - Actualizar posición del usuario Y ENVIAR A FIREBASE\r\n  const updateUserPosition = (position) => {\r\n    console.log('🔄 Actualizando posición:', position);\r\n    setUserPosition(position);\r\n    \r\n    // Mostrar precisión en el UI\r\n    if (window.google && map) {\r\n      // Opcional: Mostrar círculo de precisión en el mapa\r\n      const accuracy = position.accuracy || 100;\r\n      console.log('📍 Precisión actual:', accuracy, 'metros');\r\n    }\r\n    \r\n    // 🔥 ENVIAR UBICACIÓN A FIREBASE - ESTO ES LO QUE FALTABA\r\n    // Solo actualizar si ha pasado al menos 5 segundos desde la última actualización\r\n    const ahora = Date.now();\r\n    if (!lastUpdateRef.current || (ahora - lastUpdateRef.current) > 5000) {\r\n      console.log('📍 Enviando ubicación a Firebase:', position);\r\n      \r\n      if (currentUser && currentUser.uid) {\r\n        // Actualizar ubicación en Firebase\r\n        trabajadoresService.updateTrabajadorLocation(currentUser.uid, {\r\n          lat: position.lat,\r\n          lng: position.lng,\r\n          timestamp: new Date().toISOString(),\r\n          accuracy: position.accuracy || null // Guardar precisión también\r\n        }).then(() => {\r\n          console.log('✅ Ubicación enviada a Firebase exitosamente');\r\n          console.log('   - Trabajador ID:', currentUser.uid);\r\n          console.log('   - Posición:', position);\r\n        }).catch(error => {\r\n          console.error('❌ Error al enviar ubicación a Firebase:', error);\r\n          console.error('   - Detalles:', error.message);\r\n        });\r\n        \r\n        // También actualizar el estado del trabajador si es necesario\r\n        const estadoActual = workStatus === 'traveling' ? 'en_camino' : \r\n                            workStatus === 'working' ? 'trabajando' : \r\n                            'disponible';\r\n        \r\n        // Actualizar datos adicionales del trabajador\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          nombre: currentUser.name || currentUser.email,\r\n          email: currentUser.email,\r\n          estado: estadoActual,\r\n          zonaDestino: selectedZona ? selectedZona.nombre : null,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('✅ Datos del trabajador actualizados');\r\n        }).catch(error => {\r\n          console.error('❌ Error al actualizar datos del trabajador:', error);\r\n        });\r\n        \r\n        lastUpdateRef.current = ahora;\r\n      }\r\n    }\r\n    \r\n    // Actualizar marcador en el mapa local\r\n    if (!map || !window.google) return;\r\n\r\n    // Crear o actualizar marcador del usuario\r\n    if (!userMarkerRef.current) {\r\n      userMarkerRef.current = new window.google.maps.Marker({\r\n        position: position,\r\n        map: map,\r\n        title: 'Tu ubicación',\r\n        icon: {\r\n          path: window.google.maps.SymbolPath.CIRCLE,\r\n          scale: 10,\r\n          fillColor: '#4285F4',\r\n          fillOpacity: 1,\r\n          strokeColor: '#ffffff',\r\n          strokeWeight: 3\r\n        },\r\n        zIndex: 1000\r\n      });\r\n      \r\n      // Centrar mapa en usuario\r\n      map.setCenter(position);\r\n      map.setZoom(15);\r\n    } else {\r\n      userMarkerRef.current.setPosition(position);\r\n    }\r\n\r\n    // Si está navegando, actualizar distancia pero NO cambiar automáticamente a working\r\n    if (isNavigating && selectedZona) {\r\n      const distance = window.google.maps.geometry.spherical.computeDistanceBetween(\r\n        new window.google.maps.LatLng(position.lat, position.lng),\r\n        new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng)\r\n      );\r\n      \r\n      // Solo mostrar distancia, no cambiar estado automáticamente\r\n      console.log('📏 Distancia a la zona:', Math.round(distance), 'metros');\r\n    }\r\n  };\r\n\r\n  // Función para activar/desactivar GPS\r\n  const toggleGPS = () => {\r\n    if (isTracking) {\r\n      // Detener tracking\r\n      if (watchIdRef.current) {\r\n        navigator.geolocation.clearWatch(watchIdRef.current);\r\n        watchIdRef.current = null;\r\n      }\r\n      setIsTracking(false);\r\n      setGpsStatus('inactive');\r\n      \r\n      // Mantener última posición para la próxima activación\r\n      console.log('📍 GPS desactivado, última ubicación guardada:', userPosition);\r\n      \r\n      // Limpiar marcador de usuario\r\n      if (userMarkerRef.current) {\r\n        userMarkerRef.current.setMap(null);\r\n        userMarkerRef.current = null;\r\n      }\r\n      \r\n      // Limpiar ubicación en Firebase al desactivar GPS (sin await)\r\n      if (currentUser && currentUser.uid) {\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          estado: 'inactivo',\r\n          // NO borrar la ubicación, solo marcar como inactivo\r\n          // ubicacion: null, // COMENTADO - mantener última ubicación\r\n          ultimaActualizacion: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('📍 GPS desactivado - Estado actualizado a inactivo');\r\n        }).catch(error => {\r\n          console.error('Error al actualizar estado en Firebase:', error);\r\n        });\r\n        \r\n        // 🔥 NUEVO: Si hay un vehículo asignado y está en uso, liberarlo\r\n        if (currentUser.vehicleId && (workStatus === 'traveling' || workStatus === 'working')) {\r\n          const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n          update(vehicleRef, {\r\n            estado: 'disponible',\r\n            operadorEnRuta: null,\r\n            zonaDestino: null,\r\n            enZonaTrabajo: false,\r\n            ultimaActualizacion: new Date().toISOString()\r\n          }).then(() => {\r\n            console.log('✅ Vehículo liberado al desactivar GPS');\r\n          }).catch(error => {\r\n            console.error('Error al liberar vehículo:', error);\r\n          });\r\n        }\r\n      }\r\n      \r\n      // Mantener última posición conocida\r\n      console.log('📍 Última ubicación conocida guardada:', userPosition);\r\n    } else {\r\n      // Iniciar tracking\r\n      if (!navigator.geolocation) {\r\n        alert('Tu navegador no soporta geolocalización');\r\n        setGpsStatus('error');\r\n        return;\r\n      }\r\n\r\n      console.log('🔄 Iniciando GPS...');\r\n      setIsTracking(true);\r\n      setGpsStatus('activating');\r\n      \r\n      // Registrar el trabajador en Firebase si no existe (sin bloquear)\r\n      if (currentUser && currentUser.uid) {\r\n        console.log('📝 Registrando trabajador en Realtime Database...');\r\n        console.log('   - User ID:', currentUser.uid);\r\n        console.log('   - Datos:', currentUser);\r\n        \r\n        trabajadoresService.createOrUpdateTrabajador(currentUser.uid, {\r\n          nombre: currentUser.name || currentUser.email || 'Trabajador',\r\n          email: currentUser.email,\r\n          telefono: currentUser.phone || '',\r\n          estado: 'disponible',\r\n          rol: 'trabajador',\r\n          vehicleId: currentUser.vehicleId || null,\r\n          createdAt: new Date().toISOString()\r\n        }).then(() => {\r\n          console.log('✅ Trabajador registrado en Realtime Database');\r\n          console.log('   - Path: trabajadores/' + currentUser.uid);\r\n        }).catch(error => {\r\n          console.error('❌ Error al registrar trabajador:', error);\r\n          console.error('   - Detalles:', error.message);\r\n        });\r\n      } else {\r\n        console.error('⚠️ No hay currentUser o uid disponible');\r\n      }\r\n      \r\n      // Obtener posición inicial con ALTA PRECISIÓN\r\n      console.log('📍 Intentando obtener ubicación GPS de alta precisión...');\r\n      \r\n      // Si ya tenemos una posición previa, usarla mientras obtenemos la nueva\r\n      if (userPosition) {\r\n        console.log('📍 Usando última ubicación conocida mientras se obtiene GPS de alta precisión');\r\n        setGpsStatus('active');\r\n        \r\n        // Intentar obtener ubicación de ALTA PRECISIÓN en segundo plano\r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            console.log('📍 GPS de alta precisión actualizado:', position.coords);\r\n            console.log('   - Precisión:', position.coords.accuracy, 'metros');\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n          },\r\n          (error) => {\r\n            console.log('⚠️ GPS de alta precisión no disponible, usando precisión normal');\r\n          },\r\n          {\r\n            enableHighAccuracy: true, // 🔴 ALTA PRECISIÓN\r\n            timeout: 20000, // Más tiempo para alta precisión\r\n            maximumAge: 0 // No usar caché, queremos ubicación fresca\r\n          }\r\n        );\r\n      } else {\r\n        // Primera vez - intentar con alta precisión\r\n        setGpsStatus('activating');\r\n        \r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            console.log('✅ GPS de alta precisión obtenido:', position.coords);\r\n            console.log('   - Precisión:', position.coords.accuracy, 'metros');\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n            setGpsStatus('active');\r\n          },\r\n          (error) => {\r\n            console.warn('⚠️ Alta precisión falló, intentando con precisión normal:', error.message);\r\n            \r\n            if (error.code === error.PERMISSION_DENIED) {\r\n              alert('Por favor, habilita los permisos de ubicación en tu navegador');\r\n              setIsTracking(false);\r\n              setGpsStatus('error');\r\n              return;\r\n            }\r\n            \r\n            // Segundo intento con precisión normal\r\n            navigator.geolocation.getCurrentPosition(\r\n              (position) => {\r\n                console.log('📍 GPS con precisión normal:', position.coords);\r\n                console.log('   - Precisión:', position.coords.accuracy, 'metros');\r\n                const pos = {\r\n                  lat: position.coords.latitude,\r\n                  lng: position.coords.longitude,\r\n                  accuracy: position.coords.accuracy\r\n                };\r\n                updateUserPosition(pos);\r\n                setGpsStatus('active');\r\n              },\r\n              (error2) => {\r\n                console.error('❌ No se pudo obtener GPS:', error2);\r\n                // Última opción: ubicación de respaldo\r\n                const testPosition = {\r\n                  lat: -36.7508 + (Math.random() - 0.5) * 0.001,\r\n                  lng: -72.4698 + (Math.random() - 0.5) * 0.001,\r\n                  accuracy: 100\r\n                };\r\n                updateUserPosition(testPosition);\r\n                setGpsStatus('active');\r\n              },\r\n              {\r\n                enableHighAccuracy: false, // Precisión normal\r\n                timeout: 10000,\r\n                maximumAge: 30000\r\n              }\r\n            );\r\n          },\r\n          {\r\n            enableHighAccuracy: true, // 🔴 ALTA PRECISIÓN primero\r\n            timeout: 15000, // 15 segundos para alta precisión\r\n            maximumAge: 0 // No usar caché\r\n          }\r\n        );\r\n      }\r\n\r\n      // Seguimiento continuo con ALTA PRECISIÓN\r\n      const gpsWatchId = navigator.geolocation.watchPosition(\r\n        (position) => {\r\n          console.log('📍 GPS - Actualización:', position.coords);\r\n          console.log('   - Precisión:', position.coords.accuracy, 'metros');\r\n          \r\n          // Solo actualizar si la precisión es mejor que 150 metros\r\n          if (position.coords.accuracy <= 150) {\r\n            const pos = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n              accuracy: position.coords.accuracy\r\n            };\r\n            updateUserPosition(pos);\r\n            setGpsStatus('active');\r\n          } else {\r\n            console.log('⚠️ Precisión insuficiente, esperando mejor señal...');\r\n          }\r\n        },\r\n        (error) => {\r\n          console.log('⏱️ Esperando señal GPS...', error.message);\r\n        },\r\n        {\r\n          enableHighAccuracy: true, // 🔴 ALTA PRECISIÓN\r\n          timeout: 30000,\r\n          maximumAge: 0, // Siempre ubicación fresca\r\n          distanceFilter: 5 // Actualizar cada 5 metros de movimiento\r\n        }\r\n      );\r\n      \r\n      watchIdRef.current = gpsWatchId;\r\n    }\r\n  };\r\n\r\n  // Seleccionar zona de trabajo\r\n  const selectZona = (zona) => {\r\n    setSelectedZona(zona);\r\n    \r\n    if (!map || !window.google) return;\r\n\r\n    // Limpiar marcador anterior\r\n    if (zonaMarkerRef.current) {\r\n      zonaMarkerRef.current.setMap(null);\r\n    }\r\n\r\n    // Crear marcador de zona\r\n    zonaMarkerRef.current = new window.google.maps.Marker({\r\n      position: { lat: zona.lat, lng: zona.lng },\r\n      map: map,\r\n      title: zona.nombre,\r\n      icon: {\r\n        path: window.google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,\r\n        scale: 8,\r\n        fillColor: '#22c55e',\r\n        fillOpacity: 1,\r\n        strokeColor: '#ffffff',\r\n        strokeWeight: 2\r\n      }\r\n    });\r\n\r\n    // Ajustar vista para mostrar ambos puntos\r\n    if (userPosition) {\r\n      const bounds = new window.google.maps.LatLngBounds();\r\n      bounds.extend(userPosition);\r\n      bounds.extend({ lat: zona.lat, lng: zona.lng });\r\n      map.fitBounds(bounds, 100);\r\n    } else {\r\n      map.setCenter({ lat: zona.lat, lng: zona.lng });\r\n      map.setZoom(15);\r\n    }\r\n  };\r\n\r\n  // Iniciar navegación\r\n  const startNavigation = async () => {\r\n    if (!selectedZona || !userPosition) {\r\n      alert('Debes activar el GPS y seleccionar una zona primero');\r\n      return;\r\n    }\r\n\r\n    setIsNavigating(true);\r\n    setWorkStatus('traveling');\r\n    setWorkLog({\r\n      ...workLog,\r\n      startTime: new Date().toISOString(),\r\n      zona: selectedZona\r\n    });\r\n\r\n    // 🔥 Actualizar estado en Firebase y en la zona\r\n    try {\r\n      // Actualizar estado del trabajador\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'en_camino',\r\n        zonaDestino: selectedZona.nombre,\r\n        recorridoInicio: new Date().toISOString()\r\n      });\r\n      \r\n      // Actualizar estado de la zona a \"en_progreso\"\r\n      if (selectedZona.id) {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'en_progreso',\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      // 🔥 NUEVO: Actualizar estado del vehículo asignado\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'en_uso',\r\n          operadorEnRuta: currentUser.name || currentUser.email,\r\n          zonaDestino: selectedZona.nombre,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('✅ Vehículo marcado como en uso');\r\n      }\r\n      \r\n      console.log('✅ Estado actualizado a \"en_camino\" en Firebase');\r\n    } catch (error) {\r\n      console.error('Error al actualizar estado en Firebase:', error);\r\n    }\r\n\r\n    // Calcular y mostrar ruta\r\nconst request = {\r\n  origin: userPosition,\r\n  destination: { lat: selectedZona.lat, lng: selectedZona.lng },\r\n  travelMode: window.google.maps.TravelMode.DRIVING,\r\n  // Agregar estas opciones para mejor cálculo de ruta\r\n  unitSystem: window.google.maps.UnitSystem.METRIC,\r\n  region: 'CL', // Chile\r\n  avoidHighways: false,\r\n  avoidTolls: false,\r\n  optimizeWaypoints: true,\r\n  provideRouteAlternatives: true // Obtener rutas alternativas\r\n};\r\n\r\ndirectionsServiceRef.current.route(request, (result, status) => {\r\n  if (status === 'OK') {\r\n    console.log('✅ Ruta calculada exitosamente');\r\n    console.log('Rutas disponibles:', result.routes.length);\r\n    \r\n    // Usar la mejor ruta disponible\r\n    directionsRendererRef.current.setDirections(result);\r\n    \r\n    const route = result.routes[0];\r\n    const leg = route.legs[0];\r\n    \r\n    setDistance(leg.distance.text);\r\n    setDuration(leg.duration.text);\r\n    \r\n    // Información adicional de la ruta\r\n    console.log('📍 Distancia:', leg.distance.text);\r\n    console.log('⏱️ Duración estimada:', leg.duration.text);\r\n    console.log('📍 Dirección inicio:', leg.start_address);\r\n    console.log('📍 Dirección destino:', leg.end_address);\r\n    \r\n    // Si hay rutas alternativas, informar al usuario\r\n    if (result.routes.length > 1) {\r\n      console.log(`ℹ️ Hay ${result.routes.length} rutas disponibles`);\r\n    }\r\n    \r\n  } else if (status === 'ZERO_RESULTS') {\r\n    console.warn('⚠️ No se encontró ruta por carretera, intentando ruta aproximada...');\r\n    \r\n    // Intentar con modo WALKING si DRIVING no funciona\r\n    const walkingRequest = {\r\n      ...request,\r\n      travelMode: window.google.maps.TravelMode.WALKING\r\n    };\r\n    \r\n    directionsServiceRef.current.route(walkingRequest, (walkResult, walkStatus) => {\r\n      if (walkStatus === 'OK') {\r\n        directionsRendererRef.current.setDirections(walkResult);\r\n        const leg = walkResult.routes[0].legs[0];\r\n        setDistance(leg.distance.text + ' (a pie)');\r\n        setDuration(leg.duration.text + ' (caminando)');\r\n        alert('⚠️ No hay ruta vehicular directa. Mostrando ruta a pie.');\r\n      } else {\r\n        // Si tampoco hay ruta a pie, mostrar línea directa\r\n        mostrarLineaDirecta();\r\n      }\r\n    });\r\n    \r\n  } else {\r\n    console.error('Error al calcular ruta:', status);\r\n    mostrarLineaDirecta();\r\n  }\r\n});\r\n  };\r\n// Función auxiliar para mostrar línea directa cuando no hay ruta\r\nconst mostrarLineaDirecta = () => {\r\n  if (window.google && window.google.maps && window.google.maps.geometry) {\r\n    const distanceInMeters = window.google.maps.geometry.spherical.computeDistanceBetween(\r\n      new window.google.maps.LatLng(userPosition.lat, userPosition.lng),\r\n      new window.google.maps.LatLng(selectedZona.lat, selectedZona.lng)\r\n    );\r\n    \r\n    const distanceInKm = (distanceInMeters / 1000).toFixed(2);\r\n    setDistance(`~${distanceInKm} km (línea recta)`);\r\n    setDuration('No disponible');\r\n    \r\n    // Crear polilínea directa\r\n    if (directionsRendererRef.current.polyline) {\r\n      directionsRendererRef.current.polyline.setMap(null);\r\n    }\r\n    \r\n    const line = new window.google.maps.Polyline({\r\n      path: [userPosition, { lat: selectedZona.lat, lng: selectedZona.lng }],\r\n      geodesic: true,\r\n      strokeColor: '#FF0000',\r\n      strokeOpacity: 0.8,\r\n      strokeWeight: 3,\r\n      strokePattern: [10, 10], // Línea punteada para indicar que no es una ruta real\r\n      map: map\r\n    });\r\n    \r\n    directionsRendererRef.current.polyline = line;\r\n    \r\n    alert('⚠️ No hay ruta disponible por carretera. Mostrando dirección aproximada.');\r\n  }\r\n};\r\n\r\n  // Manejar llegada a la zona - MEJORADO\r\n  const handleArrival = async () => {\r\n    setWorkStatus('working');\r\n    const arrivalTime = new Date().toISOString();\r\n    setWorkLog({\r\n      ...workLog,\r\n      arrivalTime: arrivalTime\r\n    });\r\n    \r\n    // 🔥 Actualizar estado en Firebase\r\n    try {\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'trabajando',\r\n        horaLlegada: arrivalTime\r\n      });\r\n      \r\n      // 🔥 NUEVO: Mantener vehículo en uso pero actualizar ubicación\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'en_uso',\r\n          enZonaTrabajo: true,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      console.log('✅ Llegada registrada en Firebase');\r\n    } catch (error) {\r\n      console.error('Error al registrar llegada en Firebase:', error);\r\n    }\r\n    \r\n    // Limpiar la ruta del mapa al llegar\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    console.log('✅ Trabajador ha llegado a la zona y está trabajando');\r\n  };\r\n\r\n  // Finalizar trabajo mejorado con registro de detalles\r\n  const finishWork = async () => {\r\n    const endTime = new Date().toISOString();\r\n    const tiempoTrabajado = workLog.arrivalTime ? \r\n      Math.floor((new Date(endTime) - new Date(workLog.arrivalTime)) / 60000) : 0; // minutos\r\n    \r\n    const finalLog = {\r\n      ...workLog,\r\n      endTime: endTime,\r\n      tiempoTrabajadoMinutos: tiempoTrabajado\r\n    };\r\n    \r\n    setWorkLog(finalLog);\r\n    setWorkStatus('completed');\r\n    setIsNavigating(false);\r\n    setShowWorkLog(true);\r\n    \r\n    // Limpiar ruta\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    // 🔥 Registrar finalización en Firebase y actualizar zona\r\n    try {\r\n      // Actualizar estado del trabajador\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'disponible',\r\n        zonaDestino: null,\r\n        ultimoTrabajo: {\r\n          zona: selectedZona.nombre,\r\n          zonaId: selectedZona.id,\r\n          horaInicio: workLog.startTime,\r\n          horaLlegada: workLog.arrivalTime,\r\n          horaFin: endTime,\r\n          tiempoTrabajadoMinutos: tiempoTrabajado,\r\n          completado: true\r\n        }\r\n      });\r\n      \r\n      // 🔥 NUEVO: Marcar vehículo como disponible nuevamente\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'disponible',\r\n          operadorEnRuta: null,\r\n          zonaDestino: null,\r\n          enZonaTrabajo: false,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('✅ Vehículo marcado como disponible');\r\n      }\r\n      \r\n      // Marcar zona como completada\r\n      if (selectedZona.id) {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'completado',\r\n          fechaCompletado: endTime,\r\n          tiempoTrabajadoMinutos: tiempoTrabajado,\r\n          completadoPor: currentUser.uid,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      // Crear registro en historial\r\n      const historialRef = ref(database, `historial_trabajos/${currentUser.uid}/${Date.now()}`);\r\n      await set(historialRef, {\r\n        trabajadorId: currentUser.uid,\r\n        trabajadorNombre: currentUser.name || currentUser.email,\r\n        zonaId: selectedZona.id,\r\n        zonaNombre: selectedZona.nombre,\r\n        zonaDireccion: selectedZona.direccion,\r\n        horaInicio: workLog.startTime,\r\n        horaLlegada: workLog.arrivalTime,\r\n        horaFin: endTime,\r\n        tiempoTrabajadoMinutos: tiempoTrabajado,\r\n        estado: 'completado',\r\n        fecha: new Date().toISOString().split('T')[0]\r\n      });\r\n      \r\n      console.log('✅ Trabajo completado y registrado en Firebase');\r\n      \r\n      // Mostrar notificación de éxito\r\n      alert('✅ ¡Excelente trabajo! La tarea ha sido marcada como completada.');\r\n      \r\n    } catch (error) {\r\n      console.error('Error al registrar finalización en Firebase:', error);\r\n      alert('⚠️ Error al guardar. El trabajo se completó pero hubo un problema al registrarlo.');\r\n    }\r\n    \r\n    console.log('Registro de trabajo:', finalLog);\r\n  };\r\n\r\n  // Cancelar navegación/trabajo\r\n  const cancelNavigation = async () => {\r\n    if (!window.confirm('¿Estás seguro de cancelar el recorrido actual?')) {\r\n      return;\r\n    }\r\n\r\n    // Limpiar estados\r\n    setIsNavigating(false);\r\n    setWorkStatus('idle');\r\n    setDistance(null);\r\n    setDuration(null);\r\n    \r\n    // Limpiar ruta del mapa\r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n    \r\n    // Actualizar estado en Firebase\r\n    try {\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        estado: 'disponible',\r\n        zonaDestino: null,\r\n        recorridoCancelado: new Date().toISOString()\r\n      });\r\n      \r\n      // 🔥 NUEVO: Marcar vehículo como disponible si estaba en uso\r\n      if (currentUser.vehicleId) {\r\n        const vehicleRef = ref(database, `vehiculos/${currentUser.vehicleId}`);\r\n        await update(vehicleRef, {\r\n          estado: 'disponible',\r\n          operadorEnRuta: null,\r\n          zonaDestino: null,\r\n          enZonaTrabajo: false,\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n        console.log('✅ Vehículo liberado y marcado como disponible');\r\n      }\r\n      \r\n      // Si había una zona en progreso, cambiarla a pendiente\r\n      if (selectedZona && selectedZona.id && workStatus !== 'idle') {\r\n        await update(ref(database, `zonas_asignadas/${selectedZona.id}`), {\r\n          estado: 'pendiente',\r\n          ultimaActualizacion: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n      console.log('✅ Recorrido cancelado');\r\n    } catch (error) {\r\n      console.error('Error al cancelar recorrido:', error);\r\n    }\r\n    \r\n    // Mantener la zona seleccionada por si quiere reintentar\r\n    alert('Recorrido cancelado. Puedes iniciar uno nuevo cuando quieras.');\r\n  };\r\n\r\n  // Resetear para nuevo trabajo\r\n  const resetWork = () => {\r\n    setSelectedZona(null);\r\n    setWorkStatus('idle');\r\n    setWorkLog({\r\n      startTime: null,\r\n      arrivalTime: null,\r\n      endTime: null,\r\n      zona: null\r\n    });\r\n    setIsNavigating(false);\r\n    setDistance(null);\r\n    setDuration(null);\r\n    setShowWorkLog(false);\r\n    \r\n    if (zonaMarkerRef.current) {\r\n      zonaMarkerRef.current.setMap(null);\r\n      zonaMarkerRef.current = null;\r\n    }\r\n    \r\n    if (directionsRendererRef.current) {\r\n      directionsRendererRef.current.setDirections({ routes: [] });\r\n    }\r\n  };\r\n\r\n  // Formatear tiempo\r\n  const formatTime = (isoString) => {\r\n    if (!isoString) return '--:--';\r\n    const date = new Date(isoString);\r\n    return date.toLocaleTimeString('es-CL', { \r\n      hour: '2-digit', \r\n      minute: '2-digit',\r\n      hour12: false \r\n    });\r\n  };\r\n\r\n  // Calcular duración\r\n  const calculateDuration = (start, end) => {\r\n    if (!start || !end) return '--';\r\n    const diff = new Date(end) - new Date(start);\r\n    const hours = Math.floor(diff / 3600000);\r\n    const minutes = Math.floor((diff % 3600000) / 60000);\r\n    return `${hours}h ${minutes}m`;\r\n  };\r\n\r\n  // Limpiar al desmontar componente\r\n  useEffect(() => {\r\n    return () => {\r\n      // Limpiar GPS al salir\r\n      if (watchIdRef.current) {\r\n        navigator.geolocation.clearWatch(watchIdRef.current);\r\n      }\r\n      \r\n      // Marcar como inactivo en Firebase\r\n      if (currentUser?.uid) {\r\n        trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n          estado: 'inactivo',\r\n          ubicacion: null\r\n        }).catch(console.error);\r\n      }\r\n    };\r\n  }, [currentUser]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div style={{ padding: '20px', textAlign: 'center' }}>\r\n        <h2>Error</h2>\r\n        <p>{error}</p>\r\n        <button onClick={() => window.location.reload()}>Reintentar</button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Estilos responsivos\r\n  const styles = {\r\n    container: {\r\n      width: '100%',\r\n      height: '100vh',\r\n      position: 'relative',\r\n      overflow: 'hidden'\r\n    },\r\n    header: {\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\r\n      color: 'white',\r\n      padding: isMobile ? '10px 15px' : '15px 20px',\r\n      zIndex: 1002,\r\n      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'\r\n    },\r\n    panel: {\r\n      position: 'fixed',\r\n      top: isMobile ? '60px' : '70px',\r\n      left: showPanel ? '0' : '-100%',\r\n      width: isMobile ? '100%' : '400px',\r\n      maxWidth: '100%',\r\n      height: isMobile ? 'auto' : 'calc(100vh - 70px)',\r\n      maxHeight: isMobile ? '60vh' : 'calc(100vh - 70px)',\r\n      background: 'white',\r\n      boxShadow: '2px 0 10px rgba(0,0,0,0.1)',\r\n      overflowY: 'auto',\r\n      transition: 'left 0.3s ease',\r\n      zIndex: 1001,\r\n      padding: isMobile ? '15px' : '20px'\r\n    },\r\n    map: {\r\n      width: '100%',\r\n      height: '100%',\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0\r\n    },\r\n    button: {\r\n      width: '100%',\r\n      padding: isMobile ? '14px' : '12px',\r\n      fontSize: isMobile ? '16px' : '14px',\r\n      border: 'none',\r\n      borderRadius: '8px',\r\n      fontWeight: '500',\r\n      cursor: 'pointer',\r\n      marginBottom: '10px',\r\n      touchAction: 'manipulation'\r\n    },\r\n    floatingButton: {\r\n      position: 'fixed',\r\n      bottom: isMobile ? '20px' : '30px',\r\n      right: isMobile ? '20px' : '30px',\r\n      width: isMobile ? '60px' : '50px',\r\n      height: isMobile ? '60px' : '50px',\r\n      borderRadius: '50%',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      boxShadow: '0 4px 12px rgba(0,0,0,0.2)',\r\n      zIndex: 1000,\r\n      cursor: 'pointer',\r\n      fontSize: isMobile ? '24px' : '20px'\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={styles.container}>\r\n      {/* Mapa - Primero para que esté en el fondo */}\r\n      <div ref={mapRef} style={styles.map} />\r\n      \r\n      {/* Header responsivo */}\r\n      <div style={styles.header}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center',\r\n          flexWrap: isMobile ? 'wrap' : 'nowrap'\r\n        }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n            <button\r\n              onClick={() => setShowPanel(!showPanel)}\r\n              style={{\r\n                padding: isMobile ? '8px' : '6px 10px',\r\n                background: 'rgba(255,255,255,0.2)',\r\n                color: 'white',\r\n                border: '1px solid rgba(255,255,255,0.3)',\r\n                borderRadius: '6px',\r\n                cursor: 'pointer',\r\n                fontSize: isMobile ? '20px' : '14px',\r\n                touchAction: 'manipulation'\r\n              }}\r\n            >\r\n              {showPanel ? '☰' : '☰'}\r\n            </button>\r\n            <div>\r\n              <h1 style={{ \r\n                margin: 0, \r\n                fontSize: isMobile ? '18px' : '20px', \r\n                fontWeight: '600' \r\n              }}>\r\n                👷‍♂️ {currentUser.name || 'Trabajador'}\r\n              </h1>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={onLogout}\r\n            style={{\r\n              padding: isMobile ? '6px 10px' : '8px 16px',\r\n              background: 'rgba(255,255,255,0.2)',\r\n              color: 'white',\r\n              border: '1px solid rgba(255,255,255,0.3)',\r\n              borderRadius: '6px',\r\n              cursor: 'pointer',\r\n              fontSize: isMobile ? '12px' : '14px',\r\n              touchAction: 'manipulation'\r\n            }}\r\n          >\r\n            Salir\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel lateral/inferior responsivo */}\r\n      <div style={styles.panel}>\r\n        {/* Notificaciones */}\r\n        {notificaciones.length > 0 && (\r\n          <div style={{\r\n            marginBottom: '15px',\r\n            padding: '10px',\r\n            background: '#fef3c7',\r\n            border: '1px solid #fde68a',\r\n            borderRadius: '8px'\r\n          }}>\r\n            <h4 style={{ margin: '0 0 8px 0', fontSize: '14px', color: '#92400e' }}>\r\n              🔔 Nuevas notificaciones ({notificaciones.length})\r\n            </h4>\r\n            {notificaciones.map(notif => (\r\n              <div key={notif.id} style={{ fontSize: '12px', marginBottom: '4px' }}>\r\n                • {notif.mensaje}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Activación GPS */}\r\n        <button\r\n          onClick={toggleGPS}\r\n          style={{\r\n            ...styles.button,\r\n            background: isTracking ? '#ef4444' : '#22c55e',\r\n            color: 'white'\r\n          }}\r\n        >\r\n          {isTracking ? '📍 Desactivar GPS' : '📍 Activar GPS'}\r\n        </button>\r\n        \r\n        {/* Estado del GPS */}\r\n        {gpsStatus !== 'inactive' && (\r\n          <div style={{ \r\n            marginBottom: '15px',\r\n            padding: '8px',\r\n            borderRadius: '6px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: gpsStatus === 'active' ? '#dcfce7' : \r\n                       gpsStatus === 'activating' ? '#fef3c7' : \r\n                       '#fee2e2',\r\n            color: gpsStatus === 'active' ? '#166534' : \r\n                   gpsStatus === 'activating' ? '#92400e' : \r\n                   '#991b1b'\r\n          }}>\r\n            {gpsStatus === 'active' && '🟢 GPS activo'}\r\n            {gpsStatus === 'activating' && '🟡 Activando GPS...'}\r\n            {gpsStatus === 'error' && '🔴 Error en GPS'}\r\n          </div>\r\n        )}\r\n\r\n        {/* Selector de zona */}\r\n        {isTracking && workStatus === 'idle' && (\r\n          <div style={{ marginBottom: '15px' }}>\r\n            <label style={{ \r\n              display: 'block', \r\n              marginBottom: '8px', \r\n              fontSize: '14px', \r\n              fontWeight: '500' \r\n            }}>\r\n              🏗️ Zona de Trabajo:\r\n            </label>\r\n            {zonasAsignadas.length > 0 ? (\r\n              <select\r\n                value={selectedZona?.id || ''}\r\n                onChange={(e) => {\r\n                  const zona = zonasAsignadas.find(z => z.id === e.target.value);\r\n                  if (zona) selectZona(zona);\r\n                }}\r\n                style={{\r\n                  width: '100%',\r\n                  padding: '10px',\r\n                  borderRadius: '6px',\r\n                  border: '1px solid #ddd',\r\n                  fontSize: isMobile ? '16px' : '14px'\r\n                }}\r\n              >\r\n                <option value=\"\">-- Seleccionar --</option>\r\n                {zonasAsignadas.map(zona => (\r\n                  <option key={zona.id} value={zona.id}>\r\n                    {zona.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            ) : (\r\n              <div style={{\r\n                padding: '10px',\r\n                background: '#f3f4f6',\r\n                borderRadius: '6px',\r\n                textAlign: 'center',\r\n                fontSize: '13px',\r\n                color: '#6b7280'\r\n              }}>\r\n                No hay zonas asignadas\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Información de zona seleccionada */}\r\n        {selectedZona && workStatus === 'idle' && (\r\n          <div style={{\r\n            background: '#f0f9ff',\r\n            padding: '12px',\r\n            borderRadius: '8px',\r\n            marginBottom: '15px',\r\n            border: '1px solid #bae6fd'\r\n          }}>\r\n            <h4 style={{ margin: '0 0 8px 0', color: '#0369a1', fontSize: '14px' }}>\r\n              {selectedZona.nombre}\r\n            </h4>\r\n            <p style={{ margin: 0, fontSize: '12px', color: '#333' }}>\r\n              📍 {selectedZona.direccion}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Botón iniciar recorrido */}\r\n        {workStatus === 'idle' && selectedZona && userPosition && (\r\n          <button\r\n            onClick={startNavigation}\r\n            style={{\r\n              ...styles.button,\r\n              background: '#3b82f6',\r\n              color: 'white'\r\n            }}\r\n          >\r\n            🚗 Iniciar Recorrido\r\n          </button>\r\n        )}\r\n\r\n        {/* Estado: En camino */}\r\n        {workStatus === 'traveling' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#fef3c7',\r\n              padding: '12px',\r\n              borderRadius: '8px',\r\n              marginBottom: '12px',\r\n              border: '1px solid #fde68a'\r\n            }}>\r\n              <div style={{ fontSize: '16px', fontWeight: '500', color: '#92400e' }}>\r\n                🚗 En camino a la zona\r\n              </div>\r\n              <div style={{ fontSize: '13px', marginTop: '4px', color: '#78350f' }}>\r\n                📍 {selectedZona?.nombre}\r\n              </div>\r\n              {distance && duration && (\r\n                <div style={{ marginTop: '8px', fontSize: '13px' }}>\r\n                  📏 {distance} • ⏱️ {duration}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* BOTÓN PARA MARCAR LLEGADA */}\r\n            <button\r\n              onClick={() => {\r\n                handleArrival();\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: '#10b981',\r\n                color: 'white',\r\n                fontSize: isMobile ? '16px' : '14px',\r\n                fontWeight: '600',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                gap: '8px'\r\n              }}\r\n            >\r\n              📍 Ya llegué a la zona\r\n            </button>\r\n            \r\n            <button\r\n              onClick={cancelNavigation}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'white',\r\n                color: '#ef4444',\r\n                border: '2px solid #ef4444'\r\n              }}\r\n            >\r\n              ❌ Cancelar Recorrido\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado: Trabajando - MEJORADO */}\r\n        {workStatus === 'working' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#dcfce7',\r\n              padding: '15px',\r\n              borderRadius: '8px',\r\n              marginBottom: '15px',\r\n              border: '2px solid #22c55e'\r\n            }}>\r\n              <div style={{ \r\n                fontSize: isMobile ? '18px' : '16px', \r\n                fontWeight: '600', \r\n                color: '#14532d',\r\n                marginBottom: '8px'\r\n              }}>\r\n                🔧 TRABAJANDO EN ZONA\r\n              </div>\r\n              <div style={{ fontSize: '14px', color: '#166534' }}>\r\n                📍 {selectedZona?.nombre}\r\n              </div>\r\n              {selectedZona?.descripcion && (\r\n                <div style={{\r\n                  marginTop: '10px',\r\n                  padding: '8px',\r\n                  background: '#f0fdf4',\r\n                  borderRadius: '6px',\r\n                  fontSize: '13px',\r\n                  color: '#15803d'\r\n                }}>\r\n                  📋 {selectedZona.descripcion}\r\n                </div>\r\n              )}\r\n              <div style={{ \r\n                fontSize: '12px', \r\n                marginTop: '8px', \r\n                color: '#166534' \r\n              }}>\r\n                ⏰ Llegada: {formatTime(workLog.arrivalTime)}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* BOTÓN PRINCIPAL - TAREA COMPLETADA */}\r\n            <button\r\n              onClick={() => {\r\n                if (window.confirm('¿Confirmas que has completado toda la tarea asignada?')) {\r\n                  finishWork();\r\n                }\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\r\n                color: 'white',\r\n                padding: isMobile ? '18px' : '16px',\r\n                fontSize: isMobile ? '18px' : '16px',\r\n                fontWeight: '700',\r\n                boxShadow: '0 4px 12px rgba(34, 197, 94, 0.3)',\r\n                textTransform: 'uppercase',\r\n                letterSpacing: '0.5px'\r\n              }}\r\n            >\r\n              ✅ MARCAR TAREA COMO COMPLETADA\r\n            </button>\r\n            \r\n            <p style={{\r\n              fontSize: '12px',\r\n              color: '#6b7280',\r\n              textAlign: 'center',\r\n              margin: '8px 0'\r\n            }}>\r\n              Presiona cuando hayas terminado todo el trabajo\r\n            </p>\r\n            \r\n            {/* Botón secundario - Cancelar */}\r\n            <button\r\n              onClick={() => {\r\n                if (window.confirm('¿Cancelar el trabajo? La zona volverá a estado pendiente.')) {\r\n                  cancelNavigation();\r\n                }\r\n              }}\r\n              style={{\r\n                ...styles.button,\r\n                background: 'white',\r\n                color: '#ef4444',\r\n                border: '2px solid #ef4444',\r\n                fontSize: isMobile ? '14px' : '13px'\r\n              }}\r\n            >\r\n              ❌ No puedo completar la tarea\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado: Completado */}\r\n        {workStatus === 'completed' && (\r\n          <div>\r\n            <div style={{\r\n              background: '#e0e7ff',\r\n              padding: '12px',\r\n              borderRadius: '8px',\r\n              marginBottom: '12px',\r\n              border: '1px solid #c7d2fe',\r\n              textAlign: 'center'\r\n            }}>\r\n              <div style={{ fontSize: '16px', fontWeight: '500', color: '#312e81' }}>\r\n                ✅ Trabajo Completado\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={resetWork}\r\n              style={{\r\n                ...styles.button,\r\n                background: '#22c55e',\r\n                color: 'white'\r\n              }}\r\n            >\r\n              🔄 Nuevo Trabajo\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Botón flotante cuando el panel está oculto */}\r\n      {!showPanel && workStatus !== 'idle' && (\r\n        <button\r\n          onClick={() => setShowPanel(true)}\r\n          style={{\r\n            ...styles.floatingButton,\r\n            background: workStatus === 'traveling' ? '#f59e0b' :\r\n                      workStatus === 'working' ? '#3b82f6' :\r\n                      '#22c55e',\r\n            color: 'white',\r\n            border: 'none'\r\n          }}\r\n        >\r\n          {workStatus === 'traveling' && '🚗'}\r\n          {workStatus === 'working' && '🔧'}\r\n          {workStatus === 'completed' && '✅'}\r\n        </button>\r\n      )}\r\n\r\n      {/* Modal de resumen de trabajo */}\r\n      {showWorkLog && workLog.zona && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          background: 'rgba(0,0,0,0.5)',\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 2000,\r\n          padding: '20px'\r\n        }}>\r\n          <div style={{\r\n            background: 'white',\r\n            borderRadius: '12px',\r\n            padding: isMobile ? '15px' : '20px',\r\n            maxWidth: isMobile ? '100%' : '400px',\r\n            width: '100%',\r\n            maxHeight: '80vh',\r\n            overflow: 'auto'\r\n          }}>\r\n            <h3 style={{ margin: '0 0 15px 0', color: '#1f2937', fontSize: isMobile ? '18px' : '20px' }}>\r\n              📋 Resumen del Trabajo\r\n            </h3>\r\n            \r\n            <div style={{ fontSize: isMobile ? '13px' : '14px', lineHeight: '1.8' }}>\r\n              <div style={{ marginBottom: '15px' }}>\r\n                <strong>{workLog.zona.nombre}</strong><br/>\r\n                📍 {workLog.zona.direccion}\r\n              </div>\r\n              \r\n              <div style={{\r\n                background: '#f8fafc',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                marginBottom: '15px'\r\n              }}>\r\n                <div>⏱️ Tiempo trabajado: {calculateDuration(workLog.arrivalTime, workLog.endTime)}</div>\r\n                <div style={{\r\n                  marginTop: '10px',\r\n                  padding: '8px',\r\n                  background: '#dcfce7',\r\n                  borderRadius: '6px',\r\n                  textAlign: 'center',\r\n                  fontWeight: 'bold',\r\n                  color: '#166534'\r\n                }}>\r\n                  ✅ COMPLETADO\r\n                </div>\r\n              </div>\r\n              \r\n              <button\r\n                onClick={() => setShowWorkLog(false)}\r\n                style={{\r\n                  ...styles.button,\r\n                  background: '#6b7280',\r\n                  color: 'white'\r\n                }}\r\n              >\r\n                Cerrar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Indicador de carga */}\r\n      {!mapLoaded && (\r\n        <div style={{\r\n          position: 'absolute',\r\n          top: '50%',\r\n          left: '50%',\r\n          transform: 'translate(-50%, -50%)',\r\n          textAlign: 'center',\r\n          zIndex: 1001\r\n        }}>\r\n          <div style={{\r\n            width: '50px',\r\n            height: '50px',\r\n            border: '4px solid #f3f3f3',\r\n            borderTop: '4px solid #22c55e',\r\n            borderRadius: '50%',\r\n            animation: 'spin 1s linear infinite'\r\n          }}></div>\r\n          <p style={{ marginTop: '10px', color: '#666' }}>Cargando mapa...</p>\r\n        </div>\r\n      )}\r\n\r\n      <style jsx>{`\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SistemaTrabajadoresFirebase;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}