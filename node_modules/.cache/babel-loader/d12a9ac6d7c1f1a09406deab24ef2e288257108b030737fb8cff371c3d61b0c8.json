{"ast":null,"code":"// src/components/TrabajadorVehiclePanel.js\nimport React,{useState,useEffect}from'react';import{vehiculosService,trabajadoresService}from'../services/firebaseservices';import{database}from'../config/firebase';import{ref as databaseRef,update,get}from'firebase/database';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TrabajadorVehiclePanel=_ref=>{let{currentUser,onClose}=_ref;// ... resto del c√≥digo\nconst[vehiculoAsignado,setVehiculoAsignado]=useState(null);const[loading,setLoading]=useState(false);const[loadingVehiculo,setLoadingVehiculo]=useState(true);// NUEVO: Estado de carga inicial\nconst[message,setMessage]=useState(null);const[trabajadorData,setTrabajadorData]=useState(null);// Estados del formulario de viaje\nconst[formViaje,setFormViaje]=useState({fechaSalida:new Date().toISOString().split('T')[0],// Fecha de hoy\nhoraSalida:new Date().toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'}),kilometrajeSalida:'',destino:'',motivoViaje:'trabajo',// trabajo, emergencia, mantenimiento\nobservaciones:''});// Estado para el viaje activo\nconst[viajeActivo,setViajeActivo]=useState(null);// Cargar datos del trabajador y su veh√≠culo\nuseEffect(()=>{let mounted=true;const loadData=async()=>{console.log('üîÑ Iniciando carga de veh√≠culo para:',currentUser.uid);setLoadingVehiculo(true);try{// Esperar un momento para que Firebase se estabilice\nawait new Promise(resolve=>setTimeout(resolve,1000));// Verificar si el componente sigue montado\nif(!mounted)return;// Obtener datos del trabajador\nlet trabajadorData=null;await new Promise(resolve=>{const unsubscribe=trabajadoresService.getTrabajadorById(currentUser.uid,data=>{console.log('üë∑ Datos del trabajador:',data);trabajadorData=data;setTrabajadorData(data);if(data!==null&&data!==void 0&&data.viajeActivo){setViajeActivo(data.viajeActivo);}resolve();});// Timeout para evitar espera infinita\nsetTimeout(()=>resolve(),3000);});// Verificar veh√≠culos\nawait new Promise(resolve=>{const unsubscribe=vehiculosService.subscribeToVehiculos(vehiculosData=>{var _trabajadorData;console.log('üöõ Total de veh√≠culos:',vehiculosData.length);// Buscar veh√≠culo asignado\n// Buscar veh√≠culo asignado - SOLO buscar en trabajadorAsignado\nlet vehiculoEncontrado=null;// IMPORTANTE: Solo buscar en el campo correcto para evitar falsos positivos\nvehiculoEncontrado=vehiculosData.find(v=>{// Solo aceptar si est√° espec√≠ficamente asignado como trabajadorAsignado\nconst asignado=v.trabajadorAsignado===currentUser.uid;if(asignado){console.log('‚úÖ Veh√≠culo encontrado correctamente asignado:',v.nombre);}// Bot√≥n temporal para limpiar campos legacy\n/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{try{const vehiculoRef=databaseRef(database,`vehiculos/${vehiculoAsignado.id}`);await update(vehiculoRef,{operadorAsignado:null,// Limpiar campo antiguo\nasignadoA:null,// Limpiar por si acaso\nultimaActualizacion:new Date().toISOString()});alert('‚úÖ Campos antiguos limpiados');window.location.reload();}catch(error){console.error('Error:',error);}},style:{padding:'8px 16px',background:'#dc2626',color:'white',border:'none',borderRadius:'6px',fontSize:'12px',cursor:'pointer'},children:\"Limpiar campos antiguos (ejecutar una vez)\"});// DEBUG: Mostrar si hay asignaciones incorrectas\nif(v.asignadoA===currentUser.uid||v.operadorAsignado===currentUser.uid){console.log('‚ö†Ô∏è ADVERTENCIA: Veh√≠culo mal asignado en campos incorrectos:',v.nombre);console.log('- asignadoA:',v.asignadoA);console.log('- operadorAsignado:',v.operadorAsignado);console.log('- trabajadorAsignado:',v.trabajadorAsignado);// NO retornar true aqu√≠ - ignorar estas asignaciones incorrectas\n}//dame el codigo separado con\nreturn asignado;});// NO buscar en otros campos para evitar falsos positivos\nconsole.log('Resultado de b√∫squeda:',vehiculoEncontrado?'Veh√≠culo encontrado':'NO hay veh√≠culo asignado');// Si no encuentra, buscar por ID en datos del trabajador\nif(!vehiculoEncontrado&&(_trabajadorData=trabajadorData)!==null&&_trabajadorData!==void 0&&_trabajadorData.vehiculoAsignado){vehiculoEncontrado=vehiculosData.find(v=>v.id===trabajadorData.vehiculoAsignado);if(vehiculoEncontrado){console.log('‚úÖ Veh√≠culo encontrado por ID del trabajador:',vehiculoEncontrado.nombre);}}// NO BUSCAR EN NING√öN OTRO CAMPO - Comentar o eliminar estas l√≠neas:\n/*\r\n            if (!vehiculoEncontrado && trabajadorData?.vehiculoAsignado) {\r\n              // NO buscar aqu√≠\r\n            }\r\n            \r\n            if (!vehiculoEncontrado && currentUser.vehicleId) {\r\n              // NO buscar aqu√≠ tampoco\r\n            }\r\n            */console.log('Resultado final:',vehiculoEncontrado?`Veh√≠culo asignado: ${vehiculoEncontrado.nombre}`:'NO hay veh√≠culo asignado');if(vehiculoEncontrado){console.log('‚úÖ VEH√çCULO ASIGNADO:',vehiculoEncontrado);setVehiculoAsignado(vehiculoEncontrado);setFormViaje(prev=>{var _vehiculoEncontrado$k;return{...prev,kilometrajeSalida:((_vehiculoEncontrado$k=vehiculoEncontrado.kilometraje)===null||_vehiculoEncontrado$k===void 0?void 0:_vehiculoEncontrado$k.toString())||''};});}else{console.log('‚ùå NO HAY VEH√çCULO ASIGNADO');setVehiculoAsignado(null);}// Solo cambiar loading a false despu√©s de verificar todo\nif(mounted){setLoadingVehiculo(false);}resolve();});// Timeout para evitar espera infinita\nsetTimeout(()=>{if(mounted){setLoadingVehiculo(false);}resolve();},3000);});}catch(error){console.error('‚ùå Error al cargar datos:',error);if(mounted){setMessage({type:'error',text:'‚ùå Error al cargar informaci√≥n'});setLoadingVehiculo(false);setVehiculoAsignado(null);}}};loadData();// Cleanup function\nreturn()=>{mounted=false;};},[currentUser.uid]);// Iniciar viaje\nconst handleIniciarViaje=async()=>{// Validaciones\nif(!formViaje.destino){setMessage({type:'error',text:'‚ö†Ô∏è Debes indicar el destino'});return;}if(!formViaje.kilometrajeSalida){setMessage({type:'error',text:'‚ö†Ô∏è Debes indicar el kilometraje actual'});return;}// NUEVA VALIDACI√ìN: Verificar que el kilometraje no sea menor al registrado\nconst kilometrajeActual=vehiculoAsignado.kilometraje||0;const kilometrajeSalida=parseInt(formViaje.kilometrajeSalida);if(kilometrajeSalida<kilometrajeActual){setMessage({type:'error',text:`‚ö†Ô∏è El kilometraje no puede ser menor al √∫ltimo registrado (${kilometrajeActual.toLocaleString()} km). Verifica el od√≥metro del veh√≠culo.`});return;}setLoading(true);try{const viajeData={vehiculoId:vehiculoAsignado.id,vehiculoNombre:vehiculoAsignado.nombre,trabajadorId:currentUser.uid,trabajadorNombre:currentUser.name,fechaSalida:formViaje.fechaSalida,horaSalida:formViaje.horaSalida,kilometrajeSalida:parseInt(formViaje.kilometrajeSalida),destino:formViaje.destino,motivoViaje:formViaje.motivoViaje,observaciones:formViaje.observaciones,estado:'en_curso',iniciadoEn:new Date().toISOString()};// Actualizar estado del veh√≠culo a \"en_uso\"\nawait vehiculosService.updateVehiculoEstado(vehiculoAsignado.id,'en_uso',{asignadoA:currentUser.uid,asignadoNombre:currentUser.name,destino:formViaje.destino,kilometrajeUltimoViaje:parseInt(formViaje.kilometrajeSalida),viajeActivo:viajeData});// Actualizar datos del trabajador con el viaje activo\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{viajeActivo:viajeData,estadoActual:'en_viaje',ultimoDestino:formViaje.destino});setViajeActivo(viajeData);setMessage({type:'success',text:'‚úÖ Viaje iniciado exitosamente'});}catch(error){console.error('Error al iniciar viaje:',error);setMessage({type:'error',text:'‚ùå Error al iniciar el viaje'});}finally{setLoading(false);}};// Finalizar viaje\nconst handleFinalizarViaje=async()=>{const kilometrajeLlegada=prompt('Ingresa el kilometraje al finalizar el viaje:');if(!kilometrajeLlegada)return;setLoading(true);try{const horaLlegada=new Date().toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'});const kmRecorridos=parseInt(kilometrajeLlegada)-viajeActivo.kilometrajeSalida;// Actualizar veh√≠culo\nawait vehiculosService.updateVehiculoEstado(vehiculoAsignado.id,'disponible',{asignadoA:currentUser.uid,kilometraje:parseInt(kilometrajeLlegada),ultimoViaje:{...viajeActivo,fechaLlegada:new Date().toISOString().split('T')[0],horaLlegada:horaLlegada,kilometrajeLlegada:parseInt(kilometrajeLlegada),kilometrosRecorridos:kmRecorridos,estado:'finalizado'}});// Limpiar viaje activo del trabajador\nawait trabajadoresService.updateTrabajadorData(currentUser.uid,{viajeActivo:null,estadoActual:'disponible',ultimoViaje:{...viajeActivo,fechaLlegada:new Date().toISOString().split('T')[0],horaLlegada:horaLlegada,kilometrajeLlegada:parseInt(kilometrajeLlegada),kilometrosRecorridos:kmRecorridos}});setViajeActivo(null);setMessage({type:'success',text:`‚úÖ Viaje finalizado. Recorriste ${kmRecorridos} km`});}catch(error){console.error('Error al finalizar viaje:',error);setMessage({type:'error',text:'‚ùå Error al finalizar el viaje'});}finally{setLoading(false);}};// Si est√° cargando, mostrar indicador de carga\nif(loadingVehiculo){return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:9999,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'white',borderRadius:'12px',padding:'30px',maxWidth:'400px',width:'100%',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'48px',marginBottom:'20px'},children:\"\\u23F3\"}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#1f2937',marginBottom:'10px'},children:\"Cargando informaci\\xF3n...\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#6b7280'},children:\"Verificando veh\\xEDculo asignado\"})]})});}// Si no hay veh√≠culo asignado (despu√©s de cargar)\nif(!vehiculoAsignado){return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:9999,padding:'20px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'white',borderRadius:'12px',padding:'30px',maxWidth:'400px',width:'100%',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'48px',marginBottom:'20px'},children:\"\\uD83D\\uDEAB\"}),/*#__PURE__*/_jsx(\"h3\",{style:{color:'#1f2937',marginBottom:'10px'},children:\"No tienes veh\\xEDculo asignado\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#6b7280',marginBottom:'20px'},children:\"Contacta con tu supervisor para que te asigne un veh\\xEDculo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:{padding:'10px 20px',background:'#6b7280',color:'white',border:'none',borderRadius:'8px',fontSize:'14px',cursor:'pointer'},children:\"Cerrar\"})]})});}// Solo mostrar el formulario si hay veh√≠culo asignado\nif(!vehiculoAsignado){return null;// Seguridad adicional\n}return/*#__PURE__*/_jsxs(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:9999,padding:'20px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'white',borderRadius:'12px',width:'100%',maxWidth:'600px',maxHeight:'90vh',overflow:'auto',boxShadow:'0 10px 40px rgba(0,0,0,0.2)'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'20px',borderBottom:'1px solid #e5e7eb',background:'linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)',borderRadius:'12px 12px 0 0',color:'white'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0,fontSize:'24px',fontWeight:'600'},children:\"\\uD83D\\uDE9B Control de Veh\\xEDculo\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'5px 0 0 0',fontSize:'14px',opacity:0.9},children:viajeActivo?'Viaje en curso':'Registrar salida de veh√≠culo'})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:{background:'rgba(255, 255, 255, 0.2)',border:'none',color:'white',padding:'8px',borderRadius:'6px',cursor:'pointer',fontSize:'18px'},children:\"\\u2716\"})]})}),message&&/*#__PURE__*/_jsx(\"div\",{style:{margin:'20px 20px 0',padding:'12px',borderRadius:'8px',background:message.type==='error'?'#fee2e2':'#d1fae5',color:message.type==='error'?'#dc2626':'#065f46',fontSize:'14px',fontWeight:'500'},children:message.text}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',background:'#f0f9ff',borderBottom:'1px solid #e5e7eb'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'#0c4a6e',fontSize:'16px',fontWeight:'600'},children:\"Veh\\xEDculo Asignado\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(2, 1fr)',gap:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#64748b'},children:\"Veh\\xEDculo:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontWeight:'600',color:'#0c4a6e'},children:vehiculoAsignado.nombre})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#64748b'},children:\"Patente:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontWeight:'600',color:'#0c4a6e'},children:vehiculoAsignado.patente||'Sin patente'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#64748b'},children:\"Marca/Modelo:\"}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:'4px 0',fontWeight:'600',color:'#0c4a6e'},children:[vehiculoAsignado.marca,\" \",vehiculoAsignado.modelo]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#64748b'},children:\"Estado:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontWeight:'600'},children:/*#__PURE__*/_jsx(\"span\",{style:{padding:'4px 8px',borderRadius:'4px',fontSize:'12px',background:viajeActivo?'#fef3c7':'#dcfce7',color:viajeActivo?'#92400e':'#15803d'},children:viajeActivo?'üöó En viaje':'‚úÖ Disponible'})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'20px'},children:!viajeActivo?/*#__PURE__*/// Formulario para iniciar viaje\n_jsx(\"form\",{onSubmit:e=>{e.preventDefault();handleIniciarViaje();},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gap:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\uD83D\\uDCC5 Fecha de Salida\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formViaje.fechaSalida,onChange:e=>setFormViaje({...formViaje,fechaSalida:e.target.value}),style:{width:'100%',padding:'10px',border:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\u23F0 Hora de Salida\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",value:formViaje.horaSalida,onChange:e=>setFormViaje({...formViaje,horaSalida:e.target.value}),style:{width:'100%',padding:'10px',border:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px'}})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\uD83D\\uDE97 Kilometraje Actual\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formViaje.kilometrajeSalida,onChange:e=>{const nuevoKm=e.target.value;setFormViaje({...formViaje,kilometrajeSalida:nuevoKm});// Validaci√≥n en tiempo real\nif(nuevoKm&&parseInt(nuevoKm)<(vehiculoAsignado.kilometraje||0)){var _vehiculoAsignado$kil;setMessage({type:'error',// Cambiar de 'warning' a 'error'\ntext:`‚ö†Ô∏è El kilometraje no puede ser menor al √∫ltimo registrado (${((_vehiculoAsignado$kil=vehiculoAsignado.kilometraje)===null||_vehiculoAsignado$kil===void 0?void 0:_vehiculoAsignado$kil.toLocaleString())||0} km)`});}else{// Limpiar mensaje si el kilometraje es v√°lido\nsetMessage(null);}},placeholder:\"Ej: 45000\",required:true,min:vehiculoAsignado.kilometraje||0,style:{width:'100%',padding:'10px',border:formViaje.kilometrajeSalida&&parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'2px solid #ef4444'// Borde rojo si es inv√°lido\n:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px',backgroundColor:formViaje.kilometrajeSalida&&parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'#fee2e2'// Fondo rojo claro si es inv√°lido\n:'white'}}),/*#__PURE__*/_jsxs(\"small\",{style:{color:formViaje.kilometrajeSalida&&parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'#ef4444':'#6b7280',fontSize:'12px',fontWeight:formViaje.kilometrajeSalida&&parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'600':'400'},children:[\"\\xDAltimo registro: \",(vehiculoAsignado.kilometraje||0).toLocaleString(),\" km\",formViaje.kilometrajeSalida&&parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)&&' ‚ö†Ô∏è KILOMETRAJE INV√ÅLIDO']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\uD83D\\uDCCD Destino\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formViaje.destino,onChange:e=>setFormViaje({...formViaje,destino:e.target.value}),placeholder:\"Ingresa el lugar de destino\",required:true,style:{width:'100%',padding:'10px',border:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px'}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\uD83D\\uDCCB Motivo del Viaje\"}),/*#__PURE__*/_jsxs(\"select\",{value:formViaje.motivoViaje,onChange:e=>setFormViaje({...formViaje,motivoViaje:e.target.value}),style:{width:'100%',padding:'10px',border:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"trabajo\",children:\"Trabajo en terreno\"}),/*#__PURE__*/_jsx(\"option\",{value:\"emergencia\",children:\"Emergencia\"}),/*#__PURE__*/_jsx(\"option\",{value:\"mantenimiento\",children:\"Mantenimiento\"}),/*#__PURE__*/_jsx(\"option\",{value:\"traslado\",children:\"Traslado de personal\"}),/*#__PURE__*/_jsx(\"option\",{value:\"carga\",children:\"Transporte de carga\"}),/*#__PURE__*/_jsx(\"option\",{value:\"otro\",children:\"Otro\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'6px',fontSize:'14px',fontWeight:'500',color:'#374151'},children:\"\\uD83D\\uDCDD Observaciones (Opcional)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:formViaje.observaciones,onChange:e=>setFormViaje({...formViaje,observaciones:e.target.value}),placeholder:\"Detalles adicionales del viaje...\",rows:3,style:{width:'100%',padding:'10px',border:'2px solid #e5e7eb',borderRadius:'8px',fontSize:'14px',resize:'none'}})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||!formViaje.kilometrajeSalida||!formViaje.destino||parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0),style:{padding:'14px',background:loading||parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'#9ca3af':'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',color:'white',border:'none',borderRadius:'8px',fontSize:'16px',fontWeight:'600',cursor:loading||parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?'not-allowed':'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'10px',transition:'transform 0.2s',opacity:loading||parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0)?0.5:1},onMouseEnter:e=>{if(!loading&&!(parseInt(formViaje.kilometrajeSalida)<(vehiculoAsignado.kilometraje||0))){e.currentTarget.style.transform='scale(1.02)';}},onMouseLeave:e=>e.currentTarget.style.transform='scale(1)',children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{style:{width:'16px',height:'16px',border:'2px solid white',borderTop:'2px solid transparent',borderRadius:'50%',animation:'spin 1s linear infinite'}}),\"Iniciando...\"]}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDE80 INICIAR VIAJE\"})})]})}):/*#__PURE__*/// Informaci√≥n del viaje activo\n_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',background:'#fef3c7',borderRadius:'8px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 15px 0',color:'#92400e',fontSize:'18px',fontWeight:'600'},children:\"\\uD83D\\uDE97 Viaje en Curso\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gap:'10px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#92400e'},children:\"Destino:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontWeight:'600',fontSize:'15px'},children:viajeActivo.destino})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#92400e'},children:\"Hora de salida:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontWeight:'600'},children:viajeActivo.horaSalida})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#92400e'},children:\"Km de salida:\"}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:'4px 0',fontWeight:'600'},children:[viajeActivo.kilometrajeSalida,\" km\"]})]})]}),viajeActivo.observaciones&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'13px',color:'#92400e'},children:\"Observaciones:\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'4px 0',fontSize:'14px'},children:viajeActivo.observaciones})]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleFinalizarViaje,disabled:loading,style:{width:'100%',padding:'14px',background:loading?'#9ca3af':'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',color:'white',border:'none',borderRadius:'8px',fontSize:'16px',fontWeight:'600',cursor:loading?'not-allowed':'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:'10px'},children:loading?'Finalizando...':'üèÅ FINALIZAR VIAJE'})]})})]}),/*#__PURE__*/_jsx(\"style\",{children:`\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      `})]});};export default TrabajadorVehiclePanel;","map":{"version":3,"names":["React","useState","useEffect","vehiculosService","trabajadoresService","database","ref","databaseRef","update","get","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TrabajadorVehiclePanel","_ref","currentUser","onClose","vehiculoAsignado","setVehiculoAsignado","loading","setLoading","loadingVehiculo","setLoadingVehiculo","message","setMessage","trabajadorData","setTrabajadorData","formViaje","setFormViaje","fechaSalida","Date","toISOString","split","horaSalida","toLocaleTimeString","hour","minute","kilometrajeSalida","destino","motivoViaje","observaciones","viajeActivo","setViajeActivo","mounted","loadData","console","log","uid","Promise","resolve","setTimeout","unsubscribe","getTrabajadorById","data","subscribeToVehiculos","vehiculosData","_trabajadorData","length","vehiculoEncontrado","find","v","asignado","trabajadorAsignado","nombre","onClick","vehiculoRef","id","operadorAsignado","asignadoA","ultimaActualizacion","alert","window","location","reload","error","style","padding","background","color","border","borderRadius","fontSize","cursor","children","prev","_vehiculoEncontrado$k","kilometraje","toString","type","text","handleIniciarViaje","kilometrajeActual","parseInt","toLocaleString","viajeData","vehiculoId","vehiculoNombre","trabajadorId","trabajadorNombre","name","estado","iniciadoEn","updateVehiculoEstado","asignadoNombre","kilometrajeUltimoViaje","updateTrabajadorData","estadoActual","ultimoDestino","handleFinalizarViaje","kilometrajeLlegada","prompt","horaLlegada","kmRecorridos","ultimoViaje","fechaLlegada","kilometrosRecorridos","position","top","left","right","bottom","display","justifyContent","alignItems","zIndex","maxWidth","width","textAlign","marginBottom","maxHeight","overflow","boxShadow","borderBottom","margin","fontWeight","opacity","gridTemplateColumns","gap","patente","marca","modelo","onSubmit","e","preventDefault","value","onChange","target","nuevoKm","_vehiculoAsignado$kil","placeholder","required","min","backgroundColor","rows","resize","disabled","transition","onMouseEnter","currentTarget","transform","onMouseLeave","height","borderTop","animation"],"sources":["C:/Users/Izan/Desktop/AppReact/mapa-quillon/src/components/TrabajadorVehiclePanel.js"],"sourcesContent":["// src/components/TrabajadorVehiclePanel.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { vehiculosService, trabajadoresService } from '../services/firebaseservices';\r\nimport { database } from '../config/firebase';\r\nimport { ref as databaseRef, update, get } from 'firebase/database';\r\n\r\nconst TrabajadorVehiclePanel = ({ currentUser, onClose }) => {\r\n  // ... resto del c√≥digo\r\n  const [vehiculoAsignado, setVehiculoAsignado] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingVehiculo, setLoadingVehiculo] = useState(true); // NUEVO: Estado de carga inicial\r\n  const [message, setMessage] = useState(null);\r\n  const [trabajadorData, setTrabajadorData] = useState(null);\r\n\r\n  // Estados del formulario de viaje\r\n  const [formViaje, setFormViaje] = useState({\r\n    fechaSalida: new Date().toISOString().split('T')[0], // Fecha de hoy\r\n    horaSalida: new Date().toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' }),\r\n    kilometrajeSalida: '',\r\n    destino: '',\r\n    motivoViaje: 'trabajo', // trabajo, emergencia, mantenimiento\r\n    observaciones: ''\r\n  });\r\n\r\n  // Estado para el viaje activo\r\n  const [viajeActivo, setViajeActivo] = useState(null);\r\n\r\n  // Cargar datos del trabajador y su veh√≠culo\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    const loadData = async () => {\r\n      console.log('üîÑ Iniciando carga de veh√≠culo para:', currentUser.uid);\r\n      setLoadingVehiculo(true);\r\n\r\n      try {\r\n        // Esperar un momento para que Firebase se estabilice\r\n        await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n        // Verificar si el componente sigue montado\r\n        if (!mounted) return;\r\n\r\n        // Obtener datos del trabajador\r\n        let trabajadorData = null;\r\n        await new Promise((resolve) => {\r\n          const unsubscribe = trabajadoresService.getTrabajadorById(\r\n            currentUser.uid,\r\n            (data) => {\r\n              console.log('üë∑ Datos del trabajador:', data);\r\n              trabajadorData = data;\r\n              setTrabajadorData(data);\r\n              if (data?.viajeActivo) {\r\n                setViajeActivo(data.viajeActivo);\r\n              }\r\n              resolve();\r\n            }\r\n          );\r\n\r\n          // Timeout para evitar espera infinita\r\n          setTimeout(() => resolve(), 3000);\r\n        });\r\n\r\n        // Verificar veh√≠culos\r\n        await new Promise((resolve) => {\r\n          const unsubscribe = vehiculosService.subscribeToVehiculos((vehiculosData) => {\r\n            console.log('üöõ Total de veh√≠culos:', vehiculosData.length);\r\n\r\n            // Buscar veh√≠culo asignado\r\n            // Buscar veh√≠culo asignado - SOLO buscar en trabajadorAsignado\r\n            let vehiculoEncontrado = null;\r\n\r\n            // IMPORTANTE: Solo buscar en el campo correcto para evitar falsos positivos\r\n            vehiculoEncontrado = vehiculosData.find(v => {\r\n              // Solo aceptar si est√° espec√≠ficamente asignado como trabajadorAsignado\r\n              const asignado = v.trabajadorAsignado === currentUser.uid;\r\n\r\n              if (asignado) {\r\n                console.log('‚úÖ Veh√≠culo encontrado correctamente asignado:', v.nombre);\r\n              }\r\n              // Bot√≥n temporal para limpiar campos legacy\r\n              <button\r\n                onClick={async () => {\r\n                  try {\r\n                    const vehiculoRef = databaseRef(database, `vehiculos/${vehiculoAsignado.id}`);\r\n                    await update(vehiculoRef, {\r\n                      operadorAsignado: null,  // Limpiar campo antiguo\r\n                      asignadoA: null,  // Limpiar por si acaso\r\n                      ultimaActualizacion: new Date().toISOString()\r\n                    });\r\n\r\n                    alert('‚úÖ Campos antiguos limpiados');\r\n                    window.location.reload();\r\n                  } catch (error) {\r\n                    console.error('Error:', error);\r\n                  }\r\n                }}\r\n                style={{\r\n                  padding: '8px 16px',\r\n                  background: '#dc2626',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: '6px',\r\n                  fontSize: '12px',\r\n                  cursor: 'pointer'\r\n                }}\r\n              >\r\n                Limpiar campos antiguos (ejecutar una vez)\r\n              </button>\r\n\r\n              // DEBUG: Mostrar si hay asignaciones incorrectas\r\n              if (v.asignadoA === currentUser.uid || v.operadorAsignado === currentUser.uid) {\r\n                console.log('‚ö†Ô∏è ADVERTENCIA: Veh√≠culo mal asignado en campos incorrectos:', v.nombre);\r\n                console.log('- asignadoA:', v.asignadoA);\r\n                console.log('- operadorAsignado:', v.operadorAsignado);\r\n                console.log('- trabajadorAsignado:', v.trabajadorAsignado);\r\n                // NO retornar true aqu√≠ - ignorar estas asignaciones incorrectas\r\n              }\r\n              //dame el codigo separado con\r\n              return asignado;\r\n            });\r\n\r\n            // NO buscar en otros campos para evitar falsos positivos\r\n            console.log('Resultado de b√∫squeda:', vehiculoEncontrado ? 'Veh√≠culo encontrado' : 'NO hay veh√≠culo asignado');\r\n\r\n            // Si no encuentra, buscar por ID en datos del trabajador\r\n            if (!vehiculoEncontrado && trabajadorData?.vehiculoAsignado) {\r\n              vehiculoEncontrado = vehiculosData.find(v => v.id === trabajadorData.vehiculoAsignado);\r\n              if (vehiculoEncontrado) {\r\n                console.log('‚úÖ Veh√≠culo encontrado por ID del trabajador:', vehiculoEncontrado.nombre);\r\n              }\r\n            }\r\n            // NO BUSCAR EN NING√öN OTRO CAMPO - Comentar o eliminar estas l√≠neas:\r\n            /*\r\n            if (!vehiculoEncontrado && trabajadorData?.vehiculoAsignado) {\r\n              // NO buscar aqu√≠\r\n            }\r\n            \r\n            if (!vehiculoEncontrado && currentUser.vehicleId) {\r\n              // NO buscar aqu√≠ tampoco\r\n            }\r\n            */\r\n\r\n            console.log('Resultado final:', vehiculoEncontrado ? `Veh√≠culo asignado: ${vehiculoEncontrado.nombre}` : 'NO hay veh√≠culo asignado');\r\n            if (vehiculoEncontrado) {\r\n              console.log('‚úÖ VEH√çCULO ASIGNADO:', vehiculoEncontrado);\r\n              setVehiculoAsignado(vehiculoEncontrado);\r\n              setFormViaje(prev => ({\r\n                ...prev,\r\n                kilometrajeSalida: vehiculoEncontrado.kilometraje?.toString() || ''\r\n              }));\r\n            } else {\r\n              console.log('‚ùå NO HAY VEH√çCULO ASIGNADO');\r\n              setVehiculoAsignado(null);\r\n            }\r\n\r\n            // Solo cambiar loading a false despu√©s de verificar todo\r\n            if (mounted) {\r\n              setLoadingVehiculo(false);\r\n            }\r\n\r\n            resolve();\r\n          });\r\n\r\n          // Timeout para evitar espera infinita\r\n          setTimeout(() => {\r\n            if (mounted) {\r\n              setLoadingVehiculo(false);\r\n            }\r\n            resolve();\r\n          }, 3000);\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error('‚ùå Error al cargar datos:', error);\r\n        if (mounted) {\r\n          setMessage({\r\n            type: 'error',\r\n            text: '‚ùå Error al cargar informaci√≥n'\r\n          });\r\n          setLoadingVehiculo(false);\r\n          setVehiculoAsignado(null);\r\n        }\r\n      }\r\n    };\r\n\r\n    loadData();\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [currentUser.uid]);\r\n\r\n  // Iniciar viaje\r\n  const handleIniciarViaje = async () => {\r\n    // Validaciones\r\n    if (!formViaje.destino) {\r\n      setMessage({ type: 'error', text: '‚ö†Ô∏è Debes indicar el destino' });\r\n      return;\r\n    }\r\n\r\n    if (!formViaje.kilometrajeSalida) {\r\n      setMessage({ type: 'error', text: '‚ö†Ô∏è Debes indicar el kilometraje actual' });\r\n      return;\r\n    }\r\n    // NUEVA VALIDACI√ìN: Verificar que el kilometraje no sea menor al registrado\r\n    const kilometrajeActual = vehiculoAsignado.kilometraje || 0;\r\n    const kilometrajeSalida = parseInt(formViaje.kilometrajeSalida);\r\n    if (kilometrajeSalida < kilometrajeActual) {\r\n      setMessage({\r\n        type: 'error',\r\n        text: `‚ö†Ô∏è El kilometraje no puede ser menor al √∫ltimo registrado (${kilometrajeActual.toLocaleString()} km). Verifica el od√≥metro del veh√≠culo.`\r\n      });\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const viajeData = {\r\n        vehiculoId: vehiculoAsignado.id,\r\n        vehiculoNombre: vehiculoAsignado.nombre,\r\n        trabajadorId: currentUser.uid,\r\n        trabajadorNombre: currentUser.name,\r\n        fechaSalida: formViaje.fechaSalida,\r\n        horaSalida: formViaje.horaSalida,\r\n        kilometrajeSalida: parseInt(formViaje.kilometrajeSalida),\r\n        destino: formViaje.destino,\r\n        motivoViaje: formViaje.motivoViaje,\r\n        observaciones: formViaje.observaciones,\r\n        estado: 'en_curso',\r\n        iniciadoEn: new Date().toISOString()\r\n      };\r\n\r\n      // Actualizar estado del veh√≠culo a \"en_uso\"\r\n      await vehiculosService.updateVehiculoEstado(vehiculoAsignado.id, 'en_uso', {\r\n        asignadoA: currentUser.uid,\r\n        asignadoNombre: currentUser.name,\r\n        destino: formViaje.destino,\r\n        kilometrajeUltimoViaje: parseInt(formViaje.kilometrajeSalida),\r\n        viajeActivo: viajeData\r\n      });\r\n\r\n      // Actualizar datos del trabajador con el viaje activo\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        viajeActivo: viajeData,\r\n        estadoActual: 'en_viaje',\r\n        ultimoDestino: formViaje.destino\r\n      });\r\n\r\n      setViajeActivo(viajeData);\r\n      setMessage({\r\n        type: 'success',\r\n        text: '‚úÖ Viaje iniciado exitosamente'\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error al iniciar viaje:', error);\r\n      setMessage({\r\n        type: 'error',\r\n        text: '‚ùå Error al iniciar el viaje'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Finalizar viaje\r\n  const handleFinalizarViaje = async () => {\r\n    const kilometrajeLlegada = prompt('Ingresa el kilometraje al finalizar el viaje:');\r\n    if (!kilometrajeLlegada) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const horaLlegada = new Date().toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' });\r\n      const kmRecorridos = parseInt(kilometrajeLlegada) - viajeActivo.kilometrajeSalida;\r\n\r\n      // Actualizar veh√≠culo\r\n      await vehiculosService.updateVehiculoEstado(vehiculoAsignado.id, 'disponible', {\r\n        asignadoA: currentUser.uid,\r\n        kilometraje: parseInt(kilometrajeLlegada),\r\n        ultimoViaje: {\r\n          ...viajeActivo,\r\n          fechaLlegada: new Date().toISOString().split('T')[0],\r\n          horaLlegada: horaLlegada,\r\n          kilometrajeLlegada: parseInt(kilometrajeLlegada),\r\n          kilometrosRecorridos: kmRecorridos,\r\n          estado: 'finalizado'\r\n        }\r\n      });\r\n\r\n      // Limpiar viaje activo del trabajador\r\n      await trabajadoresService.updateTrabajadorData(currentUser.uid, {\r\n        viajeActivo: null,\r\n        estadoActual: 'disponible',\r\n        ultimoViaje: {\r\n          ...viajeActivo,\r\n          fechaLlegada: new Date().toISOString().split('T')[0],\r\n          horaLlegada: horaLlegada,\r\n          kilometrajeLlegada: parseInt(kilometrajeLlegada),\r\n          kilometrosRecorridos: kmRecorridos\r\n        }\r\n      });\r\n\r\n      setViajeActivo(null);\r\n      setMessage({\r\n        type: 'success',\r\n        text: `‚úÖ Viaje finalizado. Recorriste ${kmRecorridos} km`\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error al finalizar viaje:', error);\r\n      setMessage({\r\n        type: 'error',\r\n        text: '‚ùå Error al finalizar el viaje'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Si est√° cargando, mostrar indicador de carga\r\n  if (loadingVehiculo) {\r\n    return (\r\n      <div style={{\r\n        position: 'fixed',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        background: 'rgba(0, 0, 0, 0.5)',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        zIndex: 9999,\r\n        padding: '20px'\r\n      }}>\r\n        <div style={{\r\n          background: 'white',\r\n          borderRadius: '12px',\r\n          padding: '30px',\r\n          maxWidth: '400px',\r\n          width: '100%',\r\n          textAlign: 'center'\r\n        }}>\r\n          <div style={{ fontSize: '48px', marginBottom: '20px' }}>‚è≥</div>\r\n          <h3 style={{ color: '#1f2937', marginBottom: '10px' }}>\r\n            Cargando informaci√≥n...\r\n          </h3>\r\n          <p style={{ color: '#6b7280' }}>\r\n            Verificando veh√≠culo asignado\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Si no hay veh√≠culo asignado (despu√©s de cargar)\r\n  if (!vehiculoAsignado) {\r\n    return (\r\n      <div style={{\r\n        position: 'fixed',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        background: 'rgba(0, 0, 0, 0.5)',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        zIndex: 9999,\r\n        padding: '20px'\r\n      }}>\r\n        <div style={{\r\n          background: 'white',\r\n          borderRadius: '12px',\r\n          padding: '30px',\r\n          maxWidth: '400px',\r\n          width: '100%',\r\n          textAlign: 'center'\r\n        }}>\r\n          <div style={{ fontSize: '48px', marginBottom: '20px' }}>üö´</div>\r\n          <h3 style={{ color: '#1f2937', marginBottom: '10px' }}>\r\n            No tienes veh√≠culo asignado\r\n          </h3>\r\n          <p style={{ color: '#6b7280', marginBottom: '20px' }}>\r\n            Contacta con tu supervisor para que te asigne un veh√≠culo\r\n          </p>\r\n          <button\r\n            onClick={onClose}\r\n            style={{\r\n              padding: '10px 20px',\r\n              background: '#6b7280',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '8px',\r\n              fontSize: '14px',\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            Cerrar\r\n          </button>\r\n\r\n          {/* Bot√≥n temporal para limpiar datos mal guardados\r\n          <button\r\n            onClick={async () => {\r\n              console.log('üßπ Limpiando asignaciones incorrectas...');\r\n              try {\r\n                // Limpiar TODOS los veh√≠culos mal asignados\r\n                const vehiculosRef = databaseRef(database, 'vehiculos');\r\n                const snapshot = await get(vehiculosRef);\r\n                const vehiculos = snapshot.val() || {};\r\n\r\n                for (const [id, vehiculo] of Object.entries(vehiculos)) {\r\n                  if (vehiculo.asignadoA === currentUser.uid ||\r\n                    vehiculo.operadorAsignado === currentUser.uid) {\r\n                    console.log(`Limpiando veh√≠culo ${id}...`);\r\n                    await update(databaseRef(database, `vehiculos/${id}`), {\r\n                      asignadoA: null,\r\n                      operadorAsignado: null\r\n                    });\r\n                  }\r\n                }\r\n\r\n                // Limpiar el trabajador\r\n                await update(databaseRef(database, `trabajadores/${currentUser.uid}`), {\r\n                  vehiculoAsignado: null,\r\n                  vehicleId: null\r\n                });\r\n\r\n                alert('‚úÖ Limpieza completada. Por favor recarga la p√°gina.');\r\n                window.location.reload();\r\n\r\n              } catch (error) {\r\n                console.error('Error:', error);\r\n                alert('Error: ' + error.message);\r\n              }\r\n            }}\r\n            style={{\r\n              padding: '10px 20px',\r\n              background: '#dc2626',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '8px',\r\n              fontSize: '14px',\r\n              cursor: 'pointer',\r\n              marginBottom: '10px'\r\n            }}\r\n          >\r\n            üßπ LIMPIAR TODAS LAS ASIGNACIONES (DEBUG)\r\n          </button> */}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Solo mostrar el formulario si hay veh√≠culo asignado\r\n  if (!vehiculoAsignado) {\r\n    return null; // Seguridad adicional\r\n  }\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      background: 'rgba(0, 0, 0, 0.5)',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n      zIndex: 9999,\r\n      padding: '20px'\r\n    }}>\r\n      <div style={{\r\n        background: 'white',\r\n        borderRadius: '12px',\r\n        width: '100%',\r\n        maxWidth: '600px',\r\n        maxHeight: '90vh',\r\n        overflow: 'auto',\r\n        boxShadow: '0 10px 40px rgba(0,0,0,0.2)'\r\n      }}>\r\n        {/* Header */}\r\n        <div style={{\r\n          padding: '20px',\r\n          borderBottom: '1px solid #e5e7eb',\r\n          background: 'linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)',\r\n          borderRadius: '12px 12px 0 0',\r\n          color: 'white'\r\n        }}>\r\n          <div style={{\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center'\r\n          }}>\r\n            <div>\r\n              <h2 style={{ margin: 0, fontSize: '24px', fontWeight: '600' }}>\r\n                üöõ Control de Veh√≠culo\r\n              </h2>\r\n              <p style={{ margin: '5px 0 0 0', fontSize: '14px', opacity: 0.9 }}>\r\n                {viajeActivo ? 'Viaje en curso' : 'Registrar salida de veh√≠culo'}\r\n              </p>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              style={{\r\n                background: 'rgba(255, 255, 255, 0.2)',\r\n                border: 'none',\r\n                color: 'white',\r\n                padding: '8px',\r\n                borderRadius: '6px',\r\n                cursor: 'pointer',\r\n                fontSize: '18px'\r\n              }}\r\n            >\r\n              ‚úñ\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mensaje */}\r\n        {message && (\r\n          <div style={{\r\n            margin: '20px 20px 0',\r\n            padding: '12px',\r\n            borderRadius: '8px',\r\n            background: message.type === 'error' ? '#fee2e2' : '#d1fae5',\r\n            color: message.type === 'error' ? '#dc2626' : '#065f46',\r\n            fontSize: '14px',\r\n            fontWeight: '500'\r\n          }}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {/* Informaci√≥n del veh√≠culo */}\r\n        <div style={{\r\n          padding: '20px',\r\n          background: '#f0f9ff',\r\n          borderBottom: '1px solid #e5e7eb'\r\n        }}>\r\n          <h3 style={{\r\n            margin: '0 0 15px 0',\r\n            color: '#0c4a6e',\r\n            fontSize: '16px',\r\n            fontWeight: '600'\r\n          }}>\r\n            Veh√≠culo Asignado\r\n          </h3>\r\n          <div style={{\r\n            display: 'grid',\r\n            gridTemplateColumns: 'repeat(2, 1fr)',\r\n            gap: '15px'\r\n          }}>\r\n            <div>\r\n              <span style={{ fontSize: '12px', color: '#64748b' }}>Veh√≠culo:</span>\r\n              <p style={{ margin: '4px 0', fontWeight: '600', color: '#0c4a6e' }}>\r\n                {vehiculoAsignado.nombre}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <span style={{ fontSize: '12px', color: '#64748b' }}>Patente:</span>\r\n              <p style={{ margin: '4px 0', fontWeight: '600', color: '#0c4a6e' }}>\r\n                {vehiculoAsignado.patente || 'Sin patente'}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <span style={{ fontSize: '12px', color: '#64748b' }}>Marca/Modelo:</span>\r\n              <p style={{ margin: '4px 0', fontWeight: '600', color: '#0c4a6e' }}>\r\n                {vehiculoAsignado.marca} {vehiculoAsignado.modelo}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <span style={{ fontSize: '12px', color: '#64748b' }}>Estado:</span>\r\n              <p style={{ margin: '4px 0', fontWeight: '600' }}>\r\n                <span style={{\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  fontSize: '12px',\r\n                  background: viajeActivo ? '#fef3c7' : '#dcfce7',\r\n                  color: viajeActivo ? '#92400e' : '#15803d'\r\n                }}>\r\n                  {viajeActivo ? 'üöó En viaje' : '‚úÖ Disponible'}\r\n                </span>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Contenido principal */}\r\n        <div style={{ padding: '20px' }}>\r\n          {!viajeActivo ? (\r\n            // Formulario para iniciar viaje\r\n            <form onSubmit={(e) => { e.preventDefault(); handleIniciarViaje(); }}>\r\n              <div style={{ display: 'grid', gap: '15px' }}>\r\n                {/* Fecha y hora de salida */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>\r\n                  <div>\r\n                    <label style={{\r\n                      display: 'block',\r\n                      marginBottom: '6px',\r\n                      fontSize: '14px',\r\n                      fontWeight: '500',\r\n                      color: '#374151'\r\n                    }}>\r\n                      üìÖ Fecha de Salida\r\n                    </label>\r\n                    <input\r\n                      type=\"date\"\r\n                      value={formViaje.fechaSalida}\r\n                      onChange={(e) => setFormViaje({ ...formViaje, fechaSalida: e.target.value })}\r\n                      style={{\r\n                        width: '100%',\r\n                        padding: '10px',\r\n                        border: '2px solid #e5e7eb',\r\n                        borderRadius: '8px',\r\n                        fontSize: '14px'\r\n                      }}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label style={{\r\n                      display: 'block',\r\n                      marginBottom: '6px',\r\n                      fontSize: '14px',\r\n                      fontWeight: '500',\r\n                      color: '#374151'\r\n                    }}>\r\n                      ‚è∞ Hora de Salida\r\n                    </label>\r\n                    <input\r\n                      type=\"time\"\r\n                      value={formViaje.horaSalida}\r\n                      onChange={(e) => setFormViaje({ ...formViaje, horaSalida: e.target.value })}\r\n                      style={{\r\n                        width: '100%',\r\n                        padding: '10px',\r\n                        border: '2px solid #e5e7eb',\r\n                        borderRadius: '8px',\r\n                        fontSize: '14px'\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                {/* Kilometraje */}\r\n                {/* Kilometraje */}\r\n                <div>\r\n                  <label style={{\r\n                    display: 'block',\r\n                    marginBottom: '6px',\r\n                    fontSize: '14px',\r\n                    fontWeight: '500',\r\n                    color: '#374151'\r\n                  }}>\r\n                    üöó Kilometraje Actual\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={formViaje.kilometrajeSalida}\r\n                    onChange={(e) => {\r\n                      const nuevoKm = e.target.value;\r\n                      setFormViaje({ ...formViaje, kilometrajeSalida: nuevoKm });\r\n\r\n                      // Validaci√≥n en tiempo real\r\n                      if (nuevoKm && parseInt(nuevoKm) < (vehiculoAsignado.kilometraje || 0)) {\r\n                        setMessage({\r\n                          type: 'error', // Cambiar de 'warning' a 'error'\r\n                          text: `‚ö†Ô∏è El kilometraje no puede ser menor al √∫ltimo registrado (${vehiculoAsignado.kilometraje?.toLocaleString() || 0} km)`\r\n                        });\r\n                      } else {\r\n                        // Limpiar mensaje si el kilometraje es v√°lido\r\n                        setMessage(null);\r\n                      }\r\n                    }}\r\n                    placeholder=\"Ej: 45000\"\r\n                    required\r\n                    min={vehiculoAsignado.kilometraje || 0}\r\n                    style={{\r\n                      width: '100%',\r\n                      padding: '10px',\r\n                      border: formViaje.kilometrajeSalida && parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0)\r\n                        ? '2px solid #ef4444' // Borde rojo si es inv√°lido\r\n                        : '2px solid #e5e7eb',\r\n                      borderRadius: '8px',\r\n                      fontSize: '14px',\r\n                      backgroundColor: formViaje.kilometrajeSalida && parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0)\r\n                        ? '#fee2e2' // Fondo rojo claro si es inv√°lido\r\n                        : 'white'\r\n                    }}\r\n                  />\r\n                  <small style={{\r\n                    color: formViaje.kilometrajeSalida && parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0)\r\n                      ? '#ef4444'\r\n                      : '#6b7280',\r\n                    fontSize: '12px',\r\n                    fontWeight: formViaje.kilometrajeSalida && parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0)\r\n                      ? '600'\r\n                      : '400'\r\n                  }}>\r\n                    √öltimo registro: {(vehiculoAsignado.kilometraje || 0).toLocaleString()} km\r\n                    {formViaje.kilometrajeSalida && parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0) &&\r\n                      ' ‚ö†Ô∏è KILOMETRAJE INV√ÅLIDO'}\r\n                  </small>\r\n                </div>\r\n\r\n                {/* Destino */}\r\n                <div>\r\n                  <label style={{\r\n                    display: 'block',\r\n                    marginBottom: '6px',\r\n                    fontSize: '14px',\r\n                    fontWeight: '500',\r\n                    color: '#374151'\r\n                  }}>\r\n                    üìç Destino\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={formViaje.destino}\r\n                    onChange={(e) => setFormViaje({ ...formViaje, destino: e.target.value })}\r\n                    placeholder=\"Ingresa el lugar de destino\"\r\n                    required\r\n                    style={{\r\n                      width: '100%',\r\n                      padding: '10px',\r\n                      border: '2px solid #e5e7eb',\r\n                      borderRadius: '8px',\r\n                      fontSize: '14px'\r\n                    }}\r\n                  />\r\n                </div>\r\n\r\n                {/* Motivo del viaje */}\r\n                <div>\r\n                  <label style={{\r\n                    display: 'block',\r\n                    marginBottom: '6px',\r\n                    fontSize: '14px',\r\n                    fontWeight: '500',\r\n                    color: '#374151'\r\n                  }}>\r\n                    üìã Motivo del Viaje\r\n                  </label>\r\n                  <select\r\n                    value={formViaje.motivoViaje}\r\n                    onChange={(e) => setFormViaje({ ...formViaje, motivoViaje: e.target.value })}\r\n                    style={{\r\n                      width: '100%',\r\n                      padding: '10px',\r\n                      border: '2px solid #e5e7eb',\r\n                      borderRadius: '8px',\r\n                      fontSize: '14px'\r\n                    }}\r\n                  >\r\n                    <option value=\"trabajo\">Trabajo en terreno</option>\r\n                    <option value=\"emergencia\">Emergencia</option>\r\n                    <option value=\"mantenimiento\">Mantenimiento</option>\r\n                    <option value=\"traslado\">Traslado de personal</option>\r\n                    <option value=\"carga\">Transporte de carga</option>\r\n                    <option value=\"otro\">Otro</option>\r\n                  </select>\r\n                </div>\r\n\r\n                {/* Observaciones */}\r\n                <div>\r\n                  <label style={{\r\n                    display: 'block',\r\n                    marginBottom: '6px',\r\n                    fontSize: '14px',\r\n                    fontWeight: '500',\r\n                    color: '#374151'\r\n                  }}>\r\n                    üìù Observaciones (Opcional)\r\n                  </label>\r\n                  <textarea\r\n                    value={formViaje.observaciones}\r\n                    onChange={(e) => setFormViaje({ ...formViaje, observaciones: e.target.value })}\r\n                    placeholder=\"Detalles adicionales del viaje...\"\r\n                    rows={3}\r\n                    style={{\r\n                      width: '100%',\r\n                      padding: '10px',\r\n                      border: '2px solid #e5e7eb',\r\n                      borderRadius: '8px',\r\n                      fontSize: '14px',\r\n                      resize: 'none'\r\n                    }}\r\n                  />\r\n                </div>\r\n\r\n                {/* Bot√≥n de acci√≥n */}\r\n                {/* Bot√≥n de acci√≥n */}\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={\r\n                    loading ||\r\n                    !formViaje.kilometrajeSalida ||\r\n                    !formViaje.destino ||\r\n                    (parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0))\r\n                  }\r\n                  style={{\r\n                    padding: '14px',\r\n                    background: loading || (parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0))\r\n                      ? '#9ca3af'\r\n                      : 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: '8px',\r\n                    fontSize: '16px',\r\n                    fontWeight: '600',\r\n                    cursor: loading || (parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0))\r\n                      ? 'not-allowed'\r\n                      : 'pointer',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    gap: '10px',\r\n                    transition: 'transform 0.2s',\r\n                    opacity: loading || (parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0))\r\n                      ? 0.5\r\n                      : 1\r\n                  }}\r\n                  onMouseEnter={(e) => {\r\n                    if (!loading && !(parseInt(formViaje.kilometrajeSalida) < (vehiculoAsignado.kilometraje || 0))) {\r\n                      e.currentTarget.style.transform = 'scale(1.02)';\r\n                    }\r\n                  }}\r\n                  onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <span style={{\r\n                        width: '16px',\r\n                        height: '16px',\r\n                        border: '2px solid white',\r\n                        borderTop: '2px solid transparent',\r\n                        borderRadius: '50%',\r\n                        animation: 'spin 1s linear infinite'\r\n                      }}></span>\r\n                      Iniciando...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      üöÄ INICIAR VIAJE\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          ) : (\r\n            // Informaci√≥n del viaje activo\r\n            <div>\r\n              <div style={{\r\n                padding: '20px',\r\n                background: '#fef3c7',\r\n                borderRadius: '8px',\r\n                marginBottom: '20px'\r\n              }}>\r\n                <h3 style={{\r\n                  margin: '0 0 15px 0',\r\n                  color: '#92400e',\r\n                  fontSize: '18px',\r\n                  fontWeight: '600'\r\n                }}>\r\n                  üöó Viaje en Curso\r\n                </h3>\r\n                <div style={{ display: 'grid', gap: '10px' }}>\r\n                  <div>\r\n                    <span style={{ fontSize: '13px', color: '#92400e' }}>Destino:</span>\r\n                    <p style={{ margin: '4px 0', fontWeight: '600', fontSize: '15px' }}>\r\n                      {viajeActivo.destino}\r\n                    </p>\r\n                  </div>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>\r\n                    <div>\r\n                      <span style={{ fontSize: '13px', color: '#92400e' }}>Hora de salida:</span>\r\n                      <p style={{ margin: '4px 0', fontWeight: '600' }}>\r\n                        {viajeActivo.horaSalida}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <span style={{ fontSize: '13px', color: '#92400e' }}>Km de salida:</span>\r\n                      <p style={{ margin: '4px 0', fontWeight: '600' }}>\r\n                        {viajeActivo.kilometrajeSalida} km\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  {viajeActivo.observaciones && (\r\n                    <div>\r\n                      <span style={{ fontSize: '13px', color: '#92400e' }}>Observaciones:</span>\r\n                      <p style={{ margin: '4px 0', fontSize: '14px' }}>\r\n                        {viajeActivo.observaciones}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <button\r\n                onClick={handleFinalizarViaje}\r\n                disabled={loading}\r\n                style={{\r\n                  width: '100%',\r\n                  padding: '14px',\r\n                  background: loading ? '#9ca3af' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: '8px',\r\n                  fontSize: '16px',\r\n                  fontWeight: '600',\r\n                  cursor: loading ? 'not-allowed' : 'pointer',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  gap: '10px'\r\n                }}\r\n              >\r\n                {loading ? 'Finalizando...' : 'üèÅ FINALIZAR VIAJE'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <style>{`\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TrabajadorVehiclePanel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}